<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FYS - For Yourself</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="apple-touch-icon.jpg">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ff6b35">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FYS">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0a0a0a">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        /* ============================================ */
        /* PREMIUM LOADING SCREEN - BITPANDA STYLE */
        /* ============================================ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 600ms cubic-bezier(0.4, 0.0, 0.2, 1),
                        visibility 600ms cubic-bezier(0.4, 0.0, 0.2, 1);
        }
        
        /* Light Mode Loading Screen */
        :root[data-theme="light"] #loadingScreen {
            background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
        }
        
        /* Dark Mode Loading Screen */
        :root[data-theme="dark"] #loadingScreen {
            background: linear-gradient(180deg, #050505 0%, #0B0B0B 100%);
        }
        
        #loadingScreen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
        }
        
        .loading-logo-container {
            width: 38vw;
            max-width: 240px;
            position: relative;
        }
        
        .loading-logo {
            width: 100%;
            height: auto;
            display: block;
            opacity: 0;
            animation: logoFadeIn 400ms cubic-bezier(0.4, 0.0, 0.2, 1) forwards,
                       logoArrowRise 700ms ease-out 400ms forwards,
                       logoGlowPulse 600ms ease-out 1100ms forwards;
        }
        
        @keyframes logoFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes logoArrowRise {
            from {
                transform: translateY(12px) rotate(-6deg);
            }
            to {
                transform: translateY(0) rotate(0deg);
            }
        }
        
        @keyframes logoGlowPulse {
            0% {
                filter: drop-shadow(0 0 0 rgba(255, 165, 0, 0));
            }
            50% {
                filter: drop-shadow(0 0 18px rgba(255, 165, 0, 0.35));
            }
            100% {
                filter: drop-shadow(0 0 0 rgba(255, 165, 0, 0));
            }
        }
        
        /* ============================================ */
        /* APP HEADER LOGO */
        /* ============================================ */
        .header-logo-fys {
            position: fixed;
            top: 14px;
            left: 16px;
            height: 28px;
            width: auto;
            z-index: 999; /* Above all views except modals */
            pointer-events: auto; /* Klickbar */
            cursor: pointer; /* Logo is decorative, not clickable */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-card: #111111;
            --bg-elevated: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #6b6b6b;
            --text-tertiary: #404040;
            --accent-primary: #ff6b35;
            --accent-up: #00ff88;
            --accent-down: #ff3366;
            --border: #1a1a1a;
            --border-light: #2a2a2a;
        }

        :root[data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-card: #111111;
            --bg-elevated: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #6b6b6b;
            --text-tertiary: #404040;
            --accent-primary: #ff6b35;
            --accent-up: #00ff88;
            --accent-down: #ff3366;
            --border: #1a1a1a;
            --border-light: #2a2a2a;
        }

        :root[data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-elevated: #ffffff;
            --text-primary: #ff6b35;
            --text-secondary: #ff8f5f;
            --text-tertiary: #ffb89d;
            --accent-primary: #ff6b35;
            --accent-up: #00c96d;
            --accent-down: #ff3366;
            --border: #ffe8e0;
            --border-light: #fff5f0;
        }
        /* ============================================
           Loading Screen - Modern Design (Website Style)
           ============================================ */

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary); /* Theme-aware background */
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease, visibility 1s ease;
            overflow: hidden;
        }

        .loading-screen::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.08), transparent 65%);
            border-radius: 50%;
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
            animation: glowPulse 5s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.3;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.6;
            }
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
        }

        .loading-content {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .loading-logo {
            width: 260px;
            height: 260px;
            margin: 0 auto 40px auto;
            position: relative;
        }
        
        .loading-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 12px 40px rgba(255, 107, 53, 0.5));
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% {
                filter: drop-shadow(0 12px 40px rgba(255, 107, 53, 0.4));
            }
            50% {
                filter: drop-shadow(0 16px 50px rgba(255, 107, 53, 0.7));
            }
        }
        
        .loading-text {
            font-size: 28px;
            font-weight: 700;
            color: #ff6b35;
            letter-spacing: 3px;
            white-space: nowrap;
            overflow: hidden;
            border-right: 3px solid #ff6b35;
            width: 0;
            animation: typing 1.5s steps(20) 0.3s forwards, blink 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from {
                width: 0;
            }
            to {
                width: 100%;
            }
        }
        
        @keyframes blink {
            from, to {
                border-color: transparent;
            }
            50% {
                border-color: #ff6b35;
            }
        }
        
        .loading-text-word {
            display: inline;
        }

        /* Legacy loading styles removed */

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            padding: 0;
            padding-top: 68px; /* Header Höhe + Buffer */
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary); /* Theme-aware */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeOut 0.5s 2s forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                pointer-events: auto; /* Klickbar */
            cursor: pointer;
            }
        }

        .logo-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin-bottom: 32px;
        }

        .logo-circle {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: var(--bg-secondary); /* Theme-aware */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 60px rgba(255, 107, 53, 0.4),
                        inset 0 0 40px rgba(0, 0, 0, 0.2);
        }

        .logo-ring {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 10px solid transparent;
            border-top-color: #ff6b35;
            border-right-color: #ff6b35;
            border-bottom-color: #ff6b35;
            animation: rotate 3s linear infinite;
            filter: drop-shadow(0 0 20px rgba(255, 107, 53, 0.6));
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logo-segment-1 {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 10px solid transparent;
            border-top-color: #ff6b35;
            transform: rotate(45deg);
            opacity: 0.6;
        }

        .logo-segment-2 {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 10px solid transparent;
            border-bottom-color: #ff6b35;
            transform: rotate(135deg);
            opacity: 0.6;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo-text {
            font-size: 42px;
            font-weight: 900;
            color: #000;
            letter-spacing: -2px;
        }

        .brand-tagline {
            font-size: 18px;
            font-weight: 700;
            color: #ff6b35;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: fadeIn 0.8s 0.5s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            padding-bottom: 110px;
            min-height: 100vh;
        }

        /* Header with Logo */
        .header {
            background: var(--bg-secondary);
            padding: 20px 20px 20px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            min-height: 70px; /* Mindesthöhe für richtigen Header */
        }
        
        /* Header Hintergrund bis ganz nach oben (verhindert durchscheinen beim Scrollen) */
        .header::before {
            content: '';
            position: absolute;
            top: -200px; /* Geht weit nach oben über safe-area */
            left: 0;
            right: 0;
            height: 200px;
            background: var(--bg-secondary);
            z-index: -1;
        }
        
        /* iOS safe area support */
        @supports (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: calc(20px + env(safe-area-inset-top));
                min-height: calc(70px + env(safe-area-inset-top));
            }
        }
        
        /* Progress Badges */
        .header-progress-badges {
            display: flex;
            gap: 6px;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
            align-items: center;
        }
        
        .progress-badge-compact {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            pointer-events: auto;
            cursor: pointer;
        }
        
        .progress-badge-compact.incomplete {
            background: rgba(255, 255, 255, 0.1);
            border: 1.5px solid var(--border);
        }
        
        .progress-badge-compact.complete {
            background: var(--accent-primary);
            border: 1.5px solid var(--accent-primary);
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.6);
        }
        
        .progress-badge-compact svg {
            width: 16px;
            height: 16px;
            opacity: 0.4;
            color: var(--text-secondary);
        }
        
        .progress-badge-compact.complete svg {
            color: #000;
            opacity: 1;
        }
        
        /* Streak Card */
        .streak-card {
            margin: 16px 0;
            padding: 20px;
            background: rgba(255, 107, 53, 0.05);
            border: 2px solid rgba(255, 107, 53, 0.2);
            border-radius: 16px;
            animation: fadeIn 0.5s;
        }
        
        .streak-card-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .streak-flame {
            font-size: 48px;
            line-height: 1;
            animation: flameFlicker 2s infinite;
        }
        
        @keyframes flameFlicker {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .streak-info {
            flex: 1;
        }
        
        .streak-number {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent-primary);
            line-height: 1;
        }
        
        .streak-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }
        
        .streak-sublabel {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .streak-record {
            text-align: right;
        }
        
        .streak-record-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .streak-record-number {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 2px;
        }

        /* ============================================ */
        /* PROFESSIONAL FYS LOGO - HEADER */
        /* ============================================ */
        .logo-fys-header {
            display: flex;
            align-items: center;
        }

        .fys-logo-img {
            height: 60px;
            width: auto;
            filter: drop-shadow(0 2px 8px rgba(255, 107, 53, 0.3));
            transition: transform 0.3s ease;
        }
        
        .fys-logo-img:hover {
            transform: scale(1.05);
        }

        /* Keep SVG styles for other uses */
        .fys-logo-svg {
            width: 80px;
            height: 40px;
            filter: drop-shadow(0 2px 8px rgba(255, 107, 53, 0.3));
        }

        /* Subtle Pulse Animation for Arrow */
        .arrow-pulse {
            animation: arrowPulse 2s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% {
                opacity: 0.6;
                transform: translateY(0);
            }
            50% {
                opacity: 1;
                transform: translateY(-3px);
            }
        }


        .header-date {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Home View */
        .home-content {
            padding: 0 20px 20px 20px; /* Kein padding-top, wird von .view-section Regel gesetzt */
            position: relative; /* Enable stacking context for z-index */
        }

        .index-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-tertiary);
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
        }

        .main-chart-section {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .main-chart-section:active {
            transform: scale(0.98);
        }

        .main-chart-container {
            position: relative;
            height: 220px;
            margin-bottom: 20px;
        }

        .index-value-display {
            text-align: center;
        }

        .index-value-number {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -2px;
            line-height: 1;
            margin-bottom: 8px;
        }

        .index-value-number.positive {
            color: var(--accent-up);
        }

        .index-value-number.negative {
            color: var(--accent-down);
        }

        .index-change-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .tap-hint {
            text-align: center;
            margin-top: 12px;
            font-size: 11px;
            color: var(--text-tertiary);
            opacity: 0.6;
        }

        .time-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            position: relative; /* NEW: Enable stacking */
            z-index: 10; /* NEW: Above other content */
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .time-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .time-btn.active {
            background: var(--accent-primary);
            color: #000; /* Dark text in dark mode */
            border-color: var(--accent-primary);
        }
        
        /* Light Mode: White text on orange */
        :root[data-theme="light"] .time-btn.active {
            color: #ffffff;
        }

        /* Solid backgrounds for all Cards */
        .widget-card,
        .main-chart-section,
        .chart-card,
        .stock-list-container,
        .journal-calendar,
        .journal-entry-section,
        .category-chart-card {
            background: var(--bg-card) !important;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Widget Cards */
        .widget-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .widget-card:active {
            transform: scale(0.98);
        }

        .widget-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 700;
        }

        .widget-icon {
            font-size: 24px;
        }

        .widget-icon.premium-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .widget-icon.premium-icon svg {
            width: 100%;
            height: 100%;
            stroke: var(--accent-primary);
            filter: drop-shadow(0 2px 6px rgba(255, 107, 53, 0.3));
        }

        .widget-stats {
            display: flex;
            gap: 16px;
        }

        .widget-stat {
            flex: 1;
        }

        .widget-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .widget-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .coming-soon-badge {
            display: inline-block;
            background: var(--bg-elevated);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Check-in View */
        .checkin-content {
            padding: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -0.8px;
        }

        .checkin-status {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .status-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .status-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .edit-btn {
            background: var(--accent-primary);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
        }

        .category-input {
            margin-bottom: 28px;
        }

        .category-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .input-category-name {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .input-category-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .input-category-icon svg {
            width: 18px;
            height: 18px;
        }

        .input-category-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .category-value-display {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-elevated);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            border: none;
        }

        .sleep-input {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 28px;
        }

        .sleep-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sleep-value-display {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 20px 0;
        }

        .sleep-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .sleep-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
            transition: all 0.2s;
        }

        .sleep-btn:active {
            transform: scale(0.95);
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: var(--accent-primary);
            color: #000;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: inherit;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* Habit & Sober Tracker */
        .tracker-content {
            padding: 20px;
        }

        .coming-soon-screen {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 60px 24px;
            text-align: center;
        }

        .coming-soon-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .coming-soon-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .coming-soon-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Settings */
        .settings-content {
            padding: 20px;
        }

        .setting-item {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 16px;
        }

        .setting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: block;
            min-height: 18px;
        }

        .setting-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 14px;
            line-height: 1.5;
            display: block;
            min-height: 16px;
        }

        .setting-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .setting-option {
            padding: 10px 18px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        
        .setting-option-text {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .setting-option.active {
            background: var(--accent-primary);
            color: #ffffff;
            border-color: var(--accent-primary);
        }

        /* Light Mode: Better contrast for active state */
        :root[data-theme="light"] .setting-option.active {
            background: #ff6b35;
            color: #ffffff;
        }

        .sleep-goal-input {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sleep-goal-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
        }

        .sleep-goal-value {
            flex: 1;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: var(--bg-elevated);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border);
        }

        .toggle-switch.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.2); /* Glow effect */
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: var(--bg-card);
            border-radius: 50%;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(22px);
        }
        
        /* Dark Mode: Black slider when active */
        :root[data-theme="dark"] .toggle-switch.active .toggle-slider {
            background: #000;
        }
        
        /* Light Mode: White slider when active */
        :root[data-theme="light"] .toggle-switch.active .toggle-slider {
            background: #ffffff;
        }

        /* Chart Details */
        .chart-details-view {
            padding: 20px;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 0;
            margin-bottom: 20px;
            font-family: inherit;
        }

        /* Flatex-Style Stock List */
        .stock-list-container {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .stock-list-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-list-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .stock-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .stock-item:last-child {
            border-bottom: none;
        }

        .stock-item:active {
            background: var(--bg-elevated);
        }

        .stock-item-left {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }

        .stock-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .stock-icon svg {
            width: 22px;
            height: 22px;
        }

        .stock-info {
            flex: 1;
        }

        .stock-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 3px;
            letter-spacing: -0.2px;
        }

        .stock-symbol {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stock-item-right {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 3px;
        }

        .stock-price {
            font-size: 17px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .stock-change {
            font-size: 13px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .stock-change.positive {
            background: rgba(0, 201, 109, 0.15);
            color: var(--accent-up);
        }

        .stock-change.negative {
            background: rgba(255, 51, 102, 0.15);
            color: var(--accent-down);
        }

        .stock-change.neutral {
            background: var(--bg-elevated);
            color: var(--text-secondary);
        }

        .stock-arrow {
            font-size: 10px;
        }

        /* FYS Index Summary Card */
        .fys-index-summary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #ff8f5f 100%);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            color: #ffffff;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .fys-index-label {
            font-size: 16px;
            font-weight: 700;
            opacity: 1;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #ffffff 0%, rgba(255, 255, 255, 0.85) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .fys-index-value {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -2px;
            margin-bottom: 8px;
        }

        .fys-index-change {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.95;
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -0.3px;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        .single-chart-container {
            position: relative;
            height: 180px;
        }

        /* Category Detail Modal */
        .category-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 150;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .category-detail-modal.active {
            display: flex;
        }

        /* Journal Modal */
        .journal-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 150;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        .journal-modal.active {
            display: flex;
        }

        /* Confirm Modal */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .confirm-modal.active {
            display: flex;
        }

        .confirm-dialog {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px 24px;
            max-width: 380px;
            width: 100%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .confirm-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 12px;
        }

        .confirm-message {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
        }

        .confirm-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-family: inherit;
            transition: all 0.2s;
        }

        .confirm-btn-cancel {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .confirm-btn-confirm {
            background: #ff3366;
            color: #fff;
        }

        .confirm-btn:active {
            transform: scale(0.98);
        }

        .journal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .journal-title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .journal-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .journal-calendar {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-size: 18px;
            font-weight: 700;
        }

        .calendar-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-family: inherit;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 8px 0;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-elevated);
        }

        .calendar-day.empty {
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
            opacity: 0;
        }

        .calendar-day.today {
            background: var(--accent-primary);
            color: #000;
        }

        .calendar-day.has-entry::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-primary);
            box-shadow: 0 0 6px rgba(255, 107, 53, 0.6);
        }

        .calendar-day.today.has-entry::after {
            background: #000;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
        }

        .journal-entry-section {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 24px;
            display: none;
            z-index: 10000;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
        }

        .journal-entry-section.active {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* Backdrop */
        .journal-entry-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: none;
        }
        
        .journal-entry-backdrop.active {
            display: block;
        }

        .journal-entry-date {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--accent-primary);
        }

        .journal-textarea {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            line-height: 1.6;
            resize: vertical;
        }

        .journal-save-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-primary);
            color: #000; /* Dark Mode: schwarz auf orange */
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 12px;
            font-family: inherit;
        }
        
        /* Light Mode: dunkler Text auf orange Button */
        [data-theme="light"] .journal-save-btn {
            color: #fff; /* Weiß auf orange im Light Mode */
        }

        .category-detail-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .category-detail-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-detail-icon svg {
            width: 26px;
            height: 26px;
        }

        .category-detail-info {
            flex: 1;
        }

        .category-detail-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .category-detail-symbol {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .category-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .category-detail-price-section {
            margin-bottom: 24px;
        }

        .category-detail-price {
            font-size: 42px;
            font-weight: 800;
            letter-spacing: -1.5px;
            margin-bottom: 8px;
        }

        .category-detail-change {
            font-size: 16px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .category-time-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .category-time-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: inherit;
        }

        .category-time-btn.active {
            background: var(--accent-primary);
            color: #000;
            border-color: var(--accent-primary);
        }

        .category-chart-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 20px;
        }

        .category-chart-container {
            position: relative;
            height: 280px;
        }

        .coach-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 80px; /* Platz für Bottom Nav */
            background: var(--bg-primary);
            z-index: 250; /* Unter Bottom Nav */
            display: none;
            flex-direction: column;
        }

        .coach-modal.active {
            display: flex;
        }

        .coach-header {
            padding: 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .coach-title {
            font-size: 18px;
            font-weight: 700;
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-family: inherit;
        }

        .coach-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            animation: messageIn 0.3s ease;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 80%;
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary); /* Einheitliche Farbe */
        }

        .message.assistant .message-bubble {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary); /* Explizit */
        }

        .message.user .message-bubble {
            background: var(--accent-primary);
            color: #ffffff; /* Weiß auf Orange */
            font-weight: 500;
        }

        .coach-input-area {
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
        }

        .coach-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .coach-input {
            flex: 1;
            padding: 14px 18px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .send-btn {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: var(--accent-primary);
            border: none;
            color: #000;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
        }

        .send-btn:disabled {
            opacity: 0.4;
        }

        /* Bottom Navigation - Pushup App Style (Floating Pill) */
        .bottom-nav {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            max-width: 560px;
            width: calc(100% - 40px);
            height: 68px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
            z-index: 200;
            
            /* Glassmorphism Effect */
            background: rgba(28, 28, 30, 0.78);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            
            /* Floating Pill Shape */
            border-radius: 34px;
            border: 0.5px solid rgba(255, 255, 255, 0.18);
            
            /* Subtle Shadow */
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        [data-theme="light"] .bottom-nav {
            background: rgba(255, 255, 255, 0.88);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 0.5px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15),
                        inset 0 1px 0 rgba(255, 255, 255, 0.95);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 14px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-family: inherit;
            position: relative;
            flex: 1;
            max-width: 80px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
        }

        /* Inaktive Tabs */
        .nav-item {
            color: rgba(235, 235, 245, 0.6);
        }

        [data-theme="light"] .nav-item {
            color: rgba(60, 60, 67, 0.6);
        }

        /* Aktiver Tab - Orange */
        .nav-item.active {
            color: #ff6b35;
            transform: scale(1.05);
        }

        [data-theme="light"] .nav-item.active {
            color: #ff6b35;
        }

        /* Pop Animation beim Aktivieren */
        @keyframes tabPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.12); }
            100% { transform: scale(1.05); }
        }

        .nav-item.active {
            animation: tabPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Hover State */
        .nav-item:hover:not(.active) {
            color: rgba(235, 235, 245, 0.85);
            transform: scale(1.02);
        }

        [data-theme="light"] .nav-item:hover:not(.active) {
            color: rgba(60, 60, 67, 0.85);
        }

        /* Active Press State */
        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            width: 26px;
            height: 26px;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.8; /* Dünner */
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Aktives Icon - stärker */
        .nav-item.active .nav-icon {
            stroke-width: 2.2; /* Dünner */
            filter: drop-shadow(0 2px 6px rgba(255, 107, 53, 0.4));
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: -0.2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Aktives Label - stärker */
        .nav-item.active .nav-label {
            font-weight: 700;
            letter-spacing: -0.1px;
        }

        .view-section {
            display: none;
            min-height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .view-section.active {
            display: block;
        }
        
        /* Verhindere dass Content über Header scrollt */
        .home-content,
        .chart-details-view,
        .settings-container,
        .tools-container {
            padding-top: 70px; /* Exakt Header-Höhe - kein extra Abstand */
        }
        
        /* iOS safe area support für Content */
        @supports (padding-top: env(safe-area-inset-top)) {
            .home-content,
            .chart-details-view,
            .settings-container,
            .tools-container {
                padding-top: calc(70px + env(safe-area-inset-top));
            }
        }

        .success-toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--accent-primary);
            color: #000;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            z-index: 400;
            opacity: 0;
            transition: all 0.3s;
        }

        .success-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid var(--bg-elevated);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* ========================================
           WIZARD CHECK-IN STYLES
           ======================================== */
        
        /* Confirmation Dialog */
        .wizard-confirm {
            display: none; /* Initially hidden */
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 200px);
            padding: 40px 24px;
        }
        
        .wizard-confirm.active {
            display: flex; /* Show when active */
        }
        
        /* Error Fallback UI */
        .wizard-error {
            display: none;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 200px);
            padding: 40px 24px;
        }
        
        .wizard-error.active {
            display: flex;
        }
        
        .error-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }
        
        .error-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .error-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .error-message {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 28px;
            line-height: 1.5;
        }
        
        .error-retry-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            border: none;
            border-radius: 16px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .error-retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
        }

        .confirm-content {
            text-align: center;
            max-width: 400px;
        }

        .confirm-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .confirm-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .confirm-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .confirm-actions {
            display: flex;
            gap: 12px;
        }

        .btn-secondary {
            flex: 1;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .btn-primary-wizard {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            border: none;
            border-radius: 16px;
            color: #ffffff; /* Default: white text */
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        /* Dark Mode: Black text on orange buttons */
        :root[data-theme="dark"] .btn-primary-wizard,
        :root[data-theme="dark"] .btn-primary {
            color: #000000;
        }
        
        /* Light Mode: White text on orange buttons */
        :root[data-theme="light"] .btn-primary-wizard,
        :root[data-theme="light"] .btn-primary {
            color: #ffffff;
        }

        .btn-primary-wizard:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
        }

        /* Wizard Container */
        .wizard-container {
            display: none; /* Initially hidden */
            flex-direction: column;
            height: calc(100vh - 80px); /* Space for bottom nav */
            position: relative;
        }
        
        .wizard-container.active {
            display: flex; /* Show when active */
        }

        .wizard-header {
            padding: 20px 24px 16px;
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0; /* Don't shrink */
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .back-btn-wizard {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            color: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 20px;
        }

        .back-btn-wizard:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .back-btn-wizard:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .close-btn-wizard {
            background: none;
            border: none;
            color: #666;
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
        }

        .step-counter {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .progress-container-wizard {
            height: 4px;
            background: var(--bg-secondary);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-wizard {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #ff8f5f);
            transition: width 0.3s ease;
            width: 12.5%;
        }

        .progress-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 12px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #333;
            transition: all 0.3s;
        }

        .dot.active {
            background: var(--accent-primary);
            width: 24px;
            border-radius: 4px;
        }

        .dot.completed {
            background: var(--accent-primary);
        }

        /* Content Area */
        .wizard-content-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            min-height: 0; /* Important for flex children */
        }

        .step-container-wizard {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
            padding: 20px 24px 140px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .step-container-wizard.active {
            display: flex; /* Show active step */
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto; /* Enable interaction */
        }

        .step-container-wizard.prev {
            display: none; /* Completely hide previous steps */
            transform: translateX(-100%);
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
        }

        .category-icon-wizard {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }

        .category-icon-wizard svg {
            width: 32px;
            height: 32px;
        }

        .step-title-wizard {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .step-subtitle-wizard {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .input-area-wizard {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-top: 40px;
        }

        .slider-value-display-wizard {
            text-align: center;
            margin-bottom: 40px;
        }

        .slider-value-wizard {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }

        .slider-label-wizard {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }

        .slider-wizard {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 20px;
        }

        .slider-wizard::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .slider-wizard::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .slider-labels-wizard {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            padding: 0 4px;
        }

        /* Review Screen */
        .review-list-wizard {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            margin-top: 24px;
            padding-bottom: 20px;
        }

        .review-item-wizard {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .review-item-wizard:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: #333;
        }

        .review-item-left-wizard {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .review-icon-wizard {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .review-icon-wizard svg {
            width: 20px;
            height: 20px;
        }

        .review-info-wizard {
            display: flex;
            flex-direction: column;
        }

        .review-category-wizard {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .review-hint-wizard {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .review-value-wizard {
            font-size: 24px;
            font-weight: 800;
            color: var(--accent-primary);
        }

        .wizard-actions {
            padding: 20px 24px calc(80px + 20px); /* Bottom nav height + padding */
            background: var(--bg-elevated);
            border-top: 1px solid var(--border);
            flex-shrink: 0; /* Don't shrink */
            position: relative;
            z-index: 10;
        }

        /* ========================================
           PERFORMANCE PACKS STYLES
           ======================================== */
        
        .performance-packs-container {
            margin-top: 24px;
        }

        .performance-packs-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-tertiary);
            font-weight: 700;
            margin-bottom: 16px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .performance-pack-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: 2px solid var(--border);
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .performance-pack-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 107, 53, 0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .performance-pack-card:hover::before {
            opacity: 1;
        }

        .performance-pack-card.active {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05), transparent);
        }

        .performance-pack-card:active {
            transform: scale(0.98);
        }

        .pack-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .pack-info-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pack-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(255, 107, 53, 0.1);
            flex-shrink: 0;
        }

        .pack-name-info {
            display: flex;
            flex-direction: column;
        }

        .pack-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .pack-index-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .pack-toggle {
            width: 50px;
            height: 28px;
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .pack-toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--text-secondary);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }

        .pack-toggle.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .pack-toggle.active::after {
            left: 24px;
            background: #000;
        }

        .pack-description {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .pack-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            position: relative;
            z-index: 1;
        }

        .pack-category-chip {
            padding: 4px 10px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .performance-pack-card.active .pack-category-chip {
            background: rgba(255, 107, 53, 0.1);
            border-color: rgba(255, 107, 53, 0.3);
            color: var(--accent-primary);
        }

        .performance-pack-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .performance-pack-card.locked .pack-toggle {
            opacity: 0.5;
            pointer-events: auto; /* Klickbar */
            cursor: pointer;
        }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            z-index: 10;
        }

        .lock-icon {
            font-size: 36px;
            color: var(--text-secondary);
        }
        /* ============================================ */
        /* TYPOGRAPHY - THINNER WEIGHTS */
        /* ============================================ */
        :root {
            --font-weight-light: 300;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
        }

        body {
            font-weight: var(--font-weight-light); /* 400 → 300 */
        }

        h1, h2, h3, .section-title {
            font-weight: var(--font-weight-medium); /* 600 → 500 */
        }

        button, .btn-primary, .btn-secondary, .nav-label {
            font-weight: var(--font-weight-normal); /* 500 → 400 */
        }

        /* Keep bold for numbers */
        .index-value-number, .category-detail-price, .stock-price {
            font-weight: var(--font-weight-bold);
        }

        /* ============================================ */
        /* FLOATING CHECK-IN BUTTON */
        /* ============================================ */
        /* ============================================ */
        /* TOOLS VIEW */
        /* ============================================ */
        .tool-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tool-card:hover {
            background: var(--bg-elevated);
            transform: translateX(4px);
        }

        .tool-icon {
            font-size: 32px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .tool-info {
            flex: 1;
        }

        .tool-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .tool-description {
            font-size: 13px;
            font-weight: 300;
            color: var(--text-secondary);
        }

        .pro-badge-small {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
        }

        /* ============================================ */
        /* UPGRADE MODAL */
        /* ============================================ */
        .upgrade-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .upgrade-modal.active {
            display: flex;
        }

        .upgrade-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .upgrade-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .upgrade-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .upgrade-description {
            font-size: 14px;
            font-weight: 300;
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .upgrade-features {
            text-align: left;
            margin-bottom: 24px;
        }

        .upgrade-feature {
            padding: 8px 0;
            font-size: 14px;
            font-weight: 400;
            color: var(--text-primary);
        }

        .upgrade-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            border: none;
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
        }

        /* ============================================ */
        /* DAILY CHECK-IN WIDGET */
        /* ============================================ */
        .checkin-widget {
            position: sticky; /* Sticky on scroll */
            top: 90px; /* Klebt unter dem Header (90px = Header Höhe) */
            z-index: 50; /* Above content, below header */
            
            background: rgba(255, 107, 53, 0.95); /* Semi-transparent for glass effect */
            backdrop-filter: blur(20px) saturate(180%); /* Glassmorphism */
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0 16px 0; /* Top margin for breathing room */
            cursor: pointer;
            
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2),
                        0 8px 24px rgba(255, 107, 53, 0.1);
            
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* iOS safe area support für sticky widget */
        @supports (top: env(safe-area-inset-top)) {
            .checkin-widget {
                top: calc(90px + env(safe-area-inset-top));
            }
        }

        .checkin-widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3),
                        0 12px 36px rgba(255, 107, 53, 0.15);
        }
        
        /* Completed State - eleganter Look */
        .checkin-widget.completed {
            background: linear-gradient(135deg, rgba(0, 201, 109, 0.12), rgba(0, 201, 109, 0.05));
            border: 1px solid rgba(0, 201, 109, 0.25);
            box-shadow: 0 4px 12px rgba(0, 201, 109, 0.15);
        }
        
        .checkin-widget.completed .checkin-widget-icon {
            background: rgba(0, 201, 109, 0.2);
        }
        
        .checkin-widget.completed:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 201, 109, 0.25);
        }
        
        /* Pro Edit State - orange Highlight */
        .checkin-widget.pro-edit {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.18), rgba(255, 107, 53, 0.08));
            border: 1px solid rgba(255, 107, 53, 0.35);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }
        
        .checkin-widget.pro-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }
        
        /* Compact mode when sticky (smaller) */
        .checkin-widget.is-sticky {
            padding: 14px 18px; /* Slightly bigger for better look */
            margin: 0; /* No margin when sticky */
            border-radius: 16px; /* Fully rounded, not cut off */
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.35),
                        0 16px 48px rgba(255, 107, 53, 0.2);
            backdrop-filter: blur(30px) saturate(200%);
            -webkit-backdrop-filter: blur(30px) saturate(200%);
        }
        
        /* Hide subtitle when sticky */
        .checkin-widget.is-sticky .checkin-widget-subtitle {
            display: none;
        }
        
        /* Smaller icon when sticky */
        .checkin-widget.is-sticky .checkin-widget-icon {
            width: 40px; /* Slightly bigger: 36 → 40 */
            height: 40px;
        }
        
        .checkin-widget.is-sticky .checkin-widget-icon svg {
            width: 20px; /* Slightly bigger: 18 → 20 */
            height: 20px;
        }
        
        /* Smaller title when sticky */
        .checkin-widget.is-sticky .checkin-widget-title {
            font-size: 16px; /* Slightly bigger: 15 → 16 */
        }

        .checkin-widget-header {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .checkin-widget-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkin-widget-icon svg {
            width: 24px;
            height: 24px;
            stroke: #ffffff;
        }

        .checkin-widget-info {
            flex: 1;
        }

        .checkin-widget-title {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .checkin-widget-subtitle {
            font-size: 13px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        .checkin-widget-arrow {
            font-size: 24px;
            color: #ffffff;
            opacity: 0.8;
        }

        /* ============================================ */
        /* ACTIVE PERFORMANCE PACK CARD */
        /* ============================================ */
        /* ============================================ */
        /* ENHANCED CATEGORY DETAILS */
        /* ============================================ */
        .category-influence-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }

        .influence-title {
            font-size: 12px;
            font-weight: 300;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .influence-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }

        .influence-description {
            font-size: 11px;
            font-weight: 300;
            color: var(--text-secondary);
        }

        .trend-badge {
            font-size: 10px;
            font-weight: 400;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .trend-badge.bullish {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-up);
        }

        .trend-badge.bearish {
            background: rgba(255, 51, 102, 0.1);
            color: var(--accent-down);
        }

        .trend-badge.neutral {
            background: rgba(128, 128, 128, 0.1);
            color: var(--text-secondary);
        }

        .recent-checkins-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }

        .checkins-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .checkin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .checkin-item:last-child {
            border-bottom: none;
        }

        .checkin-date {
            font-size: 12px;
            font-weight: 300;
            color: var(--text-secondary);
        }

        .checkin-rating {
            font-size: 10px;
        }

        .checkin-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ============================================ */
        /* WIZARD SUMMARY */
        /* ============================================ */
        .summary-container {
            padding: 20px;
        }

        .summary-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .summary-subtitle {
            font-size: 14px;
            font-weight: 300;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .summary-list {
            margin-bottom: 24px;
        }

        .summary-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .summary-item:hover {
            background: var(--bg-elevated);
            transform: translateX(4px);
        }

        .summary-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .summary-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .summary-icon svg {
            width: 20px;
            height: 20px;
        }

        .summary-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .summary-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .summary-actions button {
            flex: 1;
        }

        /* ============================================ */
        /* LIGHT MODE BUTTON CONTRAST FIX */
        /* ============================================ */
        :root[data-theme="light"] .btn-primary,
        :root[data-theme="light"] .btn-primary-wizard,
        :root[data-theme="light"] .floating-checkin-btn,
        :root[data-theme="light"] .upgrade-btn {
            background: linear-gradient(135deg, #ff6b35, #ff8f5f);
            color: #ffffff !important;
            border: none;
        }

        :root[data-theme="light"] button:not(.nav-item) {
            color: var(--text-primary);
        }

        :root[data-theme="light"] .btn-primary,
        :root[data-theme="light"] .btn-primary-wizard {
            color: #ffffff !important;
        }
        
        /* Pull-to-Refresh Indicator - Flatex Style */
        .pull-to-refresh {
            position: fixed;
            top: 70px; /* Direkt unter Header */
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 32px;
            background: var(--bg-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .pull-to-refresh.visible {
            opacity: 1;
        }
        
        .pull-to-refresh-icon {
            width: 20px;
            height: 20px;
            color: var(--accent-primary);
            transition: transform 0.2s ease;
        }
        
        .pull-to-refresh.loading .pull-to-refresh-icon {
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <!-- Pull-to-Refresh Indicator -->
    <div class="pull-to-refresh" id="pullToRefresh">
        <svg class="pull-to-refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
    </div>
    
    <!-- Loading Screen with Real Logo -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">
                <img src="data:image/png;base64,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" alt="FYS" class="loading-logo-img">
            </div>
            <div class="loading-text">Do it for yourself!</div>
        </div>
    </div>

    <!-- Premium Loading Screen - Bitpanda Style -->

<div class="app-container">
        <!-- Header with Logo -->
        <div class="header">
            <div class="logo-fys-header">
                <img src="data:image/png;base64,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" alt="FYS" class="fys-logo-img">
            </div>
            
            <div class="header-progress-badges">
                <div class="progress-badge-compact incomplete" id="checkinBadge" onclick="openCheckIn()" title="Daily Check-In">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                        <polyline points="16 7 22 7 22 13"></polyline>
                    </svg>
                </div>
                <div class="progress-badge-compact incomplete" id="journalBadge" onclick="openJournal()" title="Tagebuch">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </div>
            </div>
            
            <div class="header-date" id="headerDate"></div>
        </div>

        <!-- Home View -->
        <div id="homeView" class="view-section active">
            <div class="home-content">
                
                <!-- Daily Check-in Widget (MOVED TO TOP) -->
                <div class="checkin-widget" onclick="openCheckIn()">
                    <div class="checkin-widget-header">
                        <div class="checkin-widget-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                        <div class="checkin-widget-info">
                            <div class="checkin-widget-title">Daily Check-In</div>
                            <div class="checkin-widget-subtitle" id="checkinWidgetSubtitle">Beantworte 8 Fragen zu deinem Tag</div>
                        </div>
                        <div class="checkin-widget-arrow">→</div>
                    </div>
                </div>
                
                <!-- Streak Display Card -->
                <div class="streak-card" id="streakCard" style="display: none;">
                    <div class="streak-card-content">
                        <div class="streak-flame">🔥</div>
                        <div class="streak-info">
                            <div class="streak-number" id="streakNumber">0</div>
                            <div class="streak-label">Tage Streak</div>
                            <div class="streak-sublabel">CheckIn + Tagebuch</div>
                        </div>
                        <div class="streak-record">
                            <div class="streak-record-label">Rekord</div>
                            <div class="streak-record-number" id="streakRecord">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="index-label">FYS-INDEX</div>

                <div class="time-selector">
                    <button class="time-btn" onclick="changeTimeRange('1d')" data-range="1d">1D</button>
                    <button class="time-btn" onclick="changeTimeRange('7d')" data-range="7d">7D</button>
                    <button class="time-btn" onclick="changeTimeRange('1m')" data-range="1m">1M</button>
                    <button class="time-btn" onclick="changeTimeRange('6m')" data-range="6m">6M</button>
                    <button class="time-btn" onclick="changeTimeRange('1y')" data-range="1y">1Y</button>
                    <button class="time-btn" onclick="changeTimeRange('all')" data-range="all">MAX</button>
                </div>

                <div class="main-chart-section" onclick="openChartDetails()">
                    <div class="main-chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                    <div class="index-value-display">
                        <div class="index-value-number" id="mainIndexValue">100.0</div>
                        <div class="index-change-text" id="mainChangeText"></div>
                    </div>
                    <div class="tap-hint" id="tapHint"></div>
                </div>

                <!-- Performance Packs Section -->
                <div class="performance-packs-container" id="performancePacksContainer" style="display: none;">
                    <div class="performance-packs-title">
                        PERFORMANCE PACKS
                        <span style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 800;">PRO</span>
                    </div>
                    <div id="performancePacksList"></div>
                </div>

            </div>
        </div>

        <!-- Chart Details View -->
        <div id="chartDetailsView" class="view-section">
            <div class="chart-details-view">
                <button class="back-button" onclick="closeChartDetails()">
                    ← <span id="backText">Zurück</span>
                </button>
                
                <!-- FYS Index Summary -->
                <div class="fys-index-summary">
                    <div class="fys-index-label">Your FYS Score</div>
                    <div class="fys-index-value" id="detailIndexValue">100.0</div>
                    <div class="fys-index-change" id="detailIndexChange">+0.00%</div>
                </div>

                <!-- Flatex-Style Stock List -->
                <div class="stock-list-container">
                    <div class="stock-list-header">
                        <div class="stock-list-title" id="categoriesOverview">Kategorien-Übersicht</div>
                    </div>
                    
                    <!-- Time Selector for Categories -->
                    <div class="time-selector" style="margin: 16px 0;">
                        <button class="time-btn" onclick="changeTimeRange('1d')" data-range="1d">
                            <span>1D</span>
                        </button>
                        <button class="time-btn" onclick="changeTimeRange('7d')" data-range="7d">
                            <span>7D</span>
                        </button>
                        <button class="time-btn" onclick="changeTimeRange('1m')" data-range="1m">
                            <span>1M</span>
                        </button>
                        <button class="time-btn" onclick="changeTimeRange('6m')" data-range="6m">
                            <span>6M</span>
                        </button>
                        <button class="time-btn" onclick="changeTimeRange('1y')" data-range="1y">
                            <span>1Y</span>
                        </button>
                        <button class="time-btn" onclick="changeTimeRange('all')" data-range="all">
                            <span>MAX</span>
                        </button>
                    </div>
                    
                    <div id="stockListItems"></div>
                </div>

                <!-- Combined Chart -->
                <div class="chart-card">
                    <div class="chart-title" id="allCategoriesTitle">Alle Kategorien</div>
                    <div class="chart-container">
                        <canvas id="combinedChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Check-in View mit Wizard -->
        <div id="checkinView" class="view-section">
            <!-- Confirmation Dialog -->
            <div class="wizard-confirm" id="wizardConfirm">
                <div class="confirm-content">
                    <div class="confirm-icon">📝</div>
                    <div class="confirm-title">Check-in für heute starten?</div>
                    <div class="confirm-subtitle" id="wizardConfirmSubtitle">Beantworte 8 kurze Fragen zu deinem Tag</div>
                    <div class="confirm-actions">
                        <button class="btn-secondary" onclick="cancelWizard()">Abbrechen</button>
                        <button class="btn-primary-wizard" onclick="startWizard()">Starten</button>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div class="wizard-error" id="wizardError">
                <div class="error-card">
                    <div class="error-icon">⚠️</div>
                    <div class="error-title">Check-in konnte nicht geladen werden</div>
                    <div class="error-message">Es gab ein Problem beim Laden der Fragen. Bitte versuche es erneut.</div>
                    <button class="error-retry-btn" onclick="retryWizard()">
                        Erneut versuchen
                    </button>
                </div>
            </div>

            <!-- Wizard Container -->
            <div class="wizard-container" id="wizardContainer">
                <!-- Header -->
                <div class="wizard-header">
                    <div class="header-top">
                        <button class="back-btn-wizard" id="backBtnWizard" disabled>←</button>
                        <div class="step-counter" id="stepCounter">Schritt 1/8</div>
                        <button class="close-btn-wizard" onclick="closeWizard()">×</button>
                    </div>
                    <div class="progress-container-wizard">
                        <div class="progress-bar-wizard" id="progressBarWizard"></div>
                    </div>
                    <div class="progress-dots" id="progressDots"></div>
                </div>

                <!-- Content -->
                <div class="wizard-content-area" id="wizardContent"></div>

                <!-- Actions -->
                <div class="wizard-actions">
                    <button class="btn-primary-wizard" id="nextBtnWizard">Weiter</button>
                </div>
            </div>
        </div>

        <!-- Habit Tracker View -->
        <div id="habitsView" class="view-section">
            <div class="tracker-content">
                <div class="section-title" id="habitsTitle"></div>
                <div class="coming-soon-screen">
                    <div class="coming-soon-icon">🎯</div>
                    <div class="coming-soon-title" id="habitComingTitle"></div>
                    <div class="coming-soon-text" id="habitComingText"></div>
                </div>
            </div>
        </div>

        <!-- Sober Tracker View -->
        <div id="soberView" class="view-section">
            <div class="tracker-content">
                <div class="section-title" id="soberTitle"></div>
                <div class="coming-soon-screen">
                    <div class="coming-soon-icon">🌟</div>
                    <div class="coming-soon-title" id="soberComingTitle"></div>
                    <div class="coming-soon-text" id="soberComingText"></div>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="view-section">
            <div class="settings-content">
                <div class="section-title" id="settingsTitle"></div>
                
                <div class="setting-item">
                    <div class="setting-label" id="languageLabel"></div>
                    <div class="setting-description" id="languageDesc"></div>
                    <div class="setting-options">
                        <div class="setting-option active" onclick="changeLanguage('de')" data-lang="de">Deutsch</div>
                        <div class="setting-option" onclick="changeLanguage('en')" data-lang="en">English</div>
                        <div class="setting-option" onclick="changeLanguage('es')" data-lang="es">Español</div>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label" id="themeLabel"></div>
                    <div class="setting-description" id="themeDesc"></div>
                    <div class="setting-options">
                        <div class="setting-option active" onclick="changeTheme('dark')" data-theme-btn="dark" id="darkTheme"></div>
                        <div class="setting-option" onclick="changeTheme('light')" data-theme-btn="light" id="lightTheme"></div>
                        <div class="setting-option" onclick="changeTheme('system')" data-theme-btn="system" id="systemTheme"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label" id="sleepGoalLabel"></div>
                    <div class="setting-description" id="sleepGoalDesc"></div>
                    <div class="sleep-goal-input">
                        <button class="sleep-goal-btn" onclick="adjustSleepGoal(-0.5)">−</button>
                        <div class="sleep-goal-value" id="sleepGoalValue">8.0h</div>
                        <button class="sleep-goal-btn" onclick="adjustSleepGoal(0.5)">+</button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label" id="coachDataLabel"></div>
                    <div class="setting-description" id="coachDataDesc"></div>
                    <div style="display: flex; justify-content: center; margin-top: 14px;">
                        <div class="toggle-switch" id="coachDataToggle" onclick="toggleCoachData()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <!-- Pro Toggle -->
                <div class="setting-item" style="text-align: center;">
                    <div class="setting-label">🌟 FYS Pro</div>
                    <div class="setting-description" id="proStatusDesc">Performance Packs & Advanced Features</div>
                    <button onclick="togglePro()" id="proToggleBtn" style="
                        width: 100%;
                        margin-top: 16px;
                        padding: 14px;
                        background: linear-gradient(135deg, #ff6b35, #ff8f5f);
                        border: none;
                        border-radius: 12px;
                        color: #000;
                        font-size: 15px;
                        font-weight: 700;
                        cursor: pointer;
                        font-family: inherit;
                        transition: all 0.3s;
                    ">Activate FYS Pro</button>
                </div>

                <!-- Test Mode (TEMPORARY - Remove in Production) -->
                <div class="setting-item" style="text-align: center; border: 2px dashed var(--accent-primary); border-radius: 12px; padding: 16px;">
                    <div class="setting-label">🧪 TEST MODE</div>
                    <div class="setting-description">Erlaube mehrere Check-Ins pro Tag (nur zum Testen)</div>
                    <div style="display: flex; justify-content: center; margin-top: 14px;">
                        <div class="toggle-switch" id="testModeToggle" onclick="toggleTestMode()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 12px; color: var(--text-tertiary); font-style: italic;">
                        ⚠️ Nur für Entwicklung & Testing
                    </div>
                </div>

                <!-- Reset Data -->
                <div class="setting-item" style="text-align: center;">
                    <div class="setting-label">🔄 Daten zurücksetzen</div>
                    <div class="setting-description">Setze alle Werte auf 100 und starte neu ab heute</div>
                    <button onclick="resetData()" style="
                        width: 100%;
                        margin-top: 16px;
                        padding: 14px;
                        background: var(--bg-card);
                        border: 1px solid var(--border);
                        border-radius: 12px;
                        color: var(--text-primary);
                        font-size: 15px;
                        font-weight: 600;
                        cursor: pointer;
                        font-family: inherit;
                        transition: all 0.3s;
                    ">Neu starten (alle Daten löschen)</button>
                </div>

                <!-- Performance Packs Management -->
                <div id="performancePacksSettings" style="display: none;">
                    <div class="setting-item">
                        <div class="setting-label">📊 Performance Packs</div>
                        <div class="setting-description">Wähle bis zu 2 Packs aus (aktiv: <span id="activePacksCount">0</span>/2)</div>
                    </div>

                    <div id="packSettingsList"></div>
                </div>
            </div>
        </div>

        <!-- Tools View (NEW) -->
        <div id="toolsView" class="view-section">
            <div class="content-container">
                <!-- TOOLS SECTION -->
                <div class="section-title">🛠️ Tools</div>
                
                <!-- Tagebuch (Journal) -->
                <div class="tool-card" onclick="openJournal()">
                    <div class="tool-icon">📔</div>
                    <div class="tool-info">
                        <div class="tool-title">Tagebuch</div>
                        <div class="tool-description">Dokumentiere deine Gedanken</div>
                    </div>
                </div>
                
                <!-- Task Manager -->
                <div class="tool-card" onclick="openTaskManager()">
                    <div class="tool-icon">✓</div>
                    <div class="tool-info">
                        <div class="tool-title">Task Manager</div>
                        <div class="tool-description">Verwalte deine Aufgaben</div>
                    </div>
                    <div class="pro-badge-small">PRO</div>
                </div>
                
                <!-- Habit Tracker -->
                <div class="tool-card" onclick="openHabitTracker()">
                    <div class="tool-icon">🎯</div>
                    <div class="tool-info">
                        <div class="tool-title">Habit Tracker</div>
                        <div class="tool-description">Tracke deine Gewohnheiten</div>
                    </div>
                    <div class="pro-badge-small">PRO</div>
                </div>
                
                <!-- Sober Tracker -->
                <div class="tool-card" onclick="openSoberTracker()">
                    <div class="tool-icon">🌟</div>
                    <div class="tool-info">
                        <div class="tool-title">Sober Tracker</div>
                        <div class="tool-description">Verfolge deine Erfolge</div>
                    </div>
                    <div class="pro-badge-small">PRO</div>
                </div>

                <!-- FEATURES SECTION -->
                <div class="section-title" style="margin-top: 32px;">✨ Features</div>
                
                <!-- Performance Report -->
                <div class="tool-card" onclick="openPerformanceReport()">
                    <div class="tool-icon">📊</div>
                    <div class="tool-info">
                        <div class="tool-title">Performance Report</div>
                        <div class="tool-description">Export detailed PDF report</div>
                    </div>
                    <div class="pro-badge-small">PRO</div>
                </div>
                
                <!-- Data & Statistics -->
                <div class="tool-card" onclick="openStatistics()">
                    <div class="tool-icon">📈</div>
                    <div class="tool-info">
                        <div class="tool-title">Data & Statistics</div>
                        <div class="tool-description">Detailed analytics dashboard</div>
                    </div>
                    <div class="pro-badge-small">PRO</div>
                </div>
                
                <!-- Pro Features Overview -->
                <div class="tool-card" onclick="openProFeatures()">
                    <div class="tool-icon">⭐</div>
                    <div class="tool-info">
                        <div class="tool-title">Pro Features</div>
                        <div class="tool-description">View all premium features</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="success-toast" id="successToast"></div>
    </div>

    <!-- Upgrade Modal (NEW) -->
    <div class="upgrade-modal" id="upgradeModal">
        <div class="upgrade-content">
            <button class="close-btn" onclick="closeUpgradeModal()">×</button>
            <div class="upgrade-icon">⭐</div>
            <div class="upgrade-title">Upgrade to FYS Pro</div>
            <div class="upgrade-description">
                Unlock Performance Packs, PDF Reports, and Advanced Analytics
            </div>
            <div class="upgrade-features">
                <div class="upgrade-feature">✓ 3 Performance Packs</div>
                <div class="upgrade-feature">✓ PDF Export</div>
                <div class="upgrade-feature">✓ Advanced Statistics</div>
                <div class="upgrade-feature">✓ Unlimited History</div>
            </div>
            <button class="upgrade-btn" onclick="activateProFromModal()">
                Activate Pro Now
            </button>
        </div>
    </div>

    <!-- Bottom Navigation - Pushup Style (Floating Pill) -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchView('home')" data-view="home">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <div class="nav-label" id="navHome">Start</div>
        </button>
        <button class="nav-item" onclick="switchView('tools')" data-view="tools">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
            <div class="nav-label" id="navTools">Tools</div>
        </button>
        <button class="nav-item" onclick="switchToCoach()" data-view="coach">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <div class="nav-label" id="navCoach">Coach</div>
        </button>
        <button class="nav-item" onclick="switchView('settings')" data-view="settings">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6M12 17v6M3.93 3.93l4.24 4.24M15.83 15.83l4.24 4.24M1 12h6M17 12h6M3.93 20.07l4.24-4.24M15.83 8.17l4.24-4.24"></path>
            </svg>
            <div class="nav-label" id="navSettings">Einstellungen</div>
        </button>
    </div>

    <!-- Floating Check-in Button (Apple Trading Style) -->
    <!-- AI Coach Modal -->
    <div class="coach-modal" id="coachModal">
        <div class="coach-header">
            <div class="coach-title" id="coachTitle"></div>
            <button class="close-btn" onclick="closeCoach()">×</button>
        </div>
        <div class="coach-content" id="coachContent"></div>
        <div class="coach-input-area">
            <div class="coach-input-wrapper">
                <input type="text" class="coach-input" id="coachInput" onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="send-btn" onclick="sendMessage()" id="sendBtn">➤</button>
            </div>
        </div>
    </div>

    <!-- Category Detail Modal -->
    <div class="category-detail-modal" id="categoryDetailModal">
        <div class="category-detail-header">
            <button class="close-btn" onclick="closeCategoryDetail()">×</button>
            <div class="category-detail-icon" id="categoryDetailIcon"></div>
            <div class="category-detail-info">
                <div class="category-detail-name" id="categoryDetailName"></div>
                <div class="category-detail-symbol" id="categoryDetailSymbol"></div>
            </div>
        </div>
        <div class="category-detail-content">
            <div class="category-detail-price-section">
                <div class="category-detail-price" id="categoryDetailPrice">100.0</div>
                <div class="category-detail-change positive" id="categoryDetailChange">
                    <span>▲</span> +0.0%
                </div>
            </div>

            <div class="category-time-selector">
                <button class="category-time-btn" onclick="changeCategoryTimeRange('1d')" data-cat-range="1d">1D</button>
                <button class="category-time-btn" onclick="changeCategoryTimeRange('7d')" data-cat-range="7d">7D</button>
                <button class="category-time-btn" onclick="changeCategoryTimeRange('1m')" data-cat-range="1m">1M</button>
                <button class="category-time-btn" onclick="changeCategoryTimeRange('6m')" data-cat-range="6m">6M</button>
                <button class="category-time-btn" onclick="changeCategoryTimeRange('1y')" data-cat-range="1y">1Y</button>
                <button class="category-time-btn" onclick="changeCategoryTimeRange('all')" data-cat-range="all">MAX</button>
            </div>

            <div class="category-chart-card">
                <div class="category-chart-container">
                    <canvas id="categoryDetailChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Journal Modal -->
    <div class="journal-modal" id="journalModal">
        <div class="journal-header">
            <div class="journal-title">📔 Tagebuch</div>
            <button class="close-btn" onclick="closeJournal()">×</button>
        </div>
        <div class="journal-content">
            <div class="journal-calendar">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="changeMonth(-1)">‹</button>
                    <div class="calendar-month" id="calendarMonth"></div>
                    <button class="calendar-nav-btn" onclick="changeMonth(1)">›</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
    </div>
    
    <!-- Journal Entry Popup (außerhalb des Kalenders) -->
    <div class="journal-entry-backdrop" id="journalEntryBackdrop" onclick="closeJournalEntry()"></div>
    <div class="journal-entry-section" id="journalEntrySection">
        <div class="journal-entry-date" id="journalEntryDate"></div>
        <textarea class="journal-textarea" id="journalTextarea" placeholder="Schreibe deine Gedanken..."></textarea>
        <button class="journal-save-btn" onclick="saveJournalEntry()">Speichern</button>
    </div>

    <!-- Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-dialog">
            <div class="confirm-icon" id="confirmIcon">⚠️</div>
            <div class="confirm-title" id="confirmTitle">Bestätigung erforderlich</div>
            <div class="confirm-message" id="confirmMessage">Sind Sie sicher?</div>
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-btn-cancel" onclick="closeConfirmModal()">Abbrechen</button>
                <button class="confirm-btn confirm-btn-confirm" id="confirmButton" onclick="confirmAction()">Bestätigen</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SAFE DOM HELPERS (Prevents null errors)
        // ============================================
        function safeSetHTML(selector, html) {
            const el = typeof selector === 'string' ? document.querySelector(selector) : selector;
            if (!el) {
                console.warn(`[SafeHTML] Element not found:`, selector);
                return false;
            }
            el.innerHTML = html;
            return true;
        }

        function safeGetElement(id) {
            const el = document.getElementById(id);
            if (!el) console.warn(`[SafeDOM] Element not found: #${id}`);
            return el;
        }

        // ============================================
        // TRANSLATIONS
        // ============================================
        // Translations
        const translations = {
            de: {
                headerDate: '',
                tapHint: 'Tippen für Details',
                backText: 'Zurück',
                allCategoriesTitle: 'Alle Kategorien',
                categoriesOverview: 'Kategorien-Übersicht',
                checkinTitle: 'Täglicher Check-in',
                checkinDone: 'Check-in für',
                checkinDoneText: 'bereits erledigt! Du kannst deine Kursänderung schon ansehen.',
                checkinDoneSub: 'Wir sehen uns morgen wieder! 🚀',
                editCheckin: 'Ändern',
                sleepQuestion: 'Wie viele Stunden hast du geschlafen?',
                taskWidgetTitle: 'Task Manager',
                comingSoonBadge: 'Bald verfügbar',
                habitsTitle: 'Habit Tracker',
                soberTitle: 'Sober Tracker',
                habitWidgetTitle: 'Habit Tracker',
                habitStreakLabel: 'Streak',
                habitTodayLabel: 'Heute',
                soberWidgetTitle: 'Sober Tracker',
                soberDaysLabel: 'Tage',
                soberStreakLabel: 'Streak',
                habitComingTitle: 'Bald verfügbar',
                habitComingText: 'Der Habit Tracker wird in Kürze freigeschaltet.',
                soberComingTitle: 'Bald verfügbar',
                soberComingText: 'Der Sober Tracker wird in Kürze freigeschaltet.',
                settingsTitle: 'Einstellungen',
                languageLabel: 'Sprache',
                languageDesc: 'Wähle deine bevorzugte App-Sprache.',
                themeLabel: 'Design',
                themeDesc: 'Wähle zwischen hellem und dunklem Modus.',
                darkTheme: 'Dunkel',
                lightTheme: 'Hell',
                systemTheme: 'Automatisch',
                sleepGoalLabel: 'Schlafziel',
                sleepGoalDesc: 'Dein ideales Schlafziel pro Nacht. Beeinflusst deine Energie-Kategorie.',
                coachDataLabel: 'KI-Coach Datenzugriff',
                coachDataDesc: 'Erlaube dem Coach deine Werte zu sehen.',
                navHome: 'Start',
                navCheckin: 'Check-in',
                navCoach: 'Coach',
                navSettings: 'Einstellungen',
                coachTitle: 'FYS Coach',
                coachPlaceholder: 'Stelle eine Frage...',
                coachWelcome: 'Hey! 👋 Wie kann ich dir helfen?',
                submitBtn: 'Speichern',
                successToast: '✓ Gespeichert!',
                categories: {
                    social: 'Soziale Kontakte',
                    energy: 'Energie/Erholung',
                    focus: 'Fokus/Produktivität',
                    discipline: 'Disziplin',
                    sport: 'Bewegung/Sport',
                    nutrition: 'Ernährung',
                    mindset: 'Stimmung/Mindset'
                }
            },
            en: {
                headerDate: '',
                tapHint: 'Tap for details',
                backText: 'Back',
                allCategoriesTitle: 'All Categories',
                categoriesOverview: 'Categories Overview',
                checkinTitle: 'Daily Check-in',
                checkinDone: 'Check-in for',
                checkinDoneText: 'already complete! You can view your progress.',
                checkinDoneSub: 'See you tomorrow! 🚀',
                editCheckin: 'Edit',
                sleepQuestion: 'How many hours did you sleep?',
                taskWidgetTitle: 'Task Manager',
                comingSoonBadge: 'Coming Soon',
                habitsTitle: 'Habit Tracker',
                soberTitle: 'Sober Tracker',
                habitWidgetTitle: 'Habit Tracker',
                habitStreakLabel: 'Streak',
                habitTodayLabel: 'Today',
                soberWidgetTitle: 'Sober Tracker',
                soberDaysLabel: 'Days',
                soberStreakLabel: 'Streak',
                habitComingTitle: 'Coming Soon',
                habitComingText: 'The Habit Tracker will be available soon.',
                soberComingTitle: 'Coming Soon',
                soberComingText: 'The Sober Tracker will be available soon.',
                settingsTitle: 'Settings',
                languageLabel: 'Language',
                languageDesc: 'Choose your preferred app language.',
                themeLabel: 'Theme',
                themeDesc: 'Choose between light and dark mode.',
                darkTheme: 'Dark',
                lightTheme: 'Light',
                systemTheme: 'Automatic',
                sleepGoalLabel: 'Sleep Goal',
                sleepGoalDesc: 'Your ideal sleep goal per night. Influences your energy category.',
                coachDataLabel: 'AI Coach Data Access',
                coachDataDesc: 'Allow coach to see your values.',
                navHome: 'Home',
                navCheckin: 'Check-in',
                navCoach: 'Coach',
                navSettings: 'Settings',
                coachTitle: 'FYS Coach',
                coachPlaceholder: 'Ask a question...',
                coachWelcome: 'Hey! 👋 How can I help you?',
                submitBtn: 'Save',
                successToast: '✓ Saved!',
                categories: {
                    social: 'Social Contacts',
                    energy: 'Energy/Recovery',
                    focus: 'Focus/Productivity',
                    discipline: 'Discipline',
                    sport: 'Movement/Sport',
                    nutrition: 'Nutrition',
                    mindset: 'Mood/Mindset'
                }
            },
            es: {
                headerDate: '',
                tapHint: 'Toca para detalles',
                backText: 'Atrás',
                allCategoriesTitle: 'Todas las Categorías',
                categoriesOverview: 'Resumen de Categorías',
                checkinTitle: 'Check-in Diario',
                checkinDone: 'Check-in para',
                checkinDoneText: '¡ya completo! Puedes ver tu progreso.',
                checkinDoneSub: '¡Hasta mañana! 🚀',
                editCheckin: 'Editar',
                sleepQuestion: '¿Cuántas horas dormiste?',
                taskWidgetTitle: 'Gestor de Tareas',
                comingSoonBadge: 'Próximamente',
                habitsTitle: 'Rastreador de Hábitos',
                soberTitle: 'Rastreador de Sobriedad',
                habitWidgetTitle: 'Hábitos',
                habitStreakLabel: 'Racha',
                habitTodayLabel: 'Hoy',
                soberWidgetTitle: 'Sobriedad',
                soberDaysLabel: 'Días',
                soberStreakLabel: 'Racha',
                habitComingTitle: 'Próximamente',
                habitComingText: 'El Rastreador de Hábitos estará disponible pronto.',
                soberComingTitle: 'Próximamente',
                soberComingText: 'El Rastreador de Sobriedad estará disponible pronto.',
                settingsTitle: 'Configuración',
                languageLabel: 'Idioma',
                languageDesc: 'Elige tu idioma preferido para la aplicación.',
                themeLabel: 'Tema',
                themeDesc: 'Elige entre modo claro y oscuro.',
                darkTheme: 'Oscuro',
                lightTheme: 'Claro',
                systemTheme: 'Automático',
                sleepGoalLabel: 'Objetivo de Sueño',
                sleepGoalDesc: 'Tu objetivo ideal de sueño por noche. Influye en tu categoría de energía.',
                coachDataLabel: 'Acceso a Datos del Coach',
                coachDataDesc: 'Permite al coach ver tus valores.',
                navHome: 'Inicio',
                navCheckin: 'Check-in',
                navCoach: 'Coach',
                navSettings: 'Ajustes',
                coachTitle: 'Coach FYS',
                coachPlaceholder: 'Haz una pregunta...',
                coachWelcome: '¡Hola! 👋 ¿Cómo puedo ayudarte?',
                submitBtn: 'Guardar',
                successToast: '✓ ¡Guardado!',
                categories: {
                    social: 'Contactos Sociales',
                    energy: 'Energía/Recuperación',
                    focus: 'Enfoque/Productividad',
                    discipline: 'Disciplina',
                    sport: 'Movimiento/Deporte',
                    nutrition: 'Nutrición',
                    mindset: 'Estado de Ánimo'
                }
            }
        };

        // App State
        let currentLang = localStorage.getItem('fysLanguage') || 'de';
        let currentTheme = localStorage.getItem('fysTheme') || 'dark';
        
        // Apply initial theme
        (function applyInitialTheme() {
            let actualTheme = currentTheme;
            if (currentTheme === 'system') {
                actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            document.documentElement.setAttribute('data-theme', actualTheme);
            document.body.className = actualTheme;
        })();
        
        let currentTimeRange = '1m';
        let sleepGoal = parseFloat(localStorage.getItem('fysSleepGoal')) || 8.0;
        let sleepHours = 8.0;
        let coachDataAccess = localStorage.getItem('fysCoachData') === 'true';
        let isPro = localStorage.getItem('fysPro') === 'true'; // Pro status
        let testMode = localStorage.getItem('fysTestMode') === 'true'; // Test Mode für unbegrenzte CheckIns
        let performanceData = JSON.parse(localStorage.getItem('fysData')) || { entries: [], activePacks: [] };
        let currentStreak = parseInt(localStorage.getItem('fysStreak')) || 0; // Aktuelle Streak
        let longestStreak = parseInt(localStorage.getItem('fysLongestStreak')) || 0; // Längste Streak
        
        // Ensure activePacks exists in loaded data
        if (!performanceData.activePacks) {
            performanceData.activePacks = [];
        }
        
        let mainChart = null;
        let combinedChart = null;
        let individualCharts = {};

        const categories = [
            { id: 'social', color: '#ffd700' },
            { id: 'energy', color: '#00ff88' },
            { id: 'focus', color: '#ff6b35' },
            { id: 'discipline', color: '#a8a8a8' },
            { id: 'sport', color: '#ff4757' },
            { id: 'nutrition', color: '#00d4ff' },
            { id: 'mindset', color: '#5f7aff' }
        ];

        // ========== PERFORMANCE PACKS DATA ==========
        const performancePacks = [
            {
                id: 'finance',
                name: 'Finance Pack',
                icon: '💰',
                description: 'Track your financial health and wealth building',
                categories: [
                    { id: 'savings', name: { de: 'Ersparnisse', en: 'Savings', es: 'Ahorros' }, emoji: '💵', color: '#2ecc71', isPro: true },
                    { id: 'investments', name: { de: 'Investitionen', en: 'Investments', es: 'Inversiones' }, emoji: '📈', color: '#3498db', isPro: true },
                    { id: 'budget', name: { de: 'Budget-Disziplin', en: 'Budget Discipline', es: 'Disciplina Presupuestaria' }, emoji: '🎯', color: '#e74c3c', isPro: true },
                    { id: 'income', name: { de: 'Einkommenswachstum', en: 'Income Growth', es: 'Crecimiento de Ingresos' }, emoji: '💼', color: '#f39c12', isPro: true },
                    { id: 'financial_education', name: { de: 'Finanzbildung', en: 'Financial Education', es: 'Educación Financiera' }, emoji: '📚', color: '#9b59b6', isPro: true }
                ]
            },
            {
                id: 'health',
                name: 'Health Pack',
                icon: '🏥',
                description: 'Monitor your physical and mental wellness',
                categories: [
                    { id: 'cardio', name: { de: 'Ausdauer', en: 'Cardio Fitness', es: 'Fitness Cardiovascular' }, emoji: '🏃', color: '#e67e22', isPro: true },
                    { id: 'strength', name: { de: 'Krafttraining', en: 'Strength Training', es: 'Entrenamiento de Fuerza' }, emoji: '💪', color: '#c0392b', isPro: true },
                    { id: 'flexibility', name: { de: 'Flexibilität', en: 'Flexibility', es: 'Flexibilidad' }, emoji: '🧘', color: '#1abc9c', isPro: true },
                    { id: 'mental_health', name: { de: 'Mentale Gesundheit', en: 'Mental Health', es: 'Salud Mental' }, emoji: '🧠', color: '#8e44ad', isPro: true }
                ]
            },
            {
                id: 'entrepreneurship',
                name: 'Entrepreneurship Pack',
                icon: '🚀',
                description: 'Build and scale your business ventures',
                categories: [
                    { id: 'networking', name: { de: 'Networking', en: 'Networking', es: 'Networking' }, emoji: '🤝', color: '#16a085', isPro: true },
                    { id: 'product_development', name: { de: 'Produktentwicklung', en: 'Product Development', es: 'Desarrollo de Producto' }, emoji: '🛠️', color: '#2980b9', isPro: true },
                    { id: 'marketing', name: { de: 'Marketing', en: 'Marketing', es: 'Marketing' }, emoji: '📣', color: '#d35400', isPro: true },
                    { id: 'sales', name: { de: 'Vertrieb', en: 'Sales', es: 'Ventas' }, emoji: '💸', color: '#27ae60', isPro: true },
                    { id: 'leadership', name: { de: 'Führung', en: 'Leadership', es: 'Liderazgo' }, emoji: '👑', color: '#8e44ad', isPro: true }
                ]
            }
        ];

        // KORRIGIERTE BERECHNUNGEN - EINFACH UND KLAR
        function calculateFYSIndex(values, previousIndex = 100) {
            // Durchschnitt aller Kategorien
            let sum = 0;
            categories.forEach(cat => {
                sum += values[cat.id] || 5;
            });
            
            const average = sum / 7;
            const dailyChange = average - 5;
            const newIndex = previousIndex + dailyChange;
            
            return Math.max(0, newIndex);
        }

        function calculateCategoryValue(checkInValue, previousValue = 100) {
            const value = parseInt(checkInValue) || 5;
            const dailyChange = value - 5;
            const newValue = previousValue + dailyChange;
            
            return Math.max(0, newValue);
        }

        // Berechne prozentuale Änderung zum Vortag
        function calculateDailyChangePercent(currentValue, previousValue) {
            if (previousValue === 0) return 0;
            return ((currentValue - previousValue) / previousValue) * 100;
        }

        // Schlaf-Bonus Berechnung
        function calculateSleepBonus(sleepHours, sleepGoal) {
            const difference = sleepHours - sleepGoal;
            
            // Für jede halbe Stunde Abweichung: ±0.25
            // Beispiele (bei 8h Ziel):
            // 8.0h → 0.0 → 0
            // 7.5h → -0.5 → -0.25
            // 7.0h → -1.0 → -0.5
            // 6.0h → -2.0 → -1.0
            // 4.0h → -4.0 → -2.0
            // 0.0h → -8.0 → -4.0
            // 9.0h → +1.0 → +0.5
            // 10.0h → +2.0 → +1.0
            
            const bonus = (difference / 0.5) * 0.25;
            
            console.log(`Sleep Bonus: ${sleepHours}h sleep, ${sleepGoal}h goal → difference: ${difference}h → bonus: ${bonus}`);
            
            return bonus;
        }

        // Get today's entry (für Testing: immer neuer Tag)
        function getTodayEntry() {
            // Für Testing: Return immer null, damit jeder Check-in ein neuer Tag ist
            return null;
        }

        // Format date
        function formatDate(date) {
            const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
            const months = ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'];
            return `${days[date.getDay()]}, ${date.getDate()}. ${months[date.getMonth()]}`;
        }

        // Update header date
        function updateHeaderDate() {
            const date = new Date();
            document.getElementById('headerDate').textContent = formatDate(date);
        }

        // Adjust sleep goal
        function adjustSleepGoal(amount) {
            sleepGoal = Math.max(4, Math.min(12, sleepGoal + amount));
            localStorage.setItem('fysSleepGoal', sleepGoal);
            document.getElementById('sleepGoalValue').textContent = sleepGoal.toFixed(1) + 'h';
        }

        // Adjust sleep hours
        function adjustSleepHours(amount) {
            sleepHours = Math.max(0, Math.min(16, sleepHours + amount));
            document.getElementById('sleepHoursValue').textContent = sleepHours.toFixed(1) + 'h';
        }

        // Update check-in view
        function updateCheckinView() {
            const t = translations[currentLang];
            const container = document.getElementById('checkinContainer');
            const todayEntry = getTodayEntry();
            
            if (todayEntry && !container.querySelector('#checkinForm')) {
                const today = new Date();
                container.innerHTML = `
                    <div class="checkin-status">
                        <div class="status-icon">✓</div>
                        <div class="status-title">${t.checkinDone} ${formatDate(today)}</div>
                        <div class="status-subtitle">${t.checkinDoneText}</div>
                        <button class="edit-btn" onclick="editCheckin()">${t.editCheckin}</button>
                        <div style="margin-top: 16px; font-size: 13px; color: var(--text-secondary);">${t.checkinDoneSub}</div>
                    </div>
                `;
            } else if (!todayEntry) {
                container.innerHTML = '<div id="checkinForm"></div>';
                updateCheckinForm();
            }
        }

        // Edit check-in
        function editCheckin() {
            const container = document.getElementById('checkinContainer');
            container.innerHTML = '<div id="checkinForm"></div>';
            updateCheckinForm();
        }

        // Update check-in form
        function updateCheckinForm() {
            const t = translations[currentLang];
            const form = document.getElementById('checkinForm');
            const todayEntry = getTodayEntry();
            
            form.innerHTML = '';
            
            const categoryIcons = {
                social: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                energy: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
                focus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
                discipline: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
                sport: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
                nutrition: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>`,
                mindset: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>`
            };
            
            // Regular categories with Icons
            categories.forEach(cat => {
                const value = (todayEntry && todayEntry.values && todayEntry.values[cat.id]) ? todayEntry.values[cat.id] : 10;
                form.innerHTML += `
                    <div class="category-input">
                        <div class="category-label">
                            <div class="input-category-name">
                                <div class="input-category-icon" style="background: ${cat.color}20; color: ${cat.color};">
                                    ${categoryIcons[cat.id]}
                                </div>
                                ${t.categories[cat.id]}
                            </div>
                            <div class="category-value-display" id="${cat.id}Value">${value}</div>
                        </div>
                        <input type="range" min="1" max="10" value="${value}" class="slider" id="${cat.id}Slider">
                    </div>
                `;
            });
            
            // Sleep input (last)
            const sleepValue = todayEntry ? todayEntry.sleepHours : 8.0;
            sleepHours = sleepValue;
            form.innerHTML += `
                <div class="sleep-input">
                    <div class="sleep-label">😴 ${t.sleepQuestion}</div>
                    <div class="sleep-value-display" id="sleepHoursValue">${sleepValue.toFixed(1)}h</div>
                    <div class="sleep-controls">
                        <button class="sleep-btn" onclick="adjustSleepHours(-0.5)">−</button>
                        <button class="sleep-btn" onclick="adjustSleepHours(0.5)">+</button>
                    </div>
                </div>
            `;
            
            form.innerHTML += `<button class="submit-btn" onclick="submitCheckIn()">${t.submitBtn}</button>`;
            initSliders();
        }

        // Initialize sliders
        function initSliders() {
            categories.forEach(cat => {
                const slider = document.getElementById(`${cat.id}Slider`);
                const value = document.getElementById(`${cat.id}Value`);
                
                if (slider && value) {
                    slider.addEventListener('input', function() {
                        value.textContent = this.value;
                    });
                }
            });
        }

        // Submit check-in
        function submitCheckIn() {
            console.log('=== CHECK-IN START ===');
            console.log('Categories:', categories);
            console.log('performanceData:', performanceData);
            
            try {
                // 1. Werte von Slidern sammeln
                const values = {};
                
                console.log('Collecting slider values...');
                categories.forEach(cat => {
                    console.log(`Looking for slider: ${cat.id}Slider`);
                    const slider = document.getElementById(`${cat.id}Slider`);
                    console.log(`Found slider for ${cat.id}:`, slider);
                    
                    if (slider) {
                        values[cat.id] = parseInt(slider.value);
                        console.log(`Set ${cat.id} = ${values[cat.id]}`);
                    } else {
                        values[cat.id] = 5;
                        console.log(`Default ${cat.id} = 5`);
                    }
                });
                
                console.log('Final values:', values);

                // 2. Prüfen ob erster Eintrag
                const isFirstEntry = performanceData.entries.length === 0;
                console.log('Is first entry?', isFirstEntry);
                
                // 3. Datum bestimmen
                let entryDate;
                if (isFirstEntry) {
                    entryDate = new Date();
                } else {
                    const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                    entryDate = new Date(lastEntry.date);
                    entryDate.setDate(entryDate.getDate() + 1);
                }
                console.log('Entry date:', entryDate);

                // 4. Berechnung
                let fysIndex;
                const categoryValues = {};
                
                if (isFirstEntry) {
                    console.log('FIRST ENTRY - Setting everything to 100');
                    // ERSTER CHECK-IN: Alles auf 100
                    fysIndex = 100;
                    categories.forEach(cat => {
                        categoryValues[cat.id] = 100;
                    });
                } else {
                    console.log('SUBSEQUENT ENTRY - Calculating');
                    // FOLGENDE CHECK-INS: Berechnen
                    const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                    console.log('Last entry:', lastEntry);
                    
                    console.log('Calling calculateFYSIndex with:', values, lastEntry.fysIndex);
                    fysIndex = calculateFYSIndex(values, lastEntry.fysIndex);
                    console.log('Calculated FYS Index:', fysIndex);
                    
                    categories.forEach(cat => {
                        const prevValue = lastEntry.categoryValues[cat.id] || 100;
                        categoryValues[cat.id] = calculateCategoryValue(values[cat.id], prevValue);
                        console.log(`Category ${cat.id}: ${prevValue} -> ${categoryValues[cat.id]}`);
                    });
                }

                console.log('Final FYS Index:', fysIndex);
                console.log('Final category values:', categoryValues);

                // 5. Speichern
                const newEntry = {
                    date: entryDate.toISOString(),
                    values: values,
                    categoryValues: categoryValues,
                    sleepHours: sleepHours,
                    fysIndex: fysIndex
                };
                
                console.log('New entry to save:', newEntry);
                performanceData.entries.push(newEntry);
                localStorage.setItem('fysData', JSON.stringify(performanceData));
                console.log('Saved to localStorage');

                // 6. UI Update - Better feedback
                const toast = document.getElementById('successToast');
                if (toast) {
                    toast.textContent = '✓ Gespeichert!';
                    toast.classList.add('show');
                }
                
                // Wait longer for user to see the toast, then reload
                setTimeout(() => {
                    console.log('Reloading page...');
                    location.reload();
                }, 2500);
                
                console.log('=== CHECK-IN SUCCESS ===');
                
            } catch (error) {
                console.error('=== CHECK-IN ERROR ===');
                console.error('Error:', error);
                console.error('Stack:', error.stack);
                alert('Fehler beim Speichern: ' + error.message);
            }
        }

        // Show toast
        function showToast() {
            const toast = document.getElementById('successToast');
            const t = translations[currentLang];
            toast.textContent = t.successToast;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Initialize main chart
        function initMainChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'FYS-Index',
                        data: [],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: currentTheme === 'dark' ? 'rgba(17, 17, 17, 0.95)' : 'rgba(255, 255, 255, 0.98)',
                            titleColor: currentTheme === 'dark' ? '#ffffff' : '#ff6b35',
                            bodyColor: currentTheme === 'dark' ? '#6b6b6b' : '#ff8f5f',
                            borderColor: currentTheme === 'dark' ? '#1a1a1a' : '#ffe8e0',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                // Zeige nur den Wert (ohne "FYS-Index:")
                                title: function(context) {
                                    return context[0].parsed.y.toFixed(1);
                                },
                                // Zeige Datum als Body (unten)
                                label: function(context) {
                                    return context.label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { display: false }
                        },
                        y: {
                            // Auto-Scale für Trading-Platform-Look
                            beginAtZero: false,
                            grace: '5%', // 5% Padding oben und unten für bessere Sicht
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 },
                                padding: 5
                            }
                        }
                    }
                }
            });
        }

        // Update main chart
        function updateMainChart() {
            console.log('updateMainChart called');
            console.log('mainChart exists?', !!mainChart);
            console.log('entries count:', performanceData.entries.length);
            
            if (!mainChart) {
                console.log('mainChart is null, skipping chart update');
                return;
            }
            
            if (performanceData.entries.length === 0) {
                console.log('No entries - showing starting point at 100');
                
                // Zeige Startpunkt bei 100
                const today = new Date();
                const todayLabel = `${today.getDate()}.${today.getMonth()+1}.${today.getFullYear()}`;
                mainChart.data.labels = [todayLabel];
                mainChart.data.datasets[0].data = [100];
                mainChart.update('none');
                
                // Zeige 100.0 als aktuellen Wert
                const valueEl = document.getElementById('mainIndexValue');
                if (valueEl) {
                    valueEl.textContent = '100.0';
                    valueEl.className = 'index-value-number';
                }
                
                // Keine Prozent-Änderung anzeigen (leer lassen)
                const changeText = document.getElementById('mainChangeText');
                if (changeText) {
                    changeText.textContent = '';
                }
                
                return;
            }

            const entries = getFilteredEntries();
            console.log('Filtered entries:', entries.length);
            
            if (mainChart) {
                let chartLabels = [];
                let chartData = [];
                
                if (entries.length === 0) {
                    // Wenn keine Entries, zeige Startpunkt bei 100
                    const today = new Date();
                    const startLabel = `${today.getDate()}.${today.getMonth()+1}.${today.getFullYear()}`;
                    chartLabels = [startLabel];
                    chartData = [100];
                } else if (performanceData.entries.length === 1) {
                    // ALLERERSTER ENTRY: Zeige 100 → Entry
                    const today = new Date();
                    const startLabel = `${today.getDate()}.${today.getMonth()+1}.${today.getFullYear()}`;
                    chartLabels.push(startLabel);
                    chartData.push(100);
                    
                    // Dann der erste Entry
                    const e = entries[0];
                    const date = new Date(e.date);
                    const label = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                    chartLabels.push(label);
                    chartData.push(e.fysIndex);
                    
                    console.log('First entry ever: showing 100 → entry');
                } else {
                    // Normale Entries: Zeige NUR die gefilterten Entries
                    entries.forEach(e => {
                        const date = new Date(e.date);
                        const label = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                        chartLabels.push(label);
                        chartData.push(e.fysIndex);
                    });
                }
                
                mainChart.data.labels = chartLabels;
                mainChart.data.datasets[0].data = chartData;
                mainChart.update('none');
                console.log('Chart updated with', chartData.length, 'points');
            }

            if (entries.length > 0) {
                const latest = entries[entries.length - 1];
                const first = entries[0];
                
                // Basis für Prozent-Berechnung
                let baseValue;
                if (performanceData.entries.length === 1) {
                    // ALLERERSTER ENTRY: Vergleich mit 100
                    baseValue = 100;
                } else {
                    // Normale Entries: Vergleich mit erstem Wert im Zeitfenster
                    baseValue = first.fysIndex;
                }
                
                const change = latest.fysIndex - baseValue;
                
                // Zeige aktuellen Wert
                const valueEl = document.getElementById('mainIndexValue');
                if (valueEl) {
                    valueEl.textContent = latest.fysIndex.toFixed(1);
                    console.log('Set main index value to:', latest.fysIndex.toFixed(1));
                }
                
                if (change > 0) {
                    valueEl.className = 'index-value-number positive';
                } else if (change < 0) {
                    valueEl.className = 'index-value-number negative';
                } else {
                    valueEl.className = 'index-value-number';
                }

                const changePercent = baseValue !== 0 ? ((change / baseValue) * 100).toFixed(2) : '0.00';
                const changeText = document.getElementById('mainChangeText');
                if (changeText) {
                    changeText.textContent = `${change >= 0 ? '+' : ''}${changePercent}%`;
                    // Farbe basierend auf Änderung
                    if (change > 0) {
                        changeText.style.color = '#00c96d';
                    } else if (change < 0) {
                        changeText.style.color = '#ff3366';
                    } else {
                        changeText.style.color = 'var(--text-secondary)';
                    }
                }
                
                console.log(`Main Chart %: ${first.fysIndex} → ${latest.fysIndex} (${changePercent}%)`);
            }
        }

        // Get filtered entries
        function getFilteredEntries() {
            if (performanceData.entries.length === 0) return [];
            
            let count;
            
            switch(currentTimeRange) {
                case '1d':
                    count = 2; // Letzten 2 Entries (gestern + heute) um 1-Tages-Veränderung zu sehen
                    break;
                case '7d':
                    count = 8; // Letzten 8 Entries (vor 7 Tagen + letzte 7 Tage)
                    break;
                case '1m':
                    count = 31; // Letzten 31 Entries (vor 30 Tagen + letzte 30 Tage)
                    break;
                case '6m':
                    count = 181; // Letzten 181 Entries
                    break;
                case '1y':
                    count = 366; // Letzten 366 Entries
                    break;
                case 'all':
                    return performanceData.entries; // Alle Entries
            }
            
            // Nimm die letzten X Entries
            const startIndex = Math.max(0, performanceData.entries.length - count);
            const filtered = performanceData.entries.slice(startIndex);
            
            console.log(`Filtered entries for ${currentTimeRange}: showing last ${count} entries (${filtered.length} available)`);
            return filtered;
        }

        // Change time range
        function changeTimeRange(range) {
            console.log('Changing time range to:', range);
            currentTimeRange = range;
            
            // Save to localStorage
            localStorage.setItem('fys_timeRange', range);
            
            // Update all time buttons
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll(`.time-btn[data-range="${range}"]`).forEach(btn => btn.classList.add('active'));
            
            updateMainChart();
            
            // Reload the correct stock list based on what's currently displayed
            if (currentStockListType === 'fys') {
                createStockList(); // FYS categories
            } else {
                // Performance Pack categories
                const pack = performancePacks.find(p => p.id === currentStockListType);
                if (pack) {
                    createPackStockList(pack);
                }
            }
            
            // Update Performance Pack charts (synchronized!)
            if (isPro && performanceData.activePacks && performanceData.activePacks.length > 0) {
                performanceData.activePacks.forEach(packId => {
                    createPackMiniChart(packId);
                });
                console.log('✓ Pack charts updated with new timerange');
            }
            
            console.log('Time range changed and saved:', range);
        }

        // Open chart details (Flatex-Style)
        function openChartDetails() {
            console.log('openChartDetails called, entries:', performanceData.entries.length);
            
            // Öffne View auch wenn keine Daten vorhanden (für Demo)
            document.getElementById('homeView').classList.remove('active');
            document.getElementById('chartDetailsView').classList.add('active');
            
            // Activate correct time button in categories overview
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll(`.time-btn[data-range="${currentTimeRange}"]`).forEach(btn => {
                btn.classList.add('active');
            });
            console.log('✓ Activated time buttons for:', currentTimeRange);
            
            // Update FYS Index Summary
            const entries = getFilteredEntries();
            console.log('Filtered entries:', entries.length);
            
            if (entries.length > 0) {
                const latest = entries[entries.length - 1];
                const first = entries[0];
                
                // Basis für Prozent-Berechnung
                let baseValue;
                if (performanceData.entries.length === 1) {
                    // ALLERERSTER ENTRY: Vergleich mit 100
                    baseValue = 100;
                } else {
                    // Normale Entries: Vergleich mit erstem Wert im Zeitfenster
                    baseValue = first.fysIndex;
                }
                
                const change = latest.fysIndex - baseValue;
                const changePercent = baseValue !== 0 ? ((change / baseValue) * 100).toFixed(2) : '0.00';
                
                document.getElementById('detailIndexValue').textContent = latest.fysIndex.toFixed(1);
                document.getElementById('detailIndexChange').textContent = 
                    `${change >= 0 ? '+' : ''}${changePercent}%`;
                    
                console.log(`FYS Index: ${baseValue} → ${latest.fysIndex} (${changePercent}%)`);
            } else {
                // Demo-Werte wenn keine Daten
                document.getElementById('detailIndexValue').textContent = '100.0';
                document.getElementById('detailIndexChange').textContent = '+0.00%';
            }
            
            // Create Flatex-Style Stock List
            createStockList();
            
            // Update charts
            try {
                if (!combinedChart) initCombinedChart();
                if (entries.length > 0) {
                    updateCombinedChart();
                }
            } catch (error) {
                console.error('Chart error:', error);
            }
        }

        function closeChartDetails() {
            document.getElementById('chartDetailsView').classList.remove('active');
            document.getElementById('homeView').classList.add('active');
            
            // Reset label back to FYS-INDEX
            const indexLabel = document.querySelector('#chartDetailsView .fys-index-label');
            if (indexLabel) {
                indexLabel.textContent = 'FYS-INDEX';
            }
            
            // Clean up pack values table if it exists
            const packTable = document.getElementById('packValuesTableContainer');
            if (packTable) {
                packTable.remove();
            }
        }

        // Create Flatex-Style Stock List
        function createStockList() {
            currentStockListType = 'fys'; // Mark that FYS categories are displayed
            
            const t = translations[currentLang];
            const container = document.getElementById('stockListItems');
            
            if (!container) {
                console.error('stockListItems container not found!');
                return;
            }
            
            container.innerHTML = '';

            const entries = getFilteredEntries();
            console.log('createStockList entries:', entries.length);

            // Category SVG Icons (im Bottom Nav Stil)
            const categoryIcons = {
                social: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                energy: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
                focus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
                discipline: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
                sport: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
                nutrition: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>`,
                mindset: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>`
            };

            // Wenn keine Daten, zeige Demo-Werte
            if (entries.length === 0) {
                categories.forEach(cat => {
                    const stockItem = document.createElement('div');
                    stockItem.className = 'stock-item';
                    stockItem.onclick = () => showCategoryDetail(cat.id);
                    
                    stockItem.innerHTML = `
                        <div class="stock-item-left">
                            <div class="stock-icon" style="background: ${cat.color}20; color: ${cat.color};">
                                ${categoryIcons[cat.id]}
                            </div>
                            <div class="stock-info">
                                <div class="stock-name">${t.categories[cat.id]}</div>
                            </div>
                        </div>
                        <div class="stock-item-right">
                            <div class="stock-price">100.0</div>
                            <div class="stock-change neutral">
                                <span class="stock-arrow">—</span>
                                0.0%
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(stockItem);
                });
                return;
            }

            const latest = entries[entries.length - 1];
            const first = entries[0];

            categories.forEach(cat => {
                // Verwende categoryValues (akkumuliert) statt values * 10
                const latestValue = latest.categoryValues ? latest.categoryValues[cat.id] : 100;
                const firstValue = first.categoryValues ? first.categoryValues[cat.id] : 100;
                
                // Basis für Prozent-Berechnung
                let baseValue;
                if (performanceData.entries.length === 1) {
                    // ALLERERSTER ENTRY: Vergleich mit 100
                    baseValue = 100;
                } else {
                    // Normale Entries: Vergleich mit erstem Wert im Zeitfenster
                    baseValue = firstValue;
                }
                
                const change = latestValue - baseValue;
                const changePercent = baseValue !== 0 ? ((change / baseValue) * 100).toFixed(1) : '0.0';
                
                const isPositive = change > 0;
                const isNegative = change < 0;
                const changeClass = isPositive ? 'positive' : isNegative ? 'negative' : 'neutral';
                const arrow = isPositive ? '▲' : isNegative ? '▼' : '—';

                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.onclick = () => showCategoryDetail(cat.id);
                
                stockItem.innerHTML = `
                    <div class="stock-item-left">
                        <div class="stock-icon" style="background: ${cat.color}20; color: ${cat.color};">
                            ${categoryIcons[cat.id]}
                        </div>
                        <div class="stock-info">
                            <div class="stock-name">${t.categories[cat.id]}</div>
                        </div>
                    </div>
                    <div class="stock-item-right">
                        <div class="stock-price">${latestValue.toFixed(1)}</div>
                        <div class="stock-change ${changeClass}">
                            <span class="stock-arrow">${arrow}</span>
                            ${Math.abs(parseFloat(changePercent)).toFixed(1)}%
                        </div>
                    </div>
                `;
                
                container.appendChild(stockItem);
            });
        }

        // Create Stock List for Performance Pack Categories (1:1 copy)
        function createPackStockList(pack) {
            currentStockListType = pack.id; // Mark which pack is displayed
            
            const container = document.getElementById('stockListItems');
            const categoriesOverview = document.getElementById('categoriesOverview');
            
            if (!container) {
                console.error('stockListItems container not found!');
                return;
            }
            
            // Update title
            if (categoriesOverview) {
                categoriesOverview.textContent = `${pack.name} Kategorien`;
            }
            
            container.innerHTML = '';

            const entries = getFilteredEntries().filter(e => 
                e.packIndices && e.packIndices[pack.id] !== undefined
            );

            console.log('createPackStockList entries:', entries.length);

            // SVG Icons for pack categories (same as in settings)
            const packCategoryIcons = {
                // Finance Pack
                savings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
                investments: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>`,
                budget: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg>`,
                income: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>`,
                financial_education: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
                
                // Health Pack
                cardio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
                strength: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5v11M17.5 6.5v11M3 9.5h3M18 9.5h3M3 14.5h3M18 14.5h3M9 3v3M15 3v3M9 18v3M15 18v3"></path></svg>`,
                flexibility: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path></svg>`,
                mental_health: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
                
                // Entrepreneurship Pack
                networking: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                product_development: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>`,
                marketing: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0L21.3 15.3z"></path><path d="M7.5 10.5L14 17"></path></svg>`,
                sales: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                leadership: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20M5 20V9l7-5 7 5v11M9 20v-6h6v6"></path></svg>`
            };

            // If no data, show demo values
            if (entries.length === 0) {
                pack.categories.forEach(cat => {
                    const stockItem = document.createElement('div');
                    stockItem.className = 'stock-item';
                    stockItem.onclick = () => openPackCategoryDetail(pack.id, cat.id);
                    stockItem.style.cursor = 'pointer';
                    
                    stockItem.innerHTML = `
                        <div class="stock-item-left">
                            <div class="stock-icon" style="background: ${cat.color}20; color: ${cat.color};">
                                ${packCategoryIcons[cat.id] || cat.emoji}
                            </div>
                            <div class="stock-info">
                                <div class="stock-name">${cat.name[currentLang] || cat.name.en}</div>
                            </div>
                        </div>
                        <div class="stock-item-right">
                            <div class="stock-price">5.0</div>
                            <div class="stock-change neutral">
                                <span class="stock-arrow">—</span>
                                0.0%
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(stockItem);
                });
                return;
            }

            const latest = entries[entries.length - 1];
            const first = entries[0];

            pack.categories.forEach(cat => {
                const latestValue = latest.values ? latest.values[cat.id] : 5;
                const firstValue = first.values ? first.values[cat.id] : 5;
                const change = latestValue - firstValue;
                const changePercent = firstValue !== 0 ? ((change / firstValue) * 100).toFixed(1) : '0.0';
                
                const isPositive = change > 0;
                const isNegative = change < 0;
                const changeClass = isPositive ? 'positive' : isNegative ? 'negative' : 'neutral';
                const arrow = isPositive ? '▲' : isNegative ? '▼' : '—';

                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.onclick = () => openPackCategoryDetail(pack.id, cat.id);
                stockItem.style.cursor = 'pointer';
                
                stockItem.innerHTML = `
                    <div class="stock-item-left">
                        <div class="stock-icon" style="background: ${cat.color}20; color: ${cat.color};">
                            ${packCategoryIcons[cat.id] || cat.emoji}
                        </div>
                        <div class="stock-info">
                            <div class="stock-name">${cat.name[currentLang] || cat.name.en}</div>
                        </div>
                    </div>
                    <div class="stock-item-right">
                        <div class="stock-price">${latestValue.toFixed(1)}</div>
                        <div class="stock-change ${changeClass}">
                            <span class="stock-arrow">${arrow}</span>
                            ${Math.abs(parseFloat(changePercent)).toFixed(1)}%
                        </div>
                    </div>
                `;
                
                container.appendChild(stockItem);
            });
        }

        // Show individual pack category detail
        function showPackCategoryDetail(packId, categoryId) {
            // For now, just log - can be extended like showCategoryDetail
            console.log('Show pack category detail:', packId, categoryId);
            // TODO: Implement modal for pack category details (like FYS Index categories)
        }

        // Category Detail View
        let categoryDetailChart = null;
        let currentCategoryTimeRange = '1m';
        let currentCategoryId = null;
        let currentStockListType = 'fys'; // 'fys' or packId

        // Show individual category detail
        function showCategoryDetail(categoryId) {
            const t = translations[currentLang];
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;

            currentCategoryId = categoryId;

            const categoryIcons = {
                social: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                energy: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
                focus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
                discipline: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
                sport: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
                nutrition: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>`,
                mindset: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>`
            };

            // Update Header
            const iconContainer = document.getElementById('categoryDetailIcon');
            iconContainer.style.background = `${category.color}20`;
            iconContainer.style.color = category.color;
            iconContainer.innerHTML = categoryIcons[categoryId];
            
            document.getElementById('categoryDetailName').textContent = t.categories[categoryId];
            document.getElementById('categoryDetailSymbol').textContent = categoryId.toUpperCase();

            // Update Price
            updateCategoryDetailData();

            // Show Modal
            document.getElementById('categoryDetailModal').classList.add('active');
            
            // Activate correct time button
            document.querySelectorAll('.category-time-btn').forEach(btn => btn.classList.remove('active'));
            const activeCatBtn = document.querySelector(`.category-time-btn[data-cat-range="${currentCategoryTimeRange}"]`);
            if (activeCatBtn) activeCatBtn.classList.add('active');

            // Initialize Chart
            if (!categoryDetailChart) {
                initCategoryDetailChart();
            }
            updateCategoryDetailChart();
        }

        function closeCategoryDetail() {
            document.getElementById('categoryDetailModal').classList.remove('active');
        }

        function updateCategoryDetailData() {
            const category = categories.find(c => c.id === currentCategoryId);
            if (!category) return;

            const entries = getCategoryFilteredEntries();
            if (entries.length === 0) {
                document.getElementById('categoryDetailPrice').textContent = '100.0';
                document.getElementById('categoryDetailChange').innerHTML = '<span>—</span> 0.0%';
                document.getElementById('categoryDetailChange').className = 'category-detail-change neutral';
                return;
            }

            const latest = entries[entries.length - 1];
            const first = entries[0];
            
            // Verwende categoryValues statt values * 10
            const latestValue = latest.categoryValues ? latest.categoryValues[currentCategoryId] : 100;
            const firstValue = first.categoryValues ? first.categoryValues[currentCategoryId] : 100;
            
            // Basis für Prozent-Berechnung
            let baseValue;
            if (performanceData.entries.length === 1) {
                // ALLERERSTER ENTRY: Vergleich mit 100
                baseValue = 100;
            } else {
                // Normale Entries: Vergleich mit erstem Wert im Zeitfenster
                baseValue = firstValue;
            }
            
            const change = latestValue - baseValue;
            const changePercent = baseValue !== 0 ? ((change / baseValue) * 100).toFixed(1) : '0.0';

            const isPositive = change > 0;
            const isNegative = change < 0;
            const changeClass = isPositive ? 'positive' : isNegative ? 'negative' : 'neutral';
            const arrow = isPositive ? '▲' : isNegative ? '▼' : '—';

            document.getElementById('categoryDetailPrice').textContent = latestValue.toFixed(1);
            document.getElementById('categoryDetailPrice').style.color = category.color;
            
            const changeEl = document.getElementById('categoryDetailChange');
            changeEl.className = `category-detail-change ${changeClass}`;
            changeEl.innerHTML = `<span>${arrow}</span> ${Math.abs(parseFloat(changePercent)).toFixed(1)}%`;
        }

        function changeCategoryTimeRange(range) {
            currentCategoryTimeRange = range;
            document.querySelectorAll('.category-time-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll(`.category-time-btn[data-cat-range="${range}"]`).forEach(btn => btn.classList.add('active'));
            updateCategoryDetailData();
            updateCategoryDetailChart();
        }

        // Get filtered entries for category view
        function getCategoryFilteredEntries() {
            if (performanceData.entries.length === 0) return [];
            
            let count;
            
            switch(currentCategoryTimeRange) {
                case '1d':
                    count = 2; // Letzten 2 Entries (gestern + heute)
                    break;
                case '7d':
                    count = 8; // Letzten 8 Entries
                    break;
                case '1m':
                    count = 31; // Letzten 31 Entries
                    break;
                case '6m':
                    count = 181; // Letzten 181 Entries
                    break;
                case '1y':
                    count = 366; // Letzten 366 Entries
                    break;
                case 'all':
                    return performanceData.entries; // Alle Entries
            }
            
            // Nimm die letzten X Entries
            const startIndex = Math.max(0, performanceData.entries.length - count);
            return performanceData.entries.slice(startIndex);
        }

        // Initialize Category Detail Chart with Interactive Tooltip
        function initCategoryDetailChart() {
            const ctx = document.getElementById('categoryDetailChart').getContext('2d');
            const category = categories.find(c => c.id === currentCategoryId);
            
            categoryDetailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Value',
                        data: [],
                        borderColor: category.color,
                        backgroundColor: `${category.color}20`,
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 8,
                        pointHoverBackgroundColor: category.color,
                        pointHoverBorderColor: '#ffffff',
                        pointHoverBorderWidth: 3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { 
                        mode: 'index', 
                        intersect: false 
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: currentTheme === 'dark' ? 'rgba(17, 17, 17, 0.95)' : 'rgba(255, 255, 255, 0.98)',
                            titleColor: currentTheme === 'dark' ? '#ffffff' : '#ff6b35',
                            bodyColor: currentTheme === 'dark' ? '#6b6b6b' : '#ff8f5f',
                            borderColor: currentTheme === 'dark' ? '#1a1a1a' : '#ffe8e0',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                // Zeige nur den Wert (wie Main Chart)
                                title: function(context) {
                                    return context[0].parsed.y.toFixed(1);
                                },
                                // Zeige Datum als Body (unten)
                                label: function(context) {
                                    return context.label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 } 
                            }
                        },
                        y: {
                            // Auto-Scale für Trading-Platform-Look
                            beginAtZero: false,
                            grace: '5%', // 5% Padding oben und unten
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 },
                                padding: 5
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });
        }

        // Update Category Detail Chart
        function updateCategoryDetailChart() {
            if (!categoryDetailChart) return;

            const category = categories.find(c => c.id === currentCategoryId);
            const entries = getCategoryFilteredEntries();
            
            if (entries.length === 0) {
                // Zeige Startpunkt bei 100 wenn keine Daten
                const today = new Date();
                const todayLabel = `${today.getDate()}.${today.getMonth()+1}.${today.getFullYear()}`;
                categoryDetailChart.data.labels = [todayLabel];
                categoryDetailChart.data.datasets[0].data = [100];
                categoryDetailChart.update('none');
                return;
            }

            let chartLabels = [];
            let chartData = [];
            
            if (performanceData.entries.length === 1) {
                // ALLERERSTER ENTRY: Zeige 100 → Entry
                const today = new Date();
                const startLabel = `${today.getDate()}.${today.getMonth()+1}.${today.getFullYear()}`;
                chartLabels.push(startLabel);
                chartData.push(100);
                
                // Dann der erste Entry
                const e = entries[0];
                const date = new Date(e.date);
                const label = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                chartLabels.push(label);
                
                const value = e.categoryValues ? e.categoryValues[currentCategoryId] : 100;
                chartData.push(value);
            } else {
                // Normale Entries: Zeige NUR die gefilterten Entries
                entries.forEach(e => {
                    const date = new Date(e.date);
                    const label = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                    chartLabels.push(label);
                    
                    // Verwende categoryValues
                    const value = e.categoryValues ? e.categoryValues[currentCategoryId] : 100;
                    chartData.push(value);
                });
            }
            
            categoryDetailChart.data.labels = chartLabels;
            categoryDetailChart.data.datasets[0].data = chartData;

            // Update colors
            categoryDetailChart.data.datasets[0].borderColor = category.color;
            categoryDetailChart.data.datasets[0].backgroundColor = `${category.color}20`;
            categoryDetailChart.data.datasets[0].pointHoverBackgroundColor = category.color;

            categoryDetailChart.update('none');
            console.log('Category Detail Chart updated with', chartData.length, 'points');
        }

        // Initialize combined chart
        function initCombinedChart() {
            const ctx = document.getElementById('combinedChart').getContext('2d');
            const t = translations[currentLang];
            
            const datasets = categories.map(cat => ({
                label: t.categories[cat.id],
                data: [],
                borderColor: cat.color,
                backgroundColor: 'transparent',
                borderWidth: 2,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 5
            }));

            datasets.push({
                label: 'FYS-Index',
                data: [],
                borderColor: '#ff6b35',
                backgroundColor: 'transparent',
                borderWidth: 3,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6
            });

            combinedChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: currentTheme === 'dark' ? 'rgba(17, 17, 17, 0.95)' : 'rgba(255, 255, 255, 0.98)',
                            titleColor: currentTheme === 'dark' ? '#ffffff' : '#ff6b35',
                            bodyColor: currentTheme === 'dark' ? '#6b6b6b' : '#ff8f5f',
                            borderColor: currentTheme === 'dark' ? '#1a1a1a' : '#ffe8e0',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                // Wert oben
                                title: function(context) {
                                    return context[0].dataset.label + ': ' + context[0].parsed.y.toFixed(1);
                                },
                                // Datum unten
                                label: function(context) {
                                    return context.label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 } 
                            }
                        },
                        y: {
                            // Auto-Scale für Trading-Platform-Look
                            beginAtZero: false,
                            grace: '5%',
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 },
                                padding: 5
                            }
                        }
                    }
                }
            });
        }

        // Update combined chart
        function updateCombinedChart() {
            if (!combinedChart) return;

            const entries = getFilteredEntries();
            
            combinedChart.data.labels = entries.map(e => {
                const date = new Date(e.date);
                return `${date.getDate()}.${date.getMonth() + 1}`;
            });

            categories.forEach((cat, index) => {
                // Verwende categoryValues
                combinedChart.data.datasets[index].data = entries.map(e => 
                    e.categoryValues ? e.categoryValues[cat.id] : 100
                );
            });

            combinedChart.data.datasets[combinedChart.data.datasets.length - 1].data = entries.map(e => e.fysIndex);
            combinedChart.update();
        }

        // Create individual charts
        function createIndividualCharts() {
            const t = translations[currentLang];
            const container = document.getElementById('individualCharts');
            container.innerHTML = '';

            categories.forEach(cat => {
                const chartCard = document.createElement('div');
                chartCard.className = 'chart-card';
                chartCard.innerHTML = `
                    <div class="chart-title">${t.categories[cat.id]}</div>
                    <div class="single-chart-container">
                        <canvas id="chart-${cat.id}"></canvas>
                    </div>
                `;
                container.appendChild(chartCard);

                const ctx = document.getElementById(`chart-${cat.id}`).getContext('2d');
                const entries = getFilteredEntries();

                individualCharts[cat.id] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: entries.map(e => {
                            const date = new Date(e.date);
                            return `${date.getDate()}.${date.getMonth() + 1}`;
                        }),
                        datasets: [{
                            label: t.categories[cat.id],
                            data: entries.map(e => (e.values[cat.id] || 10) * 10),
                            borderColor: cat.color,
                            backgroundColor: `${cat.color}20`,
                            borderWidth: 3,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: currentTheme === 'dark' ? 'rgba(17, 17, 17, 0.95)' : 'rgba(255, 255, 255, 0.98)',
                                titleColor: currentTheme === 'dark' ? '#ffffff' : '#ff6b35',
                                bodyColor: currentTheme === 'dark' ? '#6b6b6b' : '#ff8f5f',
                                borderColor: currentTheme === 'dark' ? '#1a1a1a' : '#ffe8e0',
                                borderWidth: 1,
                                padding: 12
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                    drawBorder: false 
                                },
                                ticks: { 
                                    color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                    font: { size: 10 } 
                                }
                            },
                            y: {
                                // Auto-Scale für Trading-Platform-Look
                                beginAtZero: false,
                                grace: '5%',
                                grid: { 
                                    color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                    drawBorder: false 
                                },
                                ticks: { 
                                    color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                    font: { size: 10 },
                                    padding: 5
                                }
                            }
                        }
                    }
                });
            });
        }

        // Change theme
        function changeTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('fysTheme', theme);
            
            // Wenn System gewählt, ermittle aktuelles System Theme
            let actualTheme = theme;
            if (theme === 'system') {
                actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                console.log('🖥️ System Theme detected:', actualTheme);
            }
            
            document.documentElement.setAttribute('data-theme', actualTheme);
            document.body.className = actualTheme; // Für body class
            
            document.querySelectorAll('[data-theme-btn]').forEach(el => el.classList.remove('active'));
            document.querySelector(`[data-theme-btn="${theme}"]`).classList.add('active');
            
            if (mainChart) {
                mainChart.destroy();
                initMainChart();
                updateMainChart();
            }
        }
        
        // System Theme Change Listener
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            darkModeQuery.addEventListener('change', (e) => {
                // Nur reagieren wenn System Theme aktiv ist
                if (currentTheme === 'system') {
                    const newTheme = e.matches ? 'dark' : 'light';
                    console.log('🖥️ System Theme changed to:', newTheme);
                    document.documentElement.setAttribute('data-theme', newTheme);
                    document.body.className = newTheme;
                    
                    // Charts neu rendern
                    if (mainChart) {
                        mainChart.destroy();
                        initMainChart();
                        updateMainChart();
                    }
                }
            });
        }

        // Change language
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('fysLanguage', lang);
            
            document.querySelectorAll('[data-lang]').forEach(el => el.classList.remove('active'));
            document.querySelector(`[data-lang="${lang}"]`).classList.add('active');
            
            updateUI();
        }

        // Toggle coach data
        function toggleCoachData() {
            coachDataAccess = !coachDataAccess;
            localStorage.setItem('fysCoachData', coachDataAccess);
            const toggle = document.getElementById('coachDataToggle');
            
            if (coachDataAccess) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        function togglePro() {
            isPro = !isPro;
            localStorage.setItem('fysPro', isPro);
            
            // Update button
            updateProButton();
            
            // Show/Hide Performance Packs
            renderPerformancePacks();
            
            // Show message
            if (isPro) {
                alert('🎉 FYS Pro aktiviert! Performance Packs sind jetzt auf dem Startbildschirm verfügbar.');
            } else {
                alert('FYS Pro deaktiviert. Performance Packs wurden ausgeblendet.');
            }
        }
        
        // TEST MODE: Toggle für unbegrenzte CheckIns (TEMPORARY)
        function toggleTestMode() {
            testMode = !testMode;
            localStorage.setItem('fysTestMode', testMode);
            
            // Update toggle UI
            const toggle = document.getElementById('testModeToggle');
            if (toggle) {
                if (testMode) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            }
            
            // Show message
            if (testMode) {
                alert('🧪 TEST MODE AKTIVIERT\n\nDu kannst jetzt mehrere Check-Ins pro Tag machen.\n\nNur für Testing & Entwicklung!');
            } else {
                alert('✅ TEST MODE DEAKTIVIERT\n\nNormaler Modus: 1 Check-In pro Tag.');
            }
        }

        function updateProButton() {
            const btn = document.getElementById('proToggleBtn');
            const desc = document.getElementById('proStatusDesc');
            
            if (btn && desc) {
                if (isPro) {
                    btn.textContent = 'Deactivate FYS Pro';
                    btn.style.background = 'linear-gradient(135deg, #666, #888)';
                    desc.textContent = 'Pro Status: Active ✓';
                } else {
                    btn.textContent = 'Activate FYS Pro';
                    btn.style.background = 'linear-gradient(135deg, #ff6b35, #ff8f5f)';
                    desc.textContent = 'Performance Packs & Advanced Features';
                }
            }
            
            // Show/hide pack settings
            renderPackSettings();
        }

        function resetData() {
            showConfirmModal(
                'Daten zurücksetzen?',
                'Alle deine Check-Ins, Tagebucheinträge und Performance Packs werden gelöscht. Du startest komplett neu bei 100 Punkten.',
                '⚠️',
                function() {
                    console.log('🔄 Starting complete data reset...');
                    
                    // KOMPLETT RESET - Lösche ALLES aus localStorage
                    // WICHTIG: Wir speichern NICHTS neu, damit beim Reload die Default-Werte { entries: [], activePacks: [] } greifen
                    
                    const keysToRemove = [
                        'fysData',              // <- WICHTIG: Wird NICHT neu gespeichert!
                        'fys_activePacks',
                        'fysJournal',
                        'fysWizardDraft',
                        'fys_timeRange',        // <- Wird NICHT neu gespeichert!
                        'lastCheckInDate',
                        'fysSleepGoal',         // <- Wird NICHT neu gespeichert!
                        'fysCoachData',
                        'fysLanguage'
                        // 'fysPro' und 'fysTheme' bleiben erhalten
                    ];
                    
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                        console.log(`✓ Removed: ${key}`);
                    });
                    
                    // Lösche sessionStorage
                    sessionStorage.removeItem('fysCheckInCompleted');
                    sessionStorage.removeItem('fysAutoTimeframe');
                    
                    // Setze Reset-Flag (wird nach Reload gelöscht)
                    sessionStorage.setItem('fysDataReset', 'true');
                    
                    console.log('✅ All localStorage keys removed');
                    console.log('📊 After reload, app will initialize with: { entries: [], activePacks: [] }');
                    
                    // Alert VOR dem Reload
                    alert('✅ Alle Daten gelöscht!\n\nDie App startet jetzt komplett neu bei 100 Punkten.');
                    
                    // Seite neu laden - performanceData wird dann mit Default-Werten initialisiert
                    location.reload();
                }
            );
        }

        // Update UI
        // ========== PERFORMANCE PACKS FUNCTIONS ==========
        function getActivePackCategories() {
            let packCategories = [];
            
            try {
                if (!performanceData || !performanceData.activePacks) {
                    console.warn('No active packs data available');
                    return packCategories;
                }
                
                performanceData.activePacks.forEach(packId => {
                    const pack = performancePacks.find(p => p.id === packId);
                    if (pack && pack.categories && Array.isArray(pack.categories)) {
                        packCategories = packCategories.concat(pack.categories);
                        console.log('✓ Added categories from pack:', packId, '→', pack.categories.length, 'categories');
                    } else {
                        console.warn('Pack not found or invalid:', packId);
                    }
                });
            } catch (error) {
                console.error('Error in getActivePackCategories:', error);
            }
            
            return packCategories;
        }

        function calculatePackIndex(packId, values, previousIndex) {
            const pack = performancePacks.find(p => p.id === packId);
            if (!pack) return 100;

            const packCategoryIds = pack.categories.map(c => c.id);
            let sum = 0;
            let count = 0;

            packCategoryIds.forEach(catId => {
                if (values[catId] !== undefined) {
                    sum += values[catId];
                    count++;
                }
            });

            if (count === 0) return previousIndex;

            const avg = sum / count;
            const change = avg - 5;
            return Math.max(0, previousIndex + change);
        }

        function togglePerformancePack(packId) {
            const index = performanceData.activePacks.indexOf(packId);
            
            if (index > -1) {
                // Deactivate pack
                performanceData.activePacks.splice(index, 1);
            } else {
                // Check limit
                if (performanceData.activePacks.length >= 2) {
                    alert('⚠️ Du kannst maximal 2 Performance Packs gleichzeitig aktivieren. Deaktiviere zuerst ein anderes Pack.');
                    return;
                }
                // Activate pack
                performanceData.activePacks.push(packId);
            }
            
            // Save to localStorage
            localStorage.setItem('fysData', JSON.stringify(performanceData));
            localStorage.setItem('fys_activePacks', JSON.stringify(performanceData.activePacks));
            
            console.log('✓ Performance Pack toggled:', packId);
            console.log('  Active packs:', performanceData.activePacks);
            
            renderPackSettings();
            renderPerformancePacks();
            renderPerformancePacks(); // Update home view
            updateUI(); // Update check-in question count
        }

        function renderPackSettings() {
            const container = document.getElementById('performancePacksSettings');
            const listContainer = document.getElementById('packSettingsList');
            const countSpan = document.getElementById('activePacksCount');

            if (!isPro) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            
            const activeCount = performanceData.activePacks.length;
            if (countSpan) countSpan.textContent = activeCount;

            listContainer.innerHTML = '';

            // SVG Icons for pack categories (same as in stock list)
            const packCategoryIcons = {
                // Finance Pack
                savings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
                investments: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>`,
                budget: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg>`,
                income: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M20 12H4M20 12l-4-4M20 12l-4 4"></path></svg>`,
                financial_education: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
                
                // Health Pack
                cardio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
                strength: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M6.5 6.5v11M17.5 6.5v11M3 9.5h3M18 9.5h3M3 14.5h3M18 14.5h3M9 3v3M15 3v3M9 18v3M15 18v3"></path></svg>`,
                flexibility: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path></svg>`,
                mental_health: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
                
                // Entrepreneurship Pack
                networking: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                product_development: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                marketing: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0L21.3 15.3z"></path><path d="M7.5 10.5L14 17"></path></svg>`,
                sales: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                leadership: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;"><path d="M2 20h20M5 20V9l7-5 7 5v11M9 20v-6h6v6"></path></svg>`
            };

            performancePacks.forEach(pack => {
                const isActive = performanceData.activePacks.includes(pack.id);
                
                const packItem = document.createElement('div');
                packItem.className = 'setting-item';
                packItem.style.cursor = 'pointer';
                
                packItem.innerHTML = `
                    <div>
                        <div class="setting-label" style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">${pack.icon}</span>
                            <span>${pack.name}</span>
                        </div>
                        <div class="setting-description">${pack.description}</div>
                        <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;">
                            ${pack.categories.map(cat => `
                                <span style="
                                    padding: 2px 8px;
                                    background: var(--bg-elevated);
                                    border: 1px solid var(--border);
                                    border-radius: 4px;
                                    font-size: 10px;
                                    font-weight: 600;
                                    color: var(--text-secondary);
                                    display: inline-flex;
                                    align-items: center;
                                    gap: 4px;
                                ">${packCategoryIcons[cat.id] || ''} ${cat.name[currentLang] || cat.name.en || cat.name}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div style="display: flex; justify-content: center; margin-top: 14px;">
                        <div class="toggle-switch ${isActive ? 'active' : ''}" id="packToggle_${pack.id}">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                `;

                const toggle = packItem.querySelector('.toggle-switch');
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    togglePerformancePack(pack.id);
                });

                listContainer.appendChild(packItem);
            });
        }

        function renderPerformancePacks() {
            const container = document.getElementById('performancePacksContainer');
            const listContainer = document.getElementById('performancePacksList');

            if (!isPro) {
                container.style.display = 'none';
                return;
            }

            const activePacks = performanceData.activePacks || [];
            
            if (activePacks.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            listContainer.innerHTML = '';

            // Render each active pack like FYS-Index
            activePacks.forEach(packId => {
                const pack = performancePacks.find(p => p.id === packId);
                if (!pack) return;
                
                // Get current pack index value
                let packIndexValue = 100.0;
                let changeValue = 0;
                let changePercent = 0;
                
                if (performanceData.entries.length > 0) {
                    const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                    packIndexValue = lastEntry.packIndices?.[pack.id] || 100.0;
                    
                    if (performanceData.entries.length > 1) {
                        const prevEntry = performanceData.entries[performanceData.entries.length - 2];
                        const prevValue = prevEntry.packIndices?.[pack.id] || 100.0;
                        changeValue = packIndexValue - prevValue;
                        changePercent = (changeValue / prevValue) * 100;
                    }
                }

                // Create main chart section like FYS Index
                const packSection = document.createElement('div');
                packSection.className = 'main-chart-section';
                packSection.style.marginBottom = '20px';
                packSection.onclick = () => openPackDetails(pack.id);
                
                packSection.innerHTML = `
                    <div class="main-chart-container">
                        <canvas id="packChart_${pack.id}"></canvas>
                    </div>
                    <div class="index-value-display">
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; justify-content: center;">
                            <span style="font-size: 20px;">${pack.icon}</span>
                            <span>${pack.name}</span>
                        </div>
                        <div class="index-value-number" style="color: ${changeValue > 0 ? 'var(--accent-up)' : changeValue < 0 ? 'var(--accent-down)' : 'var(--text-secondary)'};">${packIndexValue.toFixed(1)}</div>
                        <div class="index-change-text" style="color: ${changeValue > 0 ? 'var(--accent-up)' : changeValue < 0 ? 'var(--accent-down)' : 'var(--text-secondary)'};">
                            ${changeValue > 0 ? '▲' : changeValue < 0 ? '▼' : '—'} ${Math.abs(changeValue).toFixed(2)} (${changeValue > 0 ? '+' : changeValue < 0 ? '' : ''}${changePercent.toFixed(2)}%)
                        </div>
                    </div>
                    <div class="tap-hint">Tippen für Details</div>
                `;

                listContainer.appendChild(packSection);

                // Create chart after DOM insertion
                setTimeout(() => {
                    createPackMiniChart(pack.id);
                }, 100);
            });
        }

        function createPackMiniChart(packId) {
            const canvas = document.getElementById(`packChart_${packId}`);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart
            if (window[`packMiniChart_${packId}`]) {
                window[`packMiniChart_${packId}`].destroy();
            }

            // Use SAME time range as FYS Index (synchronized)
            const entries = getFilteredEntries(); // Uses currentTimeRange!
            
            // Filter for entries with pack data
            const packEntries = entries.filter(e => 
                e.packIndices && e.packIndices[packId] !== undefined
            );

            const labels = packEntries.map(e => {
                const date = new Date(e.date);
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            });

            const data = packEntries.map(e => e.packIndices[packId]);

            // 1:1 COPY of FYS Index Chart Config!
            window[`packMiniChart_${packId}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: packId,
                        data: data,
                        borderColor: '#ff6b35', // Same as FYS Index
                        backgroundColor: 'rgba(255, 107, 53, 0.1)', // Same as FYS Index
                        borderWidth: 3, // Same as FYS Index
                        tension: 0.4, // Same as FYS Index
                        pointRadius: 0, // Same as FYS Index
                        pointHoverRadius: 6, // Same as FYS Index
                        fill: true // Same as FYS Index
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Same as FYS Index
                    interaction: { mode: 'index', intersect: false }, // Same as FYS Index
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: currentTheme === 'dark' ? 'rgba(17, 17, 17, 0.95)' : 'rgba(255, 255, 255, 0.98)',
                            titleColor: currentTheme === 'dark' ? '#ffffff' : '#ff6b35',
                            bodyColor: currentTheme === 'dark' ? '#6b6b6b' : '#ff8f5f',
                            borderColor: currentTheme === 'dark' ? '#1a1a1a' : '#ffe8e0',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    return context[0].parsed.y.toFixed(1);
                                },
                                label: function(context) {
                                    return context.label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { display: false }
                        },
                        y: {
                            // 1:1 SAME as FYS Index!
                            beginAtZero: false,
                            grace: '5%', // 5% Padding oben und unten
                            grid: { 
                                color: currentTheme === 'dark' ? '#1a1a1a' : '#fff5f0', 
                                drawBorder: false 
                            },
                            ticks: { 
                                color: currentTheme === 'dark' ? '#404040' : '#ff8f5f', 
                                font: { size: 10 },
                                padding: 5
                            }
                        }
                    }
                }
            });
        }

        // Performance Pack Detail Views
        function openPackDetails(packId) {
            const pack = performancePacks.find(p => p.id === packId);
            if (!pack) return;
            
            if (!performanceData.activePacks.includes(packId)) {
                alert('Bitte aktiviere zuerst dieses Performance Pack um Details zu sehen.');
                return;
            }
            
            // Open chartDetailsView (same as FYS Index)
            const homeView = safeGetElement('homeView');
            const detailsView = safeGetElement('chartDetailsView');
            if (homeView) homeView.classList.remove('active');
            if (detailsView) detailsView.classList.add('active');
            
            // Activate correct time button in categories overview
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll(`.time-btn[data-range="${currentTimeRange}"]`).forEach(btn => {
                btn.classList.add('active');
            });
            console.log('✓ Activated time buttons for pack:', currentTimeRange);
            
            // Update FYS-INDEX label to PACK NAME
            const indexLabel = document.querySelector('#chartDetailsView .fys-index-label');
            if (indexLabel) {
                indexLabel.textContent = pack.name.toUpperCase();
            }
            
            // Update index summary
            let currentValue = 100;
            let changeValue = 0;
            let changePercent = 0;
            
            if (performanceData.entries.length > 0) {
                const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                currentValue = lastEntry.packIndices?.[packId] || 100;
                
                if (performanceData.entries.length > 1) {
                    const firstEntry = performanceData.entries[0];
                    const firstValue = firstEntry.packIndices?.[packId] || 100;
                    changeValue = currentValue - firstValue;
                    changePercent = ((changeValue / firstValue) * 100);
                }
            }
            
            const indexValueEl = safeGetElement('detailIndexValue');
            const indexChangeEl = safeGetElement('detailIndexChange');
            if (indexValueEl) indexValueEl.textContent = currentValue.toFixed(1);
            if (indexChangeEl) indexChangeEl.textContent = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
            
            // Create stock list for pack categories (with CONSISTENT ICONS)
            createPackStockList(pack);
            
            // Update combined chart with pack data
            updatePackCombinedChart(packId);
            
            // Render values table (like FYS Index)
            setTimeout(() => renderPackValuesTable(packId), 200);
        }

        function renderPackValuesTable(packId) {
            // Find or create table container
            let tableContainer = document.getElementById('packValuesTableContainer');
            
            if (!tableContainer) {
                // Insert after combined chart
                const chartCard = document.querySelector('#chartDetailsView .chart-card');
                if (chartCard) {
                    tableContainer = document.createElement('div');
                    tableContainer.id = 'packValuesTableContainer';
                    tableContainer.className = 'chart-card';
                    tableContainer.style.marginTop = '16px';
                    chartCard.parentNode.insertBefore(tableContainer, chartCard.nextSibling);
                }
            }
            
            if (!tableContainer) return;

            const entries = getFilteredEntries().filter(e => e.packIndices && e.packIndices[packId] !== undefined);
            
            if (entries.length === 0) {
                tableContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">Keine Daten verfügbar</div>';
                return;
            }

            // Reverse to show newest first
            const reversedEntries = [...entries].reverse();

            let tableHTML = `
                <div style="max-height: 300px; overflow-y: auto;">
                    <table style="width: 100%; font-size: 13px;">
                        <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                            <tr style="border-bottom: 1px solid var(--border);">
                                <th style="text-align: left; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Datum</th>
                                <th style="text-align: right; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Wert</th>
                                <th style="text-align: right; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Änderung</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            reversedEntries.forEach((entry, index) => {
                const date = new Date(entry.date);
                const dateStr = date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const value = entry.packIndices[packId];
                
                let change = 0;
                let changePercent = 0;
                
                if (index < reversedEntries.length - 1) {
                    const prevEntry = reversedEntries[index + 1];
                    const prevValue = prevEntry.packIndices[packId];
                    change = value - prevValue;
                    changePercent = (change / prevValue) * 100;
                }

                const changeColor = change > 0 ? 'var(--accent-up)' : change < 0 ? 'var(--accent-down)' : 'var(--text-secondary)';
                const changeSymbol = change > 0 ? '▲' : change < 0 ? '▼' : '—';

                tableHTML += `
                    <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 12px 8px; color: var(--text-primary);">${dateStr}</td>
                        <td style="text-align: right; padding: 12px 8px; color: var(--text-primary); font-weight: 600;">${value.toFixed(1)}</td>
                        <td style="text-align: right; padding: 12px 8px; color: ${changeColor}; font-weight: 600;">
                            ${changeSymbol} ${Math.abs(changePercent).toFixed(2)}%
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table></div>';
            tableContainer.innerHTML = tableHTML;
        }

        function createPackStockList(pack) {
            currentStockListType = pack.id; // Mark which pack is displayed
            
            const container = document.getElementById('stockListItems');
            if (!container) return;
            
            container.innerHTML = '';

            const entries = getFilteredEntries();
            
            // SVG Icons for pack categories
            const packCategoryIcons = {
                // Finance Pack
                savings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
                investments: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>`,
                budget: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg>`,
                income: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 12H4M20 12l-4-4M20 12l-4 4"></path></svg>`,
                financial_education: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
                
                // Health Pack
                cardio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
                strength: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5v11M17.5 6.5v11M3 9.5h3M18 9.5h3M3 14.5h3M18 14.5h3M9 3v3M15 3v3M9 18v3M15 18v3"></path></svg>`,
                flexibility: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path></svg>`,
                mental_health: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
                
                // Entrepreneurship Pack
                networking: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                product_development: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                marketing: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0L21.3 15.3z"></path><path d="M7.5 10.5L14 17"></path></svg>`,
                sales: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                leadership: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20M5 20V9l7-5 7 5v11M9 20v-6h6v6"></path></svg>`
            };

            pack.categories.forEach(cat => {
                let currentValue = 100;
                let changeValue = 0;
                let changePercent = 0;

                if (entries.length > 0) {
                    const lastEntry = entries[entries.length - 1];
                    currentValue = lastEntry.categoryValues?.[cat.id] || 100;

                    if (entries.length > 1) {
                        const firstEntry = entries[0];
                        const firstValue = firstEntry.categoryValues?.[cat.id] || 100;
                        changeValue = currentValue - firstValue;
                        changePercent = ((changeValue / firstValue) * 100);
                    }
                }

                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.onclick = () => openPackCategoryDetail(pack.id, cat.id);
                stockItem.style.cursor = 'pointer';
                
                stockItem.innerHTML = `
                    <div class="stock-item-left">
                        <div class="stock-icon" style="background: ${cat.color}20; color: ${cat.color};">
                            ${packCategoryIcons[cat.id] || cat.emoji}
                        </div>
                        <div class="stock-info">
                            <div class="stock-name">${cat.name[currentLang] || cat.name.en}</div>
                        </div>
                    </div>
                    <div class="stock-item-right">
                        <div class="stock-price">${currentValue.toFixed(1)}</div>
                        <div class="stock-change ${changeValue >= 0 ? 'positive' : changeValue < 0 ? 'negative' : 'neutral'}">
                            <span class="stock-arrow">${changeValue >= 0 ? '▲' : changeValue < 0 ? '▼' : '—'}</span>
                            ${Math.abs(changePercent).toFixed(1)}%
                        </div>
                    </div>
                `;
                
                container.appendChild(stockItem);
            });
        }

        function updatePackCombinedChart(packId) {
            const canvas = document.getElementById('combinedChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            
            if (combinedChart) {
                combinedChart.destroy();
            }

            const entries = getFilteredEntries();
            if (entries.length === 0) {
                combinedChart = null;
                return;
            }

            const pack = performancePacks.find(p => p.id === packId);
            if (!pack) return;

            const labels = entries.map(e => {
                const d = new Date(e.date);
                return d.toLocaleDateString('de-DE', { month: 'short', day: 'numeric' });
            });

            // Create datasets for all pack categories
            const datasets = pack.categories.map(cat => {
                const data = entries.map(e => e.categoryValues?.[cat.id] || 100);
                
                return {
                    label: cat.name,
                    data: data,
                    borderColor: cat.color,
                    backgroundColor: `${cat.color}10`,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 0,
                    borderWidth: 2
                };
            });

            combinedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: '#666',
                                usePointStyle: true,
                                padding: 15,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#666', maxTicksLimit: 6 }
                        },
                        y: {
                            grid: { color: '#1a1a1a' },
                            ticks: { color: '#666' }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function openPackCategoryDetail(packId, categoryId) {
            const pack = performancePacks.find(p => p.id === packId);
            if (!pack) {
                console.error('Pack not found:', packId);
                return;
            }
            
            const category = pack.categories.find(c => c.id === categoryId);
            if (!category) {
                console.error('Category not found:', categoryId);
                return;
            }
            
            if (!performanceData.activePacks.includes(packId)) {
                alert('Bitte aktiviere zuerst dieses Performance Pack um Details zu sehen.');
                return;
            }
            
            // Set current category ID for the modal
            currentCategoryId = categoryId;
            
            // Get modal elements
            const modal = document.getElementById('categoryDetailModal');
            if (!modal) {
                console.error('Modal not found');
                return;
            }
            
            // Get icon HTML
            const packCategoryIcons = {
                // Finance Pack
                savings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
                investments: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>`,
                budget: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg>`,
                income: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>`,
                financial_education: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
                // Health Pack
                cardio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
                strength: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5v11M17.5 6.5v11M3 9.5h3M18 9.5h3M3 14.5h3M18 14.5h3M9 3v3M15 3v3M9 18v3M15 18v3"></path></svg>`,
                flexibility: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path></svg>`,
                mental_health: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
                // Entrepreneurship Pack
                networking: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
                product_development: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>`,
                marketing: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0L21.3 15.3z"></path><path d="M7.5 10.5L14 17"></path></svg>`,
                sales: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
                leadership: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20M5 20V9l7-5 7 5v11M9 20v-6h6v6"></path></svg>`
            };
            
            const iconHtml = packCategoryIcons[categoryId] || `<div style="font-size: 24px;">${category.emoji}</div>`;
            
            // Update header
            const iconContainer = document.getElementById('categoryDetailIcon');
            iconContainer.style.background = `${category.color}20`;
            iconContainer.style.color = category.color;
            iconContainer.innerHTML = iconHtml;
            
            document.getElementById('categoryDetailName').textContent = category.name[currentLang] || category.name.en || category.name;
            document.getElementById('categoryDetailSymbol').textContent = pack.name;
            
            // Update price data
            updateCategoryDetailData();
            
            // Show modal
            modal.classList.add('active');
            
            // Activate correct time button
            document.querySelectorAll('.category-time-btn').forEach(btn => btn.classList.remove('active'));
            const activeCatBtn = document.querySelector(`.category-time-btn[data-cat-range="${currentCategoryTimeRange}"]`);
            if (activeCatBtn) activeCatBtn.classList.add('active');
            
            // Initialize and update chart
            if (!categoryDetailChart) {
                initCategoryDetailChart();
            }
            updateCategoryDetailChart();
        }

        function renderPackCategoryValuesTable(categoryId) {
            const container = document.getElementById('packCategoryValuesTable');
            if (!container) return;

            const entries = getFilteredEntries().filter(e => e.categoryValues && e.categoryValues[categoryId] !== undefined);
            
            if (entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">Keine Daten verfügbar</div>';
                return;
            }

            // Reverse to show newest first
            const reversedEntries = [...entries].reverse();

            let tableHTML = `
                <div style="max-height: 300px; overflow-y: auto;">
                    <table style="width: 100%; font-size: 13px;">
                        <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                            <tr style="border-bottom: 1px solid var(--border);">
                                <th style="text-align: left; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Datum</th>
                                <th style="text-align: right; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Wert</th>
                                <th style="text-align: right; padding: 12px 8px; color: var(--text-secondary); font-weight: 600;">Änderung</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            reversedEntries.forEach((entry, index) => {
                const date = new Date(entry.date);
                const dateStr = date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const value = entry.categoryValues[categoryId];
                
                let change = 0;
                let changePercent = 0;
                
                if (index < reversedEntries.length - 1) {
                    const prevEntry = reversedEntries[index + 1];
                    const prevValue = prevEntry.categoryValues[categoryId];
                    change = value - prevValue;
                    changePercent = (change / prevValue) * 100;
                }

                const changeColor = change > 0 ? 'var(--accent-up)' : change < 0 ? 'var(--accent-down)' : 'var(--text-secondary)';
                const changeSymbol = change > 0 ? '▲' : change < 0 ? '▼' : '—';

                tableHTML += `
                    <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 12px 8px; color: var(--text-primary);">${dateStr}</td>
                        <td style="text-align: right; padding: 12px 8px; color: var(--text-primary); font-weight: 600;">${value.toFixed(1)}</td>
                        <td style="text-align: right; padding: 12px 8px; color: ${changeColor}; font-weight: 600;">
                            ${changeSymbol} ${Math.abs(changePercent).toFixed(2)}%
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table></div>';
            container.innerHTML = tableHTML;
        }

        function createPackDetailChart(packId, timeRange) {
            const canvas = document.getElementById('packDetailChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            if (window.currentPackDetailChart) window.currentPackDetailChart.destroy();
            
            let entries = performanceData.entries.filter(e => e.packIndices && e.packIndices[packId] !== undefined);
            
            const now = new Date();
            if (timeRange !== 'all') {
                const ranges = { '1d': 1, '7d': 7, '1m': 30, '6m': 180, '1y': 365 };
                const days = ranges[timeRange];
                const cutoff = new Date(now);
                cutoff.setDate(cutoff.getDate() - days);
                entries = entries.filter(e => new Date(e.date) >= cutoff);
            }
            
            const labels = entries.map(e => new Date(e.date).toLocaleDateString('de-DE', { month: 'short', day: 'numeric' }));
            const data = entries.map(e => e.packIndices[packId]);
            
            window.currentPackDetailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pack Index',
                        data: data,
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#666' } },
                        y: { grid: { color: '#1a1a1a' }, ticks: { color: '#666' } }
                    }
                }
            });
        }

        function createPackCategoryDetailChart(categoryId, timeRange) {
            const canvas = document.getElementById('packCategoryDetailChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            if (window.currentPackCategoryDetailChart) window.currentPackCategoryDetailChart.destroy();
            
            let entries = performanceData.entries.filter(e => e.categoryValues && e.categoryValues[categoryId] !== undefined);
            
            const now = new Date();
            if (timeRange !== 'all') {
                const ranges = { '1d': 1, '7d': 7, '1m': 30, '6m': 180, '1y': 365 };
                const days = ranges[timeRange];
                const cutoff = new Date(now);
                cutoff.setDate(cutoff.getDate() - days);
                entries = entries.filter(e => new Date(e.date) >= cutoff);
            }
            
            // Find category color
            let categoryColor = '#ff6b35';
            performancePacks.forEach(pack => {
                const cat = pack.categories.find(c => c.id === categoryId);
                if (cat) categoryColor = cat.color;
            });
            
            const labels = entries.map(e => new Date(e.date).toLocaleDateString('de-DE', { month: 'short', day: 'numeric' }));
            const data = entries.map(e => e.categoryValues[categoryId]);
            
            window.currentPackCategoryDetailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Category Value',
                        data: data,
                        borderColor: categoryColor,
                        backgroundColor: `${categoryColor}20`,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#666' } },
                        y: { grid: { color: '#1a1a1a' }, ticks: { color: '#666' } }
                    }
                }
            });
        }

        function changePackCategoryTimeRange(categoryId, range) {
            document.querySelectorAll('.category-time-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.range === range);
            });
            createPackCategoryDetailChart(categoryId, range);
        }

        function updateUI() {
            const t = translations[currentLang];
            
            // Helper function for safe updates
            const safeUpdate = (id, content, isPlaceholder = false) => {
                const el = document.getElementById(id);
                if (el) {
                    if (isPlaceholder) {
                        el.placeholder = content;
                    } else {
                        el.textContent = content;
                    }
                }
            };
            
            updateHeaderDate();
            
            // Update Check-in Widget with correct question count
            const totalQuestions = baseWizardCategories.length + (isPro ? getActivePackCategories().length : 0);
            safeUpdate('checkinWidgetSubtitle', `Beantworte ${totalQuestions} Fragen zu deinem Tag`);
            
            safeUpdate('tapHint', t.tapHint);
            safeUpdate('backText', t.backText);
            safeUpdate('allCategoriesTitle', t.allCategoriesTitle);
            safeUpdate('checkinTitle', t.checkinTitle);
            safeUpdate('taskWidgetTitle', t.taskWidgetTitle);
            safeUpdate('comingSoonBadge', t.comingSoonBadge);
            safeUpdate('habitsTitle', t.habitsTitle);
            safeUpdate('soberTitle', t.soberTitle);
            safeUpdate('habitWidgetTitle', t.habitWidgetTitle);
            safeUpdate('habitStreakLabel', t.habitStreakLabel);
            safeUpdate('habitTodayLabel', t.habitTodayLabel);
            safeUpdate('soberWidgetTitle', t.soberWidgetTitle);
            safeUpdate('soberDaysLabel', t.soberDaysLabel);
            safeUpdate('soberStreakLabel', t.soberStreakLabel);
            safeUpdate('habitComingTitle', t.habitComingTitle);
            safeUpdate('habitComingText', t.habitComingText);
            safeUpdate('soberComingTitle', t.soberComingTitle);
            safeUpdate('soberComingText', t.soberComingText);
            safeUpdate('settingsTitle', t.settingsTitle);
            safeUpdate('languageLabel', t.languageLabel);
            safeUpdate('languageDesc', t.languageDesc);
            safeUpdate('themeLabel', t.themeLabel);
            safeUpdate('themeDesc', t.themeDesc);
            safeUpdate('darkTheme', t.darkTheme);
            safeUpdate('lightTheme', t.lightTheme);
            safeUpdate('systemTheme', t.systemTheme);
            safeUpdate('sleepGoalLabel', t.sleepGoalLabel);
            safeUpdate('sleepGoalDesc', t.sleepGoalDesc);
            safeUpdate('coachDataLabel', t.coachDataLabel);
            safeUpdate('coachDataDesc', t.coachDataDesc);
            safeUpdate('navHome', t.navHome);
            safeUpdate('navCheckin', t.navCheckin);
            safeUpdate('navCoach', t.navCoach);
            safeUpdate('navSettings', t.navSettings);
            safeUpdate('coachTitle', t.coachTitle);
            safeUpdate('coachInput', t.coachPlaceholder, true);
            safeUpdate('sleepGoalValue', sleepGoal.toFixed(1) + 'h');
            
            // Update Pro button state
            updateProButton();
            
            updateCheckinView();
            updateDailyProgress();
            renderPerformancePacks(); // Render active pack cards
        }
        
        function updateDailyProgress() {
            console.log('🎯 updateDailyProgress called');
            
            // Use actual today date (not header date which is always current)
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            console.log('📅 Today string:', todayStr);
            
            const checkinBadge = document.getElementById('checkinBadge');
            const journalBadge = document.getElementById('journalBadge');
            
            if (checkinBadge) {
                const hasCheckin = performanceData.entries && performanceData.entries.some(e => {
                    const entryDate = new Date(e.date).toISOString().split('T')[0];
                    return entryDate === todayStr;
                });
                console.log('✅ Has check-in today:', hasCheckin);
                if (hasCheckin) {
                    checkinBadge.classList.remove('incomplete');
                    checkinBadge.classList.add('complete');
                } else {
                    checkinBadge.classList.remove('complete');
                    checkinBadge.classList.add('incomplete');
                }
            }
            
            if (journalBadge) {
                // Prüfe journalData (als Objekt mit Datum-Keys: "YYYY-MM-DD")
                console.log('📔 journalData:', journalData);
                console.log('📔 journalData[todayStr]:', journalData[todayStr]);
                
                const hasJournal = journalData && journalData[todayStr] && journalData[todayStr].trim().length > 0;
                console.log('✅ Has journal today:', hasJournal);
                
                if (hasJournal) {
                    console.log('🟠 Setting badge to COMPLETE (orange)');
                    journalBadge.classList.remove('incomplete');
                    journalBadge.classList.add('complete');
                } else {
                    console.log('⚪ Setting badge to INCOMPLETE (gray)');
                    journalBadge.classList.remove('complete');
                    journalBadge.classList.add('incomplete');
                }
            }
            
            // Update Streak
            calculateStreak();
        }
        
        // Calculate and update streak
        function calculateStreak() {
            console.log('🔥 calculateStreak called');
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Prüfe rückwärts ab heute, ob CheckIn + Journal existiert
            let checkDate = new Date(today);
            
            while (true) {
                const dateStr = checkDate.toISOString().split('T')[0];
                
                // Hat CheckIn?
                const hasCheckin = performanceData.entries && performanceData.entries.some(e => {
                    const entryDate = new Date(e.date).toISOString().split('T')[0];
                    return entryDate === dateStr;
                });
                
                // Hat Journal?
                const hasJournal = journalData && journalData[dateStr] && journalData[dateStr].trim().length > 0;
                
                // Beide müssen vorhanden sein
                if (hasCheckin && hasJournal) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1); // Einen Tag zurück
                } else {
                    break; // Streak unterbrochen
                }
                
                // Sicherheitsabbruch nach 365 Tagen
                if (streak > 365) break;
            }
            
            currentStreak = streak;
            localStorage.setItem('fysStreak', streak);
            
            // Longest Streak aktualisieren
            if (streak > longestStreak) {
                longestStreak = streak;
                localStorage.setItem('fysLongestStreak', streak);
            }
            
            console.log(`🔥 Current Streak: ${currentStreak} days`);
            console.log(`🏆 Longest Streak: ${longestStreak} days`);
            
            // Update UI
            updateStreakDisplay();
        }
        
        // Update Streak Display in Header
        function updateStreakDisplay() {
            const streakCard = document.getElementById('streakCard');
            const streakNumber = document.getElementById('streakNumber');
            const streakRecord = document.getElementById('streakRecord');
            
            if (!streakCard || !streakNumber || !streakRecord) return;
            
            if (currentStreak > 0) {
                streakNumber.textContent = currentStreak;
                streakRecord.textContent = longestStreak;
                streakCard.style.display = 'block';
            } else {
                streakCard.style.display = 'none';
            }
        }


        // Switch view with haptic feedback
        function switchView(view) {
            // Haptic Feedback (iOS-Style)
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(10); // Light haptic
            }
            
            // Close all modals
            document.getElementById('coachModal').classList.remove('active');
            document.getElementById('categoryDetailModal').classList.remove('active');
            document.getElementById('journalModal').classList.remove('active');
            
            // Auto-scroll: If already on this view, scroll to top
            const viewElement = document.getElementById(`${view}View`);
            if (viewElement && viewElement.classList.contains('active')) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));

            if (viewElement) viewElement.classList.add('active');
            const navItem = document.querySelector(`[data-view="${view}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Scroll to top when switching views
            window.scrollTo({ top: 0, behavior: 'instant' });
            
            if (view === 'checkin') {
                console.log('🔧 CHECK-IN VIEW ACTIVATED');
                
                try {
                    // Update wizard subtitle with correct number of questions
                    const totalQuestions = baseWizardCategories.length + (isPro ? getActivePackCategories().length : 0);
                    console.log('  ✓ Total questions:', totalQuestions);
                    
                    const subtitle = document.getElementById('wizardConfirmSubtitle');
                    if (subtitle) {
                        subtitle.textContent = `Beantworte ${totalQuestions} kurze Fragen zu deinem Tag`;
                        console.log('  ✓ Subtitle updated');
                    }
                    
                    // Hide error and wizard container
                    const errorDiv = document.getElementById('wizardError');
                    const container = document.getElementById('wizardContainer');
                    if (errorDiv) errorDiv.classList.remove('active');
                    if (container) container.classList.remove('active');
                    
                    // Show wizard confirmation dialog
                    const confirmDialog = document.getElementById('wizardConfirm');
                    if (confirmDialog) {
                        confirmDialog.classList.add('active');
                        console.log('  ✓ Confirm dialog shown');
                    } else {
                        console.error('  ✗ wizardConfirm element not found!');
                        throw new Error('wizardConfirm element not found');
                    }
                } catch (error) {
                    console.error('  ✗ Error showing check-in:', error);
                    showWizardError();
                }
            }
        }

        // Switch to Coach with tab activation
        function switchToCoach() {
            // Haptic Feedback
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(10);
            }
            
            // Deactivate all tabs
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            
            // Activate coach tab
            const coachTab = document.querySelector('[data-view="coach"]');
            if (coachTab) {
                coachTab.classList.add('active');
            }
            
            // Open coach modal
            openCoach();
        }

        // Coach functions
        function openCoach() {
            const modal = document.getElementById('coachModal');
            const content = document.getElementById('coachContent');
            const t = translations[currentLang];
            
            if (content.children.length === 0) {
                content.innerHTML = `
                    <div class="message assistant">
                        <div class="message-bubble">${t.coachWelcome}</div>
                    </div>
                `;
            }
            
            modal.classList.add('active');
        }

        function closeCoach() {
            document.getElementById('coachModal').classList.remove('active');
            
            // Deactivate coach tab when closing
            document.querySelector('[data-view="coach"]').classList.remove('active');
        }

        async function sendMessage() {
            const input = document.getElementById('coachInput');
            const message = input.value.trim();
            
            if (!message) return;

            const content = document.getElementById('coachContent');
            const sendBtn = document.getElementById('sendBtn');

            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.innerHTML = `<div class="message-bubble">${message}</div>`;
            content.appendChild(userMsg);
            content.scrollTop = content.scrollHeight;

            input.value = '';
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div class="loading"></div>';

            let context = '';
            if (coachDataAccess && performanceData.entries.length > 0) {
                const latest = performanceData.entries[performanceData.entries.length - 1];
                const t = translations[currentLang];
                context = `Values: ${categories.map(cat => 
                    `${t.categories[cat.id]}: ${latest.values[cat.id] || 10}`).join(', ')}. Sleep: ${latest.sleepHours}h. FYS: ${latest.fysIndex.toFixed(1)}. `;
            }

            try {
                const systemPrompts = {
                    de: `Du bist FYS Coach. ${context}Kurz (max 3 Sätze).`,
                    en: `You are FYS coach. ${context}Brief (max 3 sentences).`,
                    es: `Eres coach FYS. ${context}Breve (máx 3 frases).`
                };

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        system: systemPrompts[currentLang],
                        messages: [{ role: "user", content: message }]
                    })
                });

                const data = await response.json();
                const assistantText = data.content.filter(b => b.type === "text").map(b => b.text).join("\n");

                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'message assistant';
                assistantMsg.innerHTML = `<div class="message-bubble">${assistantText}</div>`;
                content.appendChild(assistantMsg);
                content.scrollTop = content.scrollHeight;

            } catch (error) {
                const errorMsg = document.createElement('div');
                errorMsg.className = 'message assistant';
                errorMsg.innerHTML = `<div class="message-bubble">Technical issue!</div>`;
                content.appendChild(errorMsg);
            }

            sendBtn.disabled = false;
            sendBtn.innerHTML = '➤';
        }

        // Journal Functions
        let journalData = JSON.parse(localStorage.getItem('fysJournal')) || {};
        let currentJournalMonth = new Date();
        let selectedJournalDate = null;

        function openJournal() {
            document.getElementById('journalModal').classList.add('active');
            currentJournalMonth = new Date();
            renderCalendar();
            updateJournalStats();
        }

        function closeJournal() {
            document.getElementById('journalModal').classList.remove('active');
            closeJournalEntry();
        }

        // Confirm Modal Functions
        let confirmCallback = null;
        let confirmStep = 1;

        function showConfirmModal(title, message, icon, callback) {
            confirmCallback = callback;
            confirmStep = 1;
            
            document.getElementById('confirmIcon').textContent = icon;
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmButton').textContent = 'Weiter';
            document.getElementById('confirmModal').classList.add('active');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            confirmCallback = null;
            confirmStep = 1;
        }

        function confirmAction() {
            if (confirmStep === 1) {
                // First confirmation passed, show second
                confirmStep = 2;
                document.getElementById('confirmIcon').textContent = '🔥';
                document.getElementById('confirmTitle').textContent = 'LETZTE WARNUNG!';
                document.getElementById('confirmMessage').textContent = 'Alle Daten werden permanent gelöscht und können nicht wiederhergestellt werden. Dies ist deine letzte Chance abzubrechen!';
                document.getElementById('confirmButton').textContent = 'Endgültig löschen';
                document.getElementById('confirmButton').style.background = '#ff0000';
            } else if (confirmStep === 2) {
                // Second confirmation passed, execute callback
                closeConfirmModal();
                if (confirmCallback) {
                    confirmCallback();
                }
            }
        }

        function openTaskManager() {
            alert('✓ Task Manager\n\nDiese Funktion wird gerade entwickelt und ist bald verfügbar!');
        }

        function openHabitTracker() {
            alert('🎯 Habit Tracker\n\nDiese Funktion wird gerade entwickelt und ist bald verfügbar!');
        }

        function openSoberTracker() {
            alert('🌟 Sober Tracker\n\nDiese Funktion wird gerade entwickelt und ist bald verfügbar!');
        }

        function changeMonth(delta) {
            currentJournalMonth.setMonth(currentJournalMonth.getMonth() + delta);
            renderCalendar();
        }

        function renderCalendar() {
            const monthNames = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 
                              'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[currentJournalMonth.getMonth()]} ${currentJournalMonth.getFullYear()}`;

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // Day headers
            const dayHeaders = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Get first day and number of days
            const firstDay = new Date(currentJournalMonth.getFullYear(), currentJournalMonth.getMonth(), 1);
            const lastDay = new Date(currentJournalMonth.getFullYear(), currentJournalMonth.getMonth() + 1, 0);
            const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Monday = 0

            // Empty cells
            for (let i = 0; i < startDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                grid.appendChild(empty);
            }

            // Day cells
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;

                const dateKey = `${currentJournalMonth.getFullYear()}-${currentJournalMonth.getMonth() + 1}-${day}`;
                
                // Check if today
                if (currentJournalMonth.getFullYear() === today.getFullYear() &&
                    currentJournalMonth.getMonth() === today.getMonth() &&
                    day === today.getDate()) {
                    dayEl.classList.add('today');
                }

                // Check if has entry
                if (journalData[dateKey]) {
                    dayEl.classList.add('has-entry');
                }

                dayEl.onclick = () => selectDate(day);
                grid.appendChild(dayEl);
            }
        }

        function selectDate(day) {
            selectedJournalDate = `${currentJournalMonth.getFullYear()}-${String(currentJournalMonth.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            const dateObj = new Date(currentJournalMonth.getFullYear(), currentJournalMonth.getMonth(), day);
            const dateStr = `${day}. ${['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 
                                        'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'][dateObj.getMonth()]} ${dateObj.getFullYear()}`;
            
            document.getElementById('journalEntryDate').textContent = dateStr;
            document.getElementById('journalTextarea').value = journalData[selectedJournalDate] || '';
            
            // Popup öffnen
            document.getElementById('journalEntryBackdrop').classList.add('active');
            document.getElementById('journalEntrySection').classList.add('active');
        }
        
        function closeJournalEntry() {
            document.getElementById('journalEntryBackdrop').classList.remove('active');
            document.getElementById('journalEntrySection').classList.remove('active');
        }

        function saveJournalEntry() {
            console.log('💾 saveJournalEntry called');
            try {
                const textarea = document.getElementById('journalTextarea');
                if (!textarea) {
                    console.error('❌ Textarea not found!');
                    alert('Fehler: Textfeld nicht gefunden');
                    return;
                }
                
                const text = textarea.value;
                console.log('📝 Text length:', text.length);
                console.log('📅 Selected date:', selectedJournalDate);
                
                if (text.trim()) {
                    journalData[selectedJournalDate] = text;
                    console.log('✅ Saved to journalData');
                } else {
                    delete journalData[selectedJournalDate];
                    console.log('🗑️ Deleted empty entry');
                }
                
                try {
                    localStorage.setItem('fysJournal', JSON.stringify(journalData));
                    console.log('💾 Saved to localStorage');
                } catch(storageError) {
                    console.error('❌ localStorage error:', storageError);
                    // Weiter machen auch wenn localStorage fehlschlägt
                }
                
                try {
                    showToast();
                    console.log('🎉 Toast shown');
                } catch(toastError) {
                    console.warn('⚠️ Toast error (non-critical):', toastError);
                }
                
                try {
                    renderCalendar();
                    console.log('📆 Calendar rendered');
                } catch(calError) {
                    console.warn('⚠️ Calendar render error:', calError);
                }
                
                try {
                    updateJournalStats();
                    console.log('📊 Stats updated');
                } catch(statsError) {
                    console.warn('⚠️ Stats error:', statsError);
                }
                
                try {
                    updateDailyProgress();
                    console.log('🎯 Progress badges updated');
                } catch(progressError) {
                    console.warn('⚠️ Progress error:', progressError);
                }
                
                // Popup schließen - KRITISCH, muss funktionieren
                console.log('🚪 Closing popup...');
                try {
                    const backdrop = document.getElementById('journalEntryBackdrop');
                    const section = document.getElementById('journalEntrySection');
                    
                    if (backdrop) {
                        backdrop.classList.remove('active');
                        console.log('✅ Backdrop closed');
                    } else {
                        console.error('❌ Backdrop element not found!');
                    }
                    
                    if (section) {
                        section.classList.remove('active');
                        console.log('✅ Section closed');
                    } else {
                        console.error('❌ Section element not found!');
                    }
                } catch(closeError) {
                    console.error('❌ Error closing popup:', closeError);
                }
                
                console.log('✅ Save complete!');
                
            } catch(e) {
                console.error('❌ Save journal error:', e);
                console.error('Stack:', e.stack);
                alert('Fehler beim Speichern: ' + e.message);
            }
        }

        function updateJournalStats() {
            const entries = Object.keys(journalData).length;
            document.getElementById('journalEntriesCount').textContent = entries;

            if (entries > 0) {
                const dates = Object.keys(journalData).sort().reverse();
                const lastDate = dates[0].split('-');
                document.getElementById('journalLastDate').textContent = 
                    `${lastDate[2]}.${lastDate[1]}`;
            } else {
                document.getElementById('journalLastDate').textContent = '—';
            }
        }

        // ========================================
        // WIZARD CHECK-IN FUNCTIONS
        // ========================================
        
        const baseWizardCategories = [
            { id: 'social', name: { de: 'Soziales', en: 'Social', es: 'Social' }, color: '#ffd700', hint: { de: 'Wie war die Qualität deiner sozialen Interaktionen?', en: 'How was the quality of your social interactions?', es: '¿Cómo fue la calidad de tus interacciones sociales?' } },
            { id: 'energy', name: { de: 'Energie', en: 'Energy', es: 'Energía' }, color: '#00ff88', hint: { de: 'Wie viel Energie hattest du heute?', en: 'How much energy did you have today?', es: '¿Cuánta energía tuviste hoy?' } },
            { id: 'sleep', name: { de: 'Schlaf', en: 'Sleep', es: 'Sueño' }, color: '#00ff88', hint: { de: 'Wie viele Stunden hast du geschlafen?', en: 'How many hours did you sleep?', es: '¿Cuántas horas dormiste?' }, isSleep: true },
            { id: 'focus', name: { de: 'Fokus', en: 'Focus', es: 'Enfoque' }, color: '#ff6b35', hint: { de: 'Wie gut konntest du dich konzentrieren?', en: 'How well could you concentrate?', es: '¿Qué tan bien pudiste concentrarte?' } },
            { id: 'discipline', name: { de: 'Disziplin', en: 'Discipline', es: 'Disciplina' }, color: '#a8a8a8', hint: { de: 'Wie diszipliniert warst du heute?', en: 'How disciplined were you today?', es: '¿Qué tan disciplinado fuiste hoy?' } },
            { id: 'sport', name: { de: 'Sport', en: 'Sport', es: 'Deporte' }, color: '#ff4757', hint: { de: 'Wie aktiv warst du körperlich?', en: 'How physically active were you?', es: '¿Qué tan activo estuviste físicamente?' } },
            { id: 'nutrition', name: { de: 'Ernährung', en: 'Nutrition', es: 'Nutrición' }, color: '#00d4ff', hint: { de: 'Wie gesund hast du dich ernährt?', en: 'How healthy did you eat?', es: '¿Qué tan saludable comiste?' } },
            { id: 'mindset', name: { de: 'Mindset', en: 'Mindset', es: 'Mentalidad' }, color: '#5f7aff', hint: { de: 'Wie positiv war deine Einstellung?', en: 'How positive was your attitude?', es: '¿Qué tan positiva fue tu actitud?' } }
        ];

        // Function to get wizard categories including active pack categories
        function getWizardCategories() {
            let wizardCats = [...baseWizardCategories];
            
            try {
                // Add active pack categories
                if (isPro && performanceData.activePacks && performanceData.activePacks.length > 0) {
                    console.log('Adding pack categories:', performanceData.activePacks);
                    const packCats = getActivePackCategories();
                    
                    if (packCats && packCats.length > 0) {
                        packCats.forEach(packCat => {
                            if (packCat && packCat.id && packCat.name && packCat.color) {
                                const nameObj = typeof packCat.name === 'object' ? packCat.name : { de: packCat.name, en: packCat.name, es: packCat.name };
                                
                                wizardCats.push({
                                    id: packCat.id,
                                    name: nameObj,
                                    color: packCat.color,
                                    hint: { 
                                        de: `Wie würdest du dein ${nameObj.de} heute bewerten?`, 
                                        en: `How would you rate your ${nameObj.en} today?`, 
                                        es: `¿Cómo calificarías tu ${nameObj.es} hoy?` 
                                    }
                                });
                                
                                // Add icon for pack category
                                if (!categoryIcons[packCat.id] && packCat.emoji) {
                                    categoryIcons[packCat.id] = `<div style="font-size: 20px;">${packCat.emoji}</div>`;
                                }
                            }
                        });
                        console.log('✓ Added', packCats.length, 'pack categories');
                    }
                }
            } catch (error) {
                console.error('Error adding pack categories:', error);
                console.error('Falling back to base categories only');
            }
            
            return wizardCats;
        }

        const categoryIcons = {
            // Base categories
            social: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
            energy: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
            sleep: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
            focus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
            discipline: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
            sport: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
            nutrition: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>`,
            mindset: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>`,
            
            // Finance Pack
            savings: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
            investments: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>`,
            budget: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg>`,
            income: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>`,
            financial_education: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
            
            // Health Pack
            cardio: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
            strength: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5v11M17.5 6.5v11M3 9.5h3M18 9.5h3M3 14.5h3M18 14.5h3M9 3v3M15 3v3M9 18v3M15 18v3"></path></svg>`,
            flexibility: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path></svg>`,
            mental_health: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
            
            // Entrepreneurship Pack
            networking: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
            product_development: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>`,
            marketing: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0L21.3 15.3z"></path><path d="M7.5 10.5L14 17"></path></svg>`,
            sales: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`,
            leadership: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20M5 20V9l7-5 7 5v11M9 20v-6h6v6"></path></svg>`
        };

        let wizardCurrentStep = 0;
        let wizardDraft = {};
        let wizardCategories = []; // Will be populated in startWizard

        function startWizard() {
            console.log('╔════════════════════════════════════╗');
            console.log('║   START WIZARD - DEBUG MODE        ║');
            console.log('╚════════════════════════════════════╝');
            
            try {
                // Step 1: Get categories
                wizardCategories = getWizardCategories();
                console.log('✓ Categories loaded:', wizardCategories.length);
                console.log('  Categories:', wizardCategories.map(c => c.id).join(', '));
                
                // Step 2: Defensive guards
                if (!wizardCategories || wizardCategories.length === 0) {
                    console.error('✗ ERROR: No categories! Using fallback.');
                    wizardCategories = [...baseWizardCategories];
                }
                
                if (!wizardDraft) {
                    wizardDraft = {};
                    console.log('✓ wizardDraft initialized');
                }
                
                // Step 3: UI Elements
                const confirmDialog = document.getElementById('wizardConfirm');
                const container = document.getElementById('wizardContainer');
                const content = document.getElementById('wizardContent');
                const errorDiv = document.getElementById('wizardError');
                
                console.log('✓ UI Elements:');
                console.log('  - confirmDialog:', !!confirmDialog);
                console.log('  - container:', !!container);
                console.log('  - content:', !!content);
                
                if (!confirmDialog || !container || !content) {
                    throw new Error('Critical UI elements missing');
                }
                
                // Step 4: Hide dialogs, show container
                confirmDialog.classList.remove('active'); // Use classList!
                if (errorDiv) errorDiv.classList.remove('active');
                container.classList.add('active');
                console.log('✓ Container shown (added .active class)');
                
                // Step 5: Reset state
                wizardCurrentStep = 0;
                console.log('✓ Current step set to 0');
                
                // Step 6: Load draft
                loadWizardDraft();
                console.log('✓ Draft loaded');
                
                // Step 7: Render dots
                renderWizardProgressDots();
                console.log('✓ Progress dots rendered');
                
                // Step 8: Render steps
                renderWizardSteps();
                console.log('✓ Steps rendered');
                
                // Step 9: Wait for DOM, then update UI
                setTimeout(() => {
                    console.log('--- Delayed UI Update (50ms) ---');
                    
                    try {
                        // Update UI
                        updateWizardUI();
                        console.log('✓ UI updated');
                        
                        // Check if first step is visible
                        const firstStep = document.getElementById('wizard-step-0');
                        if (firstStep) {
                            const hasActive = firstStep.classList.contains('active');
                            const styles = window.getComputedStyle(firstStep);
                            
                            console.log('✓ First step check:');
                            console.log('  - Element exists:', !!firstStep);
                            console.log('  - Has .active class:', hasActive);
                            console.log('  - Display:', styles.display);
                            console.log('  - Opacity:', styles.opacity);
                            
                            // NUCLEAR FIX: Force visible if needed
                            if (!hasActive || styles.display === 'none') {
                                console.warn('⚠ First step not visible! Forcing...');
                                firstStep.classList.add('active');
                                console.log('✓ First step FORCED visible');
                            }
                        } else {
                            console.error('✗ ERROR: First step element not found!');
                            throw new Error('First step element not found');
                        }
                        
                        console.log('╔════════════════════════════════════╗');
                        console.log('║   WIZARD STARTED SUCCESSFULLY      ║');
                        console.log('╚════════════════════════════════════╝');
                    } catch (innerError) {
                        console.error('✗ Error in delayed UI update:', innerError);
                        showWizardError();
                    }
                }, 50);
                
            } catch (error) {
                console.error('╔════════════════════════════════════╗');
                console.error('║   WIZARD START FAILED              ║');
                console.error('╚════════════════════════════════════╝');
                console.error('Error details:', error);
                console.error('Stack trace:', error.stack);
                showWizardError();
            }
        }

        function cancelWizard() {
            const container = document.getElementById('wizardContainer');
            const confirmDialog = document.getElementById('wizardConfirm');
            if (container) container.classList.remove('active');
            if (confirmDialog) confirmDialog.classList.remove('active');
            switchView('home');
        }
        
        // Intelligente Check-In Funktion: Erkennt ob Pro-User heute bereits eingecheckt hat
        function openCheckIn() {
            const today = new Date().toDateString();
            const lastCheckInDate = localStorage.getItem('lastCheckInDate');
            
            // TEST MODE: Erlaube immer neue CheckIns
            if (testMode) {
                console.log('🧪 TEST MODE: Unlimited check-ins enabled');
                switchView('checkin');
                return;
            }
            
            // Free-User der heute bereits eingecheckt hat → Meldung
            if (!isPro && lastCheckInDate === today) {
                alert('⚠️ Du hast heute bereits eingecheckt!\n\nNur 1 Check-In pro Tag möglich.\n\nMit FYS Pro kannst du deinen heutigen Check-In bis Mitternacht bearbeiten.');
                return;
            }
            
            // Pro-User der heute bereits eingecheckt hat → direkt zum Bearbeiten
            if (isPro && lastCheckInDate === today) {
                console.log('🔧 Pro user editing today\'s check-in');
                startWizardEdit();
            } else {
                // Normaler Check-In Flow
                switchView('checkin');
            }
        }
        
        // Update Check-In Widget basierend auf Status
        function updateCheckInWidget() {
            const today = new Date().toDateString();
            const lastCheckInDate = localStorage.getItem('lastCheckInDate');
            const hasCheckedInToday = lastCheckInDate === today;
            
            const subtitle = document.getElementById('checkinWidgetSubtitle');
            const widget = document.querySelector('.checkin-widget');
            
            if (!subtitle || !widget) return;
            
            // Entferne alle Status-Klassen
            widget.classList.remove('completed', 'pro-edit');
            
            if (hasCheckedInToday) {
                if (isPro) {
                    subtitle.textContent = '✏️ Bearbeite deinen heutigen Check-In';
                    widget.classList.add('pro-edit');
                } else {
                    subtitle.textContent = '✅ Heute bereits eingecheckt';
                    widget.classList.add('completed');
                }
            } else {
                subtitle.textContent = 'Beantworte 8 Fragen zu deinem Tag';
            }
        }
        
        // Funktion für Pro-User: Check-In bearbeiten (direkt zur Zusammenfassung)
        function startWizardEdit() {
            console.log('🔧 Starting Wizard in EDIT MODE');
            
            try {
                // Lade heutigen Check-In
                const today = new Date().toISOString().split('T')[0];
                const todayEntry = performanceData.entries.find(e => {
                    const entryDate = new Date(e.date).toISOString().split('T')[0];
                    return entryDate === today;
                });
                
                if (!todayEntry) {
                    console.error('No entry found for today!');
                    alert('Fehler: Kein Check-In für heute gefunden.');
                    return;
                }
                
                console.log('✓ Found today entry:', todayEntry);
                
                // Fülle wizardDraft mit heutigen Werten
                wizardDraft = {};
                wizardCategories = getWizardCategories();
                
                // Fülle alle Kategoriewerte
                wizardCategories.forEach(cat => {
                    if (cat.isSleep) {
                        wizardDraft[cat.id] = todayEntry.sleepHours || 8.0;
                    } else {
                        wizardDraft[cat.id] = todayEntry.values[cat.id] || 5;
                    }
                    console.log(`Loaded ${cat.id}:`, wizardDraft[cat.id]);
                });
                
                // Starte normalen Wizard
                startWizard();
                
                // Spring direkt zur Zusammenfassung (nach kurzer Verzögerung)
                setTimeout(() => {
                    wizardCurrentStep = wizardCategories.length; // Letzter Step = Review
                    updateWizardUI();
                    renderWizardReview();
                    console.log('✓ Jumped to review step');
                }, 100);
                
            } catch (error) {
                console.error('Error starting wizard edit:', error);
                alert('Fehler beim Laden des Check-Ins: ' + error.message);
            }
        }

        function closeWizard() {
            if (confirm('Möchtest du den Check-in wirklich abbrechen? Deine Eingaben werden als Entwurf gespeichert.')) {
                const container = document.getElementById('wizardContainer');
                const confirmDialog = document.getElementById('wizardConfirm');
                if (container) container.classList.remove('active');
                if (confirmDialog) confirmDialog.classList.remove('active');
                switchView('home');
            }
        }
        
        function showWizardError() {
            console.log('🚨 Showing error UI');
            const confirmDialog = document.getElementById('wizardConfirm');
            const container = document.getElementById('wizardContainer');
            const errorDiv = document.getElementById('wizardError');
            
            if (confirmDialog) confirmDialog.classList.remove('active');
            if (container) container.classList.remove('active');
            if (errorDiv) errorDiv.classList.add('active');
        }
        
        function retryWizard() {
            console.log('🔄 Retrying wizard...');
            const errorDiv = document.getElementById('wizardError');
            if (errorDiv) errorDiv.classList.remove('active');
            
            // Go back to confirm dialog
            switchView('checkin');
        }

        function renderWizardProgressDots() {
            const dotsContainer = safeGetElement('progressDots');
            if (!dotsContainer) return;
            
            dotsContainer.innerHTML = wizardCategories.map((_, i) => 
                `<div class="dot" data-step="${i}"></div>`
            ).join('');
        }

        function renderWizardSteps() {
            const content = safeGetElement('wizardContent');
            if (!content) {
                console.error('ERROR: wizardContent not found!');
                return;
            }
            
            content.innerHTML = '';
            
            console.log('Rendering', wizardCategories.length, 'wizard steps');
            
            // Render all categories
            wizardCategories.forEach((cat, index) => {
                const step = document.createElement('div');
                step.className = 'step-container-wizard';
                step.id = `wizard-step-${index}`;
                
                const isSleep = cat.isSleep;
                const defaultValue = isSleep ? (wizardDraft[cat.id] || 8.0) : (wizardDraft[cat.id] || 5);
                const maxValue = isSleep ? 12 : 10;
                const minValue = isSleep ? 0 : 1;
                const stepValue = isSleep ? 0.5 : 1;
                const displayValue = isSleep ? defaultValue.toFixed(1) : defaultValue;
                const labelText = isSleep ? 'Stunden' : 'von 10 Punkten';
                const minLabel = isSleep ? '0h' : 'Sehr schlecht';
                const maxLabel = isSleep ? '12h' : 'Perfekt';
                
                step.innerHTML = `
                    <div class="category-icon-wizard" style="background: ${cat.color}20; color: ${cat.color};">
                        ${categoryIcons[cat.id] || '?'}
                    </div>
                    <div class="step-title-wizard">${cat.name[currentLang] || cat.name}</div>
                    <div class="step-subtitle-wizard">${cat.hint[currentLang] || cat.hint}</div>
                    <div class="input-area-wizard">
                        <div class="slider-value-display-wizard">
                            <div class="slider-value-wizard" id="wizard-value-${cat.id}">${displayValue}</div>
                            <div class="slider-label-wizard">${labelText}</div>
                        </div>
                        <div style="padding: 0 12px;">
                            <input type="range" min="${minValue}" max="${maxValue}" step="${stepValue}" value="${defaultValue}" 
                                   class="slider-wizard" id="wizard-slider-${cat.id}" 
                                   oninput="updateWizardSliderValue('${cat.id}', this.value, ${isSleep})">
                            <div class="slider-labels-wizard">
                                <span>${minLabel}</span>
                                <span>${maxLabel}</span>
                            </div>
                        </div>
                    </div>
                `;
                content.appendChild(step);
            });

            // Render review step
            const reviewStep = document.createElement('div');
            reviewStep.className = 'step-container-wizard';
            reviewStep.id = 'wizard-step-review';
            reviewStep.innerHTML = `
                <div class="step-title-wizard">Zusammenfassung</div>
                <div class="step-subtitle-wizard">Überprüfe deine Angaben. Tippe auf eine Kategorie zum Bearbeiten.</div>
                <div class="review-list-wizard" id="wizardReviewList"></div>
            `;
            content.appendChild(reviewStep);
            
            console.log('Wizard steps rendered successfully');
        }

        function updateWizardSliderValue(id, value, isSleep = false) {
            const displayValue = isSleep ? parseFloat(value).toFixed(1) : value;
            document.getElementById(`wizard-value-${id}`).textContent = displayValue;
            wizardDraft[id] = parseFloat(value);
            saveWizardDraft();
        }

        function updateWizardUI() {
            const stepCounter = document.getElementById('stepCounter');
            const progressBar = document.getElementById('progressBarWizard');
            const backBtn = document.getElementById('backBtnWizard');
            const nextBtn = document.getElementById('nextBtnWizard');
            
            if (!stepCounter || !progressBar || !backBtn || !nextBtn) {
                console.error('Wizard UI elements not found');
                return;
            }
            
            const isReview = wizardCurrentStep === wizardCategories.length;
            stepCounter.textContent = 
                isReview ? 'Zusammenfassung' : `Schritt ${wizardCurrentStep + 1}/${wizardCategories.length}`;

            const progress = ((wizardCurrentStep + 1) / (wizardCategories.length + 1)) * 100;
            progressBar.style.width = progress + '%';

            document.querySelectorAll('.dot').forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i < wizardCurrentStep) dot.classList.add('completed');
                if (i === wizardCurrentStep) dot.classList.add('active');
            });

            backBtn.disabled = wizardCurrentStep === 0;

            // Handle ALL step containers (including review)
            document.querySelectorAll('.step-container-wizard').forEach((step, i) => {
                step.classList.remove('active', 'prev');
                
                // Regular steps (0 to length-1)
                if (i < wizardCategories.length) {
                    if (i === wizardCurrentStep) {
                        step.classList.add('active');
                    } else if (i < wizardCurrentStep) {
                        step.classList.add('prev');
                    }
                }
                // Review step (last one)
                else if (i === wizardCategories.length && isReview) {
                    step.classList.add('active');
                }
            });

            if (isReview) {
                nextBtn.textContent = '✓ Speichern';
                nextBtn.onclick = saveWizardCheckIn;
                updateWizardReviewList();
            } else {
                nextBtn.textContent = 'Weiter';
                nextBtn.onclick = wizardNextStep;
            }
        }

        function updateWizardReviewList() {
            const reviewList = document.getElementById('wizardReviewList');
            if (!reviewList) {
                console.error('wizardReviewList not found');
                return;
            }
            reviewList.innerHTML = wizardCategories.map((cat, index) => `
                <div class="review-item-wizard" onclick="goToWizardStep(${index})">
                    <div class="review-item-left-wizard">
                        <div class="review-icon-wizard" style="background: ${cat.color}20; color: ${cat.color};">
                            ${categoryIcons[cat.id] || cat.icon}
                        </div>
                        <div class="review-info-wizard">
                            <div class="review-category-wizard">${cat.name[currentLang]}</div>
                            <div class="review-hint-wizard">${cat.hint[currentLang]}</div>
                        </div>
                    </div>
                    <div class="review-value-wizard">${wizardDraft[cat.id] || (cat.id === 'sleep' ? '8.0' : '5')}</div>
                </div>
            `).join('');
        }

        function wizardNextStep() {
            if (wizardCurrentStep < wizardCategories.length) {
                wizardCurrentStep++;
                updateWizardUI();
            }
        }

        function goToWizardStep(step) {
            console.log('🔄 goToWizardStep called:', step);
            console.log('  Current step before:', wizardCurrentStep);
            wizardCurrentStep = step;
            console.log('  Current step after:', wizardCurrentStep);
            updateWizardUI();
            console.log('  ✓ UI updated - should show step', step);
            
            // Scroll to top of the step container
            setTimeout(() => {
                const activeStep = document.querySelector('.step-container-wizard.active');
                if (activeStep) {
                    activeStep.scrollTop = 0;
                }
            }, 100);
        }

        document.addEventListener('click', function(e) {
            if (e.target.id === 'backBtnWizard') {
                if (wizardCurrentStep > 0) {
                    wizardCurrentStep--;
                    updateWizardUI();
                }
            }
        });

        function saveWizardDraft() {
            localStorage.setItem('fysWizardDraft', JSON.stringify(wizardDraft));
        }

        function loadWizardDraft() {
            const saved = localStorage.getItem('fysWizardDraft');
            if (saved) {
                wizardDraft = JSON.parse(saved);
            }
        }

        function saveWizardCheckIn() {
            console.log('=== SAVE WIZARD CHECK-IN START ===');
            console.log('Raw wizardDraft:', wizardDraft);
            
            // 1 Check-In pro Tag - Prüfe ob heute bereits eingecheckt wurde
            const today = new Date().toDateString();
            const lastCheckInDate = localStorage.getItem('lastCheckInDate');
            
            let isEditingToday = false;
            
            // TEST MODE: Erlaube immer neue CheckIns (überschreibe nicht, erstelle neu)
            if (testMode) {
                console.log('🧪 TEST MODE: Bypassing date check - creating new entry');
                isEditingToday = false; // Immer neuer Entry im Test-Mode
            } else if (isPro && lastCheckInDate === today) {
                // Pro-User dürfen heutigen Check-In bis 23:59 bearbeiten (überschreiben)
                isEditingToday = true;
                console.log('✏️ Pro-User bearbeitet heutigen Check-In');
            } else if (lastCheckInDate === today) {
                // Free-User: Nur 1 Check-In pro Tag
                alert('⚠️ Du hast heute bereits eingecheckt!\n\nNur 1 Check-In pro Tag möglich.\n\nMit FYS Pro kannst du deinen heutigen Check-In bis Mitternacht bearbeiten.');
                closeWizard();
                return;
            }
            
            // Get all values
            const values = {};
            const sleepHoursValue = parseFloat(wizardDraft.sleep) || 8.0;
            
            console.log('Sleep Hours Value (parsed):', sleepHoursValue);
            console.log('Sleep Goal:', sleepGoal);
            
            // Calculate sleep bonus: ±0.25 per 0.5h deviation
            const sleepGoalDiff = sleepHoursValue - sleepGoal;
            const halfHourDeviations = sleepGoalDiff / 0.5;
            const sleepBonus = halfHourDeviations * 0.25;
            
            // DEBUG LOGGING
            console.log('=== SLEEP CALCULATION DEBUG ===');
            console.log('Sleep Hours:', sleepHoursValue);
            console.log('Sleep Goal:', sleepGoal);
            console.log('Difference:', sleepGoalDiff);
            console.log('Half Hour Deviations:', halfHourDeviations);
            console.log('Sleep Bonus:', sleepBonus);
            
            // Collect all category values
            wizardCategories.forEach(cat => {
                if (!cat.isSleep) {
                    values[cat.id] = parseFloat(wizardDraft[cat.id]) || 5;
                    console.log(`${cat.id} value:`, values[cat.id]);
                }
            });
            
            console.log('Energy Input Value:', values.energy);
            console.log('All Input Values:', values);

            // Use existing submitCheckIn logic
            const isFirstEntry = performanceData.entries.length === 0;
            let entryDate;
            if (isFirstEntry) {
                entryDate = new Date();
            } else {
                const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                entryDate = new Date(lastEntry.date);
                entryDate.setDate(entryDate.getDate() + 1);
                
                if (testMode) {
                    console.log('🧪 TEST MODE: Adding +1 day to simulate new day');
                }
            }

            let fysIndex;
            const categoryValues = {};
            const packIndices = {}; // Add pack indices

            if (isFirstEntry) {
                console.log('=== FIRST ENTRY - Calculating initial values ===');
                
                // WICHTIG: Auch beim ersten Check-In die Werte berücksichtigen!
                // Erstelle adjustierte Werte mit Sleep Bonus für Energy
                const adjustedValuesForFYS = {};
                categories.forEach(cat => {
                    if (cat.id === 'energy') {
                        adjustedValuesForFYS[cat.id] = (values[cat.id] || 5) + sleepBonus;
                        console.log('Adjusted Energy for first entry:', adjustedValuesForFYS[cat.id]);
                    } else {
                        adjustedValuesForFYS[cat.id] = values[cat.id] || 5;
                    }
                });
                
                console.log('First Entry Adjusted Values:', adjustedValuesForFYS);
                
                // Berechne FYS Index basierend auf den Werten (startet bei 100 + Änderung)
                fysIndex = calculateFYSIndex(adjustedValuesForFYS, 100);
                console.log('First Entry FYS Index:', fysIndex);
                
                // Berechne Category Values (starten bei 100 + Änderung)
                categories.forEach(cat => {
                    if (cat.id === 'energy') {
                        // Energy mit adjustiertem Wert
                        const adjustedInput = adjustedValuesForFYS[cat.id];
                        const dailyChange = adjustedInput - 5;
                        categoryValues[cat.id] = Math.max(0, 100 + dailyChange);
                        console.log(`First Entry ${cat.id}:`, categoryValues[cat.id]);
                    } else {
                        categoryValues[cat.id] = calculateCategoryValue(values[cat.id], 100);
                        console.log(`First Entry ${cat.id}:`, categoryValues[cat.id]);
                    }
                });
                
                // Initialize pack categories
                getActivePackCategories().forEach(cat => {
                    categoryValues[cat.id] = calculateCategoryValue(values[cat.id], 100);
                    console.log(`First Entry Pack Category ${cat.id}:`, categoryValues[cat.id]);
                });
                
                // Initialize pack indices
                performanceData.activePacks.forEach(packId => {
                    packIndices[packId] = calculatePackIndex(packId, values, 100);
                    console.log(`First Entry Pack ${packId} Index:`, packIndices[packId]);
                });
            } else {
                const lastEntry = performanceData.entries[performanceData.entries.length - 1];
                
                // Create adjusted values for FYS Index calculation
                // Sleep bonus is added to ENERGY INPUT before averaging
                const adjustedValuesForFYS = {};
                categories.forEach(cat => {
                    if (cat.id === 'energy') {
                        // Energy gets the sleep bonus added to its input value
                        // Example: energy input 9, sleep -4h → bonus -2
                        // For FYS average: 9 + (-2) = 7
                        adjustedValuesForFYS[cat.id] = (values[cat.id] || 5) + sleepBonus;
                        console.log('Adjusted Energy for FYS:', adjustedValuesForFYS[cat.id]);
                    } else {
                        adjustedValuesForFYS[cat.id] = values[cat.id] || 5;
                    }
                });
                
                console.log('All Adjusted Values for FYS:', adjustedValuesForFYS);
                
                // Calculate FYS Index with adjusted energy value
                fysIndex = calculateFYSIndex(adjustedValuesForFYS, lastEntry.fysIndex);
                
                console.log('New FYS Index:', fysIndex);
                
                // Now calculate categoryValues (BASE categories)
                categories.forEach(cat => {
                    const prevValue = lastEntry.categoryValues[cat.id] || 100;
                    
                    if (cat.id === 'energy') {
                        // For energy category value: use the adjusted input
                        // This means the category curve also reflects sleep
                        const adjustedInput = adjustedValuesForFYS[cat.id];
                        const dailyChange = adjustedInput - 5;
                        categoryValues[cat.id] = Math.max(0, prevValue + dailyChange);
                        
                        console.log('Energy Category Calculation:');
                        console.log('  Previous Value:', prevValue);
                        console.log('  Adjusted Input:', adjustedInput);
                        console.log('  Daily Change:', dailyChange);
                        console.log('  New Value:', categoryValues[cat.id]);
                    } else {
                        categoryValues[cat.id] = calculateCategoryValue(values[cat.id], prevValue);
                    }
                });
                
                // Calculate pack category values
                getActivePackCategories().forEach(cat => {
                    const prevValue = lastEntry.categoryValues[cat.id] || 100;
                    categoryValues[cat.id] = calculateCategoryValue(values[cat.id], prevValue);
                });
                
                // Calculate pack indices
                performanceData.activePacks.forEach(packId => {
                    const prevPackIndex = lastEntry.packIndices?.[packId] || 100;
                    packIndices[packId] = calculatePackIndex(packId, values, prevPackIndex);
                    console.log(`Pack ${packId} Index:`, packIndices[packId]);
                });
            }

            console.log('Final Category Values:', categoryValues);
            console.log('Final Pack Indices:', packIndices);
            console.log('=== END DEBUG ===');

            // Edit-Logik für Pro-User
            const newEntry = {
                date: entryDate.toISOString(),
                values: values,
                categoryValues: categoryValues,
                sleepHours: sleepHoursValue,
                fysIndex: fysIndex,
                packIndices: packIndices
            };
            
            if (isEditingToday) {
                // Pro-User bearbeitet heutigen Check-In - überschreiben statt neu anlegen
                performanceData.entries[performanceData.entries.length - 1] = newEntry;
                console.log('✏️ Heutiger Check-In wurde überschrieben (Pro)');
            } else {
                // Neuer Check-In
                performanceData.entries.push(newEntry);
                console.log('✅ Neuer Check-In hinzugefügt');
            }
            
            // Datum des letzten Check-Ins speichern (NICHT im Test-Mode!)
            if (!testMode) {
                localStorage.setItem('lastCheckInDate', today);
                console.log('✓ lastCheckInDate gespeichert:', today);
            } else {
                console.log('🧪 TEST MODE: Skipping lastCheckInDate update');
            }

            localStorage.setItem('fysData', JSON.stringify(performanceData));
            localStorage.removeItem('fysWizardDraft');

            // Set flag for post-reload actions
            try {
                sessionStorage.setItem('fysCheckInCompleted', 'true');
                console.log('Post-checkin flag set successfully');
            } catch(e) {
                console.error('Could not set sessionStorage flag:', e);
            }

            // SOFORT zum Home-View wechseln
            const container = document.getElementById('wizardContainer');
            const confirmDialog = document.getElementById('wizardConfirm');
            if (container) container.classList.remove('active');
            if (confirmDialog) confirmDialog.classList.remove('active');
            switchView('home');
            
            // Wizard Draft löschen
            wizardDraft = {};

            // JETZT Charts aktualisieren (im sichtbaren Home-View!)
            console.log('🔄 Updating charts after view switch...');
            currentTimeRange = '1d'; // Setze Zeitbereich auf 1D
            localStorage.setItem('fys_timeRange', '1d');
            
            // Time buttons aktualisieren
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.time-btn[data-range="1d"]').forEach(btn => btn.classList.add('active'));
            
            // Charts aktualisieren
            updateMainChart(); // Haupt-Chart aktualisieren
            
            // Stock-Liste aktualisieren
            if (currentStockListType === 'fys') {
                createStockList();
            }
            
            // Performance Pack Charts aktualisieren
            if (isPro && performanceData.activePacks && performanceData.activePacks.length > 0) {
                performanceData.activePacks.forEach(packId => {
                    createPackMiniChart(packId);
                });
            }
            
            updateDailyProgress(); // Update badges
            updateCheckInWidget(); // Widget aktualisieren
            
            console.log('✅ Charts updated with new data!');

            // Kurze Verzögerung für Chart-Rendering, dann Toast
            setTimeout(() => {
                showToast();
                // Latest data point highlighten
                setTimeout(() => {
                    highlightLatestDataPoint();
                }, 300);
            }, 150);
        }
        
        // Pull-to-Refresh Functionality - Flatex Style
        let touchStartY = 0;
        let touchCurrentY = 0;
        let isPulling = false;
        let isRefreshing = false;
        const pullThreshold = 80;
        const pullResistance = 3; // Widerstand beim Ziehen
        
        function initPullToRefresh() {
            const pullIndicator = document.getElementById('pullToRefresh');
            const homeView = document.getElementById('homeView');
            
            if (!homeView || !pullIndicator) return;
            
            homeView.addEventListener('touchstart', (e) => {
                if (homeView.scrollTop === 0 && !isRefreshing) {
                    touchStartY = e.touches[0].clientY;
                    isPulling = false;
                }
            }, { passive: true });
            
            homeView.addEventListener('touchmove', (e) => {
                if (isRefreshing) return;
                
                touchCurrentY = e.touches[0].clientY;
                const pullDistance = (touchCurrentY - touchStartY) / pullResistance;
                
                if (homeView.scrollTop === 0 && pullDistance > 0) {
                    isPulling = true;
                    
                    // Zeige Indicator und rotiere
                    if (pullDistance > 20) {
                        pullIndicator.classList.add('visible');
                        const rotation = Math.min(pullDistance * 4, 360);
                        pullIndicator.querySelector('.pull-to-refresh-icon').style.transform = `rotate(${rotation}deg)`;
                    } else {
                        pullIndicator.classList.remove('visible');
                    }
                }
            }, { passive: true });
            
            homeView.addEventListener('touchend', () => {
                if (!isPulling || isRefreshing) return;
                
                const pullDistance = (touchCurrentY - touchStartY) / pullResistance;
                
                if (pullDistance >= pullThreshold) {
                    // Trigger refresh - sofortiger Reload
                    isRefreshing = true;
                    pullIndicator.classList.add('loading');
                    
                    console.log('🔄 Pull-to-Refresh triggered');
                    
                    // Sofortiger Reload (kein Timeout)
                    location.reload();
                } else {
                    // Reset indicator
                    pullIndicator.classList.remove('visible');
                    pullIndicator.querySelector('.pull-to-refresh-icon').style.transform = 'rotate(0deg)';
                }
                
                isPulling = false;
                touchStartY = 0;
                touchCurrentY = 0;
            });
        }

        // Initialize
        // ============================================
        // ZENTRALE APP INITIALISIERUNG
        // ============================================
        function initializeApp() {
            console.log('🚀 initializeApp() called');
            
            try {
                // 1. Lade localStorage Daten
                performanceData = JSON.parse(localStorage.getItem('fysData')) || { entries: [], activePacks: [] };
                journalData = JSON.parse(localStorage.getItem('fysJournal')) || {};
                currentStreak = parseInt(localStorage.getItem('fysStreak')) || 0;
                longestStreak = parseInt(localStorage.getItem('fysLongestStreak')) || 0;
                isPro = localStorage.getItem('fysPro') === 'true';
                sleepGoal = parseFloat(localStorage.getItem('fysSleepGoal')) || 8.0;
                coachDataAccess = localStorage.getItem('fysCoachData') === 'true';
                testMode = localStorage.getItem('fysTestMode') === 'true';
                
                // Stelle sicher dass activePacks existiert
                if (!performanceData.activePacks) {
                    performanceData.activePacks = [];
                }
                
                console.log('✓ Daten geladen:', {
                    entries: performanceData.entries.length,
                    activePacks: performanceData.activePacks.length,
                    journalEntries: Object.keys(journalData).length,
                    streak: currentStreak,
                    isPro: isPro
                });
                
                // 2. Update Performance Packs Display
                renderPerformancePacks();
                console.log('✓ Performance Packs gerendert');
                
                // 3. Update Progress Badges & Streak
                updateDailyProgress(); // Ruft automatisch calculateStreak() auf
                console.log('✓ Progress Badges & Streak aktualisiert');
                
                // 4. Update Charts
                initMainChart();
                updateUI();
                console.log('✓ Charts aktualisiert');
                
                // 5. Update Check-In Widget Status
                updateCheckInWidget();
                console.log('✓ Check-In Widget aktualisiert');
                
                // 6. Update Stock List
                createStockList();
                console.log('✓ Stock List aktualisiert');
                
                // 7. Update Journal Stats
                updateJournalStats();
                console.log('✓ Journal Stats aktualisiert');
                
                // 8. Update Settings Toggles
                if (coachDataAccess) {
                    const toggle = document.getElementById('coachDataToggle');
                    if (toggle) toggle.classList.add('active');
                }
                
                if (testMode) {
                    const testToggle = document.getElementById('testModeToggle');
                    if (testToggle) testToggle.classList.add('active');
                }
                
                // 9. Update Theme Button & Apply Theme
                const themeBtn = document.querySelector(`[data-theme-btn="${currentTheme}"]`);
                if (themeBtn) themeBtn.classList.add('active');
                
                // Apply actual theme (wichtig für System Theme)
                let actualTheme = currentTheme;
                if (currentTheme === 'system') {
                    actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                }
                document.documentElement.setAttribute('data-theme', actualTheme);
                document.body.className = actualTheme;
                
                console.log('✅ App vollständig initialisiert!');
                
            } catch(e) {
                console.error('❌ Fehler bei App-Initialisierung:', e);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== PAGE LOAD ===');
            
            // Check if data was just reset
            const wasReset = sessionStorage.getItem('fysDataReset') === 'true';
            if (wasReset) {
                console.log('🔄 DATA RESET DETECTED - Initializing fresh app state');
                sessionStorage.removeItem('fysDataReset');
                
                // Stelle sicher dass wirklich KEINE Daten vorhanden sind
                performanceData = { entries: [], activePacks: [] };
                journalData = {};
                currentTimeRange = '1d';
                
                console.log('✅ Fresh state initialized:', performanceData);
            }
            
            // Hide loading screen after 3 seconds
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.classList.add('hidden');
                }
            }, 3000);
            
            // Load saved timeRange
            const savedTimeRange = localStorage.getItem('fys_timeRange');
            if (savedTimeRange) {
                currentTimeRange = savedTimeRange;
                console.log('✓ Loaded saved timeRange:', savedTimeRange);
            }
            
            // Activate correct time button
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            const timeBtns = document.querySelectorAll(`.time-btn[data-range="${currentTimeRange}"]`);
            console.log('Found time buttons to activate:', timeBtns.length, 'for range:', currentTimeRange);
            timeBtns.forEach(btn => {
                btn.classList.add('active');
                console.log('✓ Activated button:', btn.textContent.trim());
            });
            
            // Load active Performance Packs
            const savedActivePacks = localStorage.getItem('fys_activePacks');
            if (savedActivePacks) {
                try {
                    performanceData.activePacks = JSON.parse(savedActivePacks);
                    console.log('✓ Loaded active packs:', performanceData.activePacks);
                } catch (e) {
                    console.error('Error loading active packs:', e);
                }
            }
            
            let postCheckinFlag = false;
            try {
                postCheckinFlag = sessionStorage.getItem('fysCheckInCompleted') === 'true';
                console.log('Post-checkin flag:', postCheckinFlag);
            } catch(e) {
                console.error('SessionStorage error:', e);
            }
            
            const themeBtn = document.querySelector(`[data-theme-btn="${currentTheme}"]`);
            if (themeBtn) themeBtn.classList.add('active');
            
            if (coachDataAccess) {
                const toggle = document.getElementById('coachDataToggle');
                if (toggle) toggle.classList.add('active');
            }
            
            // Initialize Test Mode Toggle
            if (testMode) {
                const testToggle = document.getElementById('testModeToggle');
                if (testToggle) testToggle.classList.add('active');
                console.log('🧪 Test Mode is ACTIVE');
            }
            
            try {
                // Zentrale App-Initialisierung
                initializeApp();
                initPullToRefresh(); // Pull-to-Refresh initialisieren
            } catch(e) {
                console.error('Init error:', e);
            }
            
            // Check if we just completed a check-in
            if (postCheckinFlag) {
                console.log('POST-CHECKIN MODE ACTIVATED');
                console.log('Current timerange before:', currentTimeRange);
                
                // Reset to 1D timeframe
                changeTimeRange('1d');
                
                console.log('Current timerange after:', currentTimeRange);
                
                // Scroll to top after a brief delay to ensure content is rendered
                setTimeout(() => {
                    console.log('Scrolling to top...');
                    window.scrollTo({ top: 0, behavior: 'instant' });
                    const homeView = document.getElementById('homeView');
                    if (homeView) {
                        homeView.scrollTo({ top: 0, behavior: 'instant' });
                        console.log('Scrolled home view to top');
                    }
                }, 100);
                
                // Clear the flag
                try {
                    sessionStorage.removeItem('fysCheckInCompleted');
                    console.log('Flag cleared');
                } catch(e) {
                    console.error('Could not clear flag:', e);
                }
            } else {
                console.log('NORMAL LOAD MODE');
                // Normal load - apply saved timerange
                changeTimeRange(currentTimeRange);
            }
            
            // Setup IntersectionObserver for sticky checkin widget
            const checkinWidget = document.querySelector('.checkin-widget');
            if (checkinWidget && 'IntersectionObserver' in window) {
                const observerOptions = {
                    root: null,
                    threshold: [0, 1],
                    rootMargin: '-1px 0px 0px 0px'
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.intersectionRatio < 1) {
                            entry.target.classList.add('is-sticky');
                        } else {
                            entry.target.classList.remove('is-sticky');
                        }
                    });
                }, observerOptions);
                
                observer.observe(checkinWidget);
                console.log('✓ IntersectionObserver setup for sticky widget');
            }
        });
        
        // ============================================
        // APP RE-INITIALIZATION ON RETURN
        // ============================================
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('👀 App wurde wieder sichtbar - re-initialisiere UI');
                initializeApp();
            }
        });
        
        // ============================================
        // PERFORMANCE PACK CARD ON HOME
        // ============================================
        
        // ============================================
        // ENHANCED CATEGORY DETAILS
        // ============================================
        
        function calculateCategoryIndexInfluence(categoryId) {
            const entries = performanceData.entries;
            if (entries.length < 2) return 0;
            
            const latest = entries[entries.length - 1];
            const previous = entries[entries.length - 2];
            
            const categoryValue = latest.categoryValues?.[categoryId] || 100;
            const prevCategoryValue = previous.categoryValues?.[categoryId] || 100;
            const categoryChange = categoryValue - prevCategoryValue;
            
            const indexValue = latest.fysIndex;
            const prevIndexValue = previous.fysIndex;
            const indexChange = indexValue - prevIndexValue;
            
            if (indexChange === 0) return 0;
            return (categoryChange / indexChange) * 100;
        }

        function getTrendLabel(trend) {
            return {
                'bullish': '📈 Bullish',
                'bearish': '📉 Bearish',
                'neutral': '➡️ Neutral'
            }[trend] || '➡️ Neutral';
        }

        function renderRecentCheckins(categoryId) {
            const container = document.getElementById('recentCheckinsList');
            if (!container) return;
            
            const entries = performanceData.entries.slice(-5).reverse();
            
            if (entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 13px;">Keine Check-ins vorhanden</div>';
                return;
            }
            
            container.innerHTML = entries.map(entry => {
                const date = new Date(entry.date);
                const value = entry.categoryValues?.[categoryId] || 100;
                const rating = entry.ratings?.[categoryId] || 5;
                
                return `
                    <div class="checkin-item">
                        <div class="checkin-date">${date.toLocaleDateString('de-DE')}</div>
                        <div class="checkin-rating">${'⭐'.repeat(rating)}</div>
                        <div class="checkin-value">${value.toFixed(1)}</div>
                    </div>
                `;
            }).join('');
        }

        // Override openCategoryDetail to add enhanced features
        const originalOpenCategoryDetailFunc = typeof openCategoryDetail !== 'undefined' ? openCategoryDetail : null;

        function openCategoryDetailEnhanced(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            currentCategoryId = categoryId;
            
            const modal = safeGetElement('categoryDetailModal');
            const header = safeGetElement('categoryDetailHeader');
            const content = safeGetElement('categoryDetailContent');
            
            if (!modal || !header || !content) return;
            
            const entries = getFilteredEntries();
            let currentValue = 100;
            let changeValue = 0;
            let changePercent = 0;
            let trend = 'neutral';
            
            if (entries.length > 0) {
                const latest = entries[entries.length - 1];
                currentValue = latest.categoryValues?.[categoryId] || 100;
                
                if (entries.length > 1) {
                    const first = entries[0];
                    const firstValue = first.categoryValues?.[categoryId] || 100;
                    changeValue = currentValue - firstValue;
                    changePercent = (changeValue / firstValue) * 100;
                    
                    if (changePercent > 5) trend = 'bullish';
                    else if (changePercent < -5) trend = 'bearish';
                }
            }
            
            const indexInfluence = calculateCategoryIndexInfluence(categoryId);
            const iconHtml = categoryIcons[categoryId] || category.icon;
            
            header.innerHTML = `
                <div class="category-detail-icon" style="background: ${category.color}20; color: ${category.color};">
                    ${iconHtml}
                </div>
                <div class="category-detail-info">
                    <div class="category-detail-name">${category.name[currentLang]}</div>
                    <div class="category-detail-symbol">
                        ${category.id.toUpperCase()} 
                        <span class="trend-badge ${trend}">${getTrendLabel(trend)}</span>
                    </div>
                </div>
                <button class="close-btn" onclick="closeCategoryDetail()">×</button>
            `;
            
            content.innerHTML = `
                <div class="category-detail-price-section">
                    <div class="category-detail-price" style="color: ${changeValue >= 0 ? 'var(--accent-up)' : 'var(--accent-down)'};">
                        ${currentValue.toFixed(1)}
                    </div>
                    <div class="category-detail-change" style="background: ${changeValue >= 0 ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 51, 102, 0.1)'}; color: ${changeValue >= 0 ? 'var(--accent-up)' : 'var(--accent-down)'};">
                        ${changeValue >= 0 ? '▲' : '▼'} ${Math.abs(changePercent).toFixed(2)}%
                    </div>
                </div>
                
                <div class="category-influence-card">
                    <div class="influence-title">Index Influence</div>
                    <div class="influence-value">${indexInfluence >= 0 ? '+' : ''}${indexInfluence.toFixed(2)}%</div>
                    <div class="influence-description">Impact on ${getActiveIndexName()}</div>
                </div>
                
                <div class="category-time-selector">
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('1d')" data-cat-range="1d">1D</button>
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('7d')" data-cat-range="7d">7D</button>
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('1m')" data-cat-range="1m">1M</button>
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('6m')" data-cat-range="6m">6M</button>
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('1y')" data-cat-range="1y">1Y</button>
                    <button class="category-time-btn" onclick="changeCategoryTimeRange('all')" data-cat-range="all">MAX</button>
                </div>
                
                <div class="category-chart-card">
                    <div class="category-chart-container">
                        <canvas id="categoryDetailChart"></canvas>
                    </div>
                </div>
                
                <div class="recent-checkins-card">
                    <div class="checkins-title">Recent Check-ins</div>
                    <div id="recentCheckinsList"></div>
                </div>
            `;
            
            modal.classList.add('active');
            
            setTimeout(() => {
                // Activate correct category time button
                document.querySelectorAll('.category-time-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll(`.category-time-btn[data-cat-range="${currentCategoryTimeRange}"]`).forEach(btn => btn.classList.add('active'));
                
                initCategoryDetailChart();
                updateCategoryDetailChart();
                renderRecentCheckins(categoryId);
            }, 100);
        }

        // Use enhanced version
        if (typeof openCategoryDetail !== 'undefined') {
            openCategoryDetail = openCategoryDetailEnhanced;
        }

        // ============================================
        // WIZARD SUMMARY FLOW (IMPROVED)
        // ============================================
        
        let summaryEditMode = false;
        let editingCategoryIndex = null;

        function showWizardSummary() {
            wizardCurrentStep = wizardCategories.length;
            updateWizardUI();
            
            const content = safeGetElement('wizardContent');
            if (!content) return;
            
            content.innerHTML = `
                <div class="summary-container">
                    <div class="summary-title">Zusammenfassung</div>
                    <div class="summary-subtitle">Überprüfe deine Angaben</div>
                    
                    <div class="summary-list" id="summaryListItems"></div>
                    
                    <div class="summary-actions">
                        <button class="btn-secondary" onclick="editLastCategory()">
                            Letzte Kategorie bearbeiten
                        </button>
                        <button class="btn-primary-wizard" onclick="saveWizardCheckIn()">
                            ✓ Speichern & Abschließen
                        </button>
                    </div>
                </div>
            `;
            
            const summaryList = safeGetElement('summaryListItems');
            if (summaryList) {
                summaryList.innerHTML = wizardCategories.map((cat, index) => `
                    <div class="summary-item" onclick="editCategory(${index})">
                        <div class="summary-item-left">
                            <div class="summary-icon" style="background: ${cat.color}20; color: ${cat.color};">
                                ${categoryIcons[cat.id] || cat.icon}
                            </div>
                            <div style="font-size: 14px; font-weight: 500;">${cat.name[currentLang]}</div>
                        </div>
                        <div class="summary-value">${wizardDraft[cat.id] || (cat.isSleep ? '8.0' : '5')}</div>
                    </div>
                `).join('');
            }
        }

        function editCategory(index) {
            summaryEditMode = true;
            editingCategoryIndex = index;
            wizardCurrentStep = index;
            updateWizardUI();
            
            const nextBtn = safeGetElement('nextBtnWizard');
            if (nextBtn) {
                nextBtn.textContent = 'Zurück zur Übersicht';
                nextBtn.onclick = () => {
                    summaryEditMode = false;
                    showWizardSummary();
                };
            }
        }

        function editLastCategory() {
            const lastIndex = wizardCategories.length - 1;
            editCategory(lastIndex);
        }

        // Update wizardNextStep to go to summary
        const originalWizardNextStep = wizardNextStep;
        wizardNextStep = function() {
            if (wizardCurrentStep < wizardCategories.length - 1) {
                wizardCurrentStep++;
                updateWizardUI();
            } else {
                // Last category done → go to summary
                showWizardSummary();
            }
        };

        // ============================================
        // NEW FEATURES - 10 MAJOR UPDATES
        // ============================================

        // Active Pack Context for dynamic titles
        let activePackContext = null;

        function getActiveIndexName() {
            if (activePackContext && activePackContext.id) {
                return activePackContext.name;
            }
            return 'FYS Index';
        }

        // ============================================
        // TOOLS VIEW FUNCTIONS
        // ============================================
        
        function openPerformanceReport() {
            if (!isPro) {
                showUpgradeModal();
                return;
            }
            generatePDFReport();
        }

        function openStatistics() {
            alert('📈 Detailed statistics dashboard coming soon!');
        }

        function openProFeatures() {
            if (!isPro) {
                showUpgradeModal();
            } else {
                alert('⭐ You already have Pro! Explore all features in the app.');
            }
        }

        function showUpgradeModal() {
            const modal = safeGetElement('upgradeModal');
            if (modal) modal.classList.add('active');
        }

        function closeUpgradeModal() {
            const modal = safeGetElement('upgradeModal');
            if (modal) modal.classList.remove('active');
        }

        function activateProFromModal() {
            togglePro();
            closeUpgradeModal();
            alert('🎉 FYS Pro aktiviert! Alle Features sind jetzt freigeschaltet.');
        }

        // ============================================
        // PDF EXPORT FUNCTION
        // ============================================
        
        async function generatePDFReport() {
            try {
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined') {
                    alert('⚠️ PDF Bibliothek wird geladen...\n\nBitte versuche es in wenigen Sekunden erneut.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // ===== HEADER =====
                doc.setFontSize(24);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 107, 53); // Orange
                doc.text('FYS Performance Report', 20, 20);
                
                // Active Index Name
                const indexName = getActiveIndexName();
                doc.setFontSize(16);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text(indexName, 20, 35);
                
                // Date Range
                const entries = performanceData.entries;
                if (entries.length > 0) {
                    const first = new Date(entries[0].date);
                    const last = new Date(entries[entries.length - 1].date);
                    const dateRange = `${first.toLocaleDateString('de-DE')} - ${last.toLocaleDateString('de-DE')}`;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(128, 128, 128);
                    doc.text(dateRange, 20, 45);
                    doc.setTextColor(0, 0, 0);
                }
                
                // ===== CHART IMAGE =====
                const chartCanvas = document.getElementById('mainChart');
                if (chartCanvas) {
                    try {
                        const chartImage = chartCanvas.toDataURL('image/png');
                        doc.addImage(chartImage, 'PNG', 20, 55, 170, 80);
                    } catch (e) {
                        console.error('Chart image error:', e);
                    }
                }
                
                // ===== PERFORMANCE TABLE =====
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Performance Overview', 20, 145);
                
                const tableData = [];
                if (entries.length > 0) {
                    const latest = entries[entries.length - 1];
                    const previous = entries.length > 1 ? entries[entries.length - 2] : null;
                    
                    categories.forEach(cat => {
                        const current = latest.categoryValues?.[cat.id] || 100;
                        const prev = previous ? (previous.categoryValues?.[cat.id] || 100) : 100;
                        const change = current - prev;
                        const trend = change > 0 ? '↑' : change < 0 ? '↓' : '→';
                        
                        tableData.push([
                            cat.name.de || cat.name,
                            current.toFixed(1),
                            `${change >= 0 ? '+' : ''}${change.toFixed(1)}`,
                            trend
                        ]);
                    });
                }
                
                doc.autoTable({
                    startY: 155,
                    head: [['Category', 'Current', 'Change', 'Trend']],
                    body: tableData,
                    theme: 'grid',
                    styles: { 
                        fontSize: 9,
                        font: 'helvetica'
                    },
                    headStyles: { 
                        fillColor: [255, 107, 53],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    }
                });
                
                // ===== FOOTER =====
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(128, 128, 128);
                    doc.text(
                        `Page ${i} of ${pageCount} | Generated: ${new Date().toLocaleString('de-DE')}`,
                        doc.internal.pageSize.width / 2,
                        doc.internal.pageSize.height - 10,
                        { align: 'center' }
                    );
                }
                
                // ===== SAVE =====
                const filename = `FYS_Report_${indexName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(filename);
                
                alert('✅ PDF Report erfolgreich heruntergeladen!');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('❌ Fehler beim Erstellen des PDFs. Bitte versuche es erneut.');
            }
        }

        // ============================================
        // AUTO 1D TIMEFRAME AFTER CHECK-IN
        // ============================================
        
        // Update saveWizardCheckIn to include auto 1D switch
        const originalSaveWizardCheckIn = saveWizardCheckIn;
        saveWizardCheckIn = function() {
            // Call original function
            if (typeof originalSaveWizardCheckIn === 'function') {
                originalSaveWizardCheckIn();
            }
            
            // Set flags for post-checkin behavior
            sessionStorage.setItem('fysCheckInCompleted', 'true');
            sessionStorage.setItem('fysAutoTimeframe', '1d');
            
            updateDailyProgress(); // Update badges
            
            // Navigate to home and apply 1D
            setTimeout(() => {
                switchView('home');
                changeTimeRange('1d');
                highlightLatestDataPoint();
            }, 300);
        };

        function highlightLatestDataPoint() {
            if (mainChart && mainChart.data.datasets[0]) {
                const lastIndex = mainChart.data.datasets[0].data.length - 1;
                if (lastIndex >= 0) {
                    // Reset all points
                    mainChart.data.datasets[0].pointRadius = Array(lastIndex + 1).fill(0);
                    mainChart.data.datasets[0].pointBackgroundColor = Array(lastIndex + 1).fill('transparent');
                    
                    // Highlight latest
                    mainChart.data.datasets[0].pointRadius[lastIndex] = 6;
                    mainChart.data.datasets[0].pointBackgroundColor[lastIndex] = '#ff6b35';
                    mainChart.data.datasets[0].pointBorderColor = Array(lastIndex + 1).fill('transparent');
                    mainChart.data.datasets[0].pointBorderColor[lastIndex] = '#ffffff';
                    mainChart.data.datasets[0].pointBorderWidth = Array(lastIndex + 1).fill(0);
                    mainChart.data.datasets[0].pointBorderWidth[lastIndex] = 2;
                    
                    mainChart.update();
                }
            }
        }

        // ============================================
        // DYNAMIC TITLE UPDATES
        // ============================================
        
        // Override openPackDetails to set active pack context
        const originalOpenPackDetails = openPackDetails;
        openPackDetails = function(packId) {
            const pack = performancePacks.find(p => p.id === packId);
            if (pack) {
                activePackContext = { id: pack.id, name: pack.name };
            }
            
            if (typeof originalOpenPackDetails === 'function') {
                originalOpenPackDetails(packId);
            }
        };

        // Override closeChartDetails to reset context
        const originalCloseChartDetails = closeChartDetails;
        closeChartDetails = function() {
            activePackContext = null;
            
            if (typeof originalCloseChartDetails === 'function') {
                originalCloseChartDetails();
            }
        };

    </script>
</body>
</html>
